import{ad as dt,ae as e,r as i,af as ge,ag as _e,ah as Qe,ai as ct,aj as pt,ak as ut,al as Fe,am as ie,an as gt,ao as xt,ap as Je,aq as Ke,ar as Ee,as as Me,at as Xe,au as ft,av as ht,aw as Ze,ax as et,ay as mt,az as yt,aA as bt,aB as wt,aC as vt,aD as jt,aE as St,aF as Ct,aG as Ce,aH as ke,aI as Ue,aJ as kt,aK as Re,aL as Ne,aM as It,aN as Tt,aO as pe,aP as Dt,R as zt,aQ as Wt}from"./vendor-DxPz6D9i.js";import{R as we,B as Le,C as De,X as ze,Y as We,T as ve,a as Oe,P as tt,b as nt,c as at,L as Rt,d as At}from"./recharts-DmFB1HYV.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const j of c.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&n(j)}).observe(document,{childList:!0,subtree:!0});function o(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(l){if(l.ep)return;l.ep=!0;const c=o(l);fetch(l.href,c)}})();const Pt="/api",T=dt.create({baseURL:Pt,headers:{"Content-Type":"application/json"}});T.interceptors.request.use(t=>{const r=localStorage.getItem("token");return r&&(t.headers.Authorization=`Bearer ${r}`),t});T.interceptors.response.use(t=>t,t=>{var o;const r=(o=t.response)==null?void 0:o.status;if(r===401||r===403){localStorage.removeItem("token"),localStorage.removeItem("user");const n=window.location.pathname;n.startsWith("/admin")?n!=="/admin/login"&&(window.location.href="/admin/login"):n.startsWith("/staff")&&n!=="/staff/login"&&(window.location.href="/staff/login")}return Promise.reject(t)});function me(){const t=localStorage.getItem("user");if(t==null||t===""||t==="undefined")return null;try{return JSON.parse(t)}catch{return null}}const He="queueEntry",qe="queueDate",ot=t=>{const r=new Date().toISOString().split("T")[0];localStorage.setItem(He,JSON.stringify(t)),localStorage.setItem(qe,r)},Ae=()=>{const t=localStorage.getItem(He),r=localStorage.getItem(qe),o=new Date().toISOString().split("T")[0];if(!t||r!==o)return r!==o&&Ie(),null;try{return JSON.parse(t)}catch{return Ie(),null}},Ie=()=>{localStorage.removeItem(He),localStorage.removeItem(qe)};function ne({label:t,error:r,style:o,disabled:n,...l}){const c={width:"100%",padding:"12px",borderRadius:"8px",border:r?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",transition:"border-color 0.2s",...n&&{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed"},...o};return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("input",{style:c,disabled:n,...l}),r&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:r})]})}function N({children:t,onClick:r,variant:o="primary",disabled:n=!1,fullWidth:l=!1,icon:c,iconPosition:j="left",type:x,style:p,...u}){const m={padding:"10px 20px",borderRadius:"8px",border:"none",fontSize:"14px",fontWeight:"600",cursor:n?"not-allowed":"pointer",transition:"all 0.2s",opacity:n?.6:1,width:l?"100%":"auto",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:o==="primary"||o==="success"||o==="danger"||o==="gradient"?"0 2px 4px rgba(0,0,0,0.1)":"none",...p},s={primary:{background:n?"#cbd5e1":"#2563eb",color:"white"},gradient:{background:n?"#cbd5e1":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",boxShadow:n?"none":"0 4px 12px rgba(102, 126, 234, 0.4)"},secondary:{background:n?"#cbd5e1":"#64748b",color:"white"},success:{background:n?"#cbd5e1":"#10b981",color:"white"},danger:{background:n?"#cbd5e1":"#ef4444",color:"white"},outline:{background:"transparent",color:n?"#cbd5e1":"#2563eb",border:`2px solid ${n?"#cbd5e1":"#2563eb"}`}},b=s[o]||s.primary,I=c&&e.jsx(c,{size:18,strokeWidth:2.5}),W=j==="left"?e.jsxs(e.Fragment,{children:[" ",I," ",t," "]}):e.jsxs(e.Fragment,{children:[" ",t," ",I," "]});return e.jsx("button",{type:x||"button",style:{...m,...b},onClick:n?void 0:r,disabled:n,onMouseOver:h=>{n||(o==="primary"?(h.target.style.background="#1e40af",h.target.style.boxShadow="0 4px 8px rgba(37, 99, 235, 0.3)"):o==="outline"?h.target.style.background="#eff6ff":o==="danger"?(h.target.style.background="#dc2626",h.target.style.boxShadow="0 4px 8px rgba(239, 68, 68, 0.3)"):o==="success"?(h.target.style.background="#059669",h.target.style.boxShadow="0 4px 8px rgba(16, 185, 129, 0.3)"):o==="gradient"&&(h.target.style.background="linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)",h.target.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.5)"))},onMouseOut:h=>{n||(h.target.style.background=b.background,h.target.style.boxShadow=o==="gradient"?"0 4px 12px rgba(102, 126, 234, 0.4)":o==="primary"||o==="success"||o==="danger"?"0 2px 4px rgba(0,0,0,0.1)":"none")},...u,children:W})}function xe(){return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #e2e8f0",borderTop:"4px solid #2563eb",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})}function fe({size:t="medium",showText:r=!0}){const[o,n]=i.useState(null),[l,c]=i.useState(!0),[j,x]=i.useState(!1);i.useEffect(()=>{p();const s=setInterval(p,3e4);return()=>clearInterval(s)},[]);const p=async()=>{try{const s=await T.get("/admin/settings/logo");if(s.data.logoUrl){let b=s.data.logoUrl;b&&!b.startsWith("http")&&!b.startsWith("/")&&(b="/"+b);const I=b.includes("?")?"&":"?";b=b+I+"_t="+Date.now(),n(b),x(!1)}else n(null),x(!1)}catch(s){console.error("Failed to load logo:",s),x(!0)}finally{c(!1)}},u={small:{width:"80px",height:"40px"},medium:{width:"120px",height:"60px"},large:{width:"180px",height:"90px"}},m=u[t]||u.medium;return l?null:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[o&&!j?e.jsx("img",{src:o,alt:"Logo",style:{...m,objectFit:"contain",maxWidth:"100%"},onError:s=>{console.error("Failed to load logo image:",o),x(!0),n(null)}}):e.jsx("div",{style:{...m,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",color:"white",fontWeight:"700",fontSize:t==="small"?"14px":t==="large"?"24px":"18px"},children:"Q"}),r&&e.jsx("span",{style:{fontSize:t==="small"?"18px":t==="large"?"28px":"24px",fontWeight:"700",color:"#1e293b"}})]})}const Bt=[{value:"REGULAR",label:"Regular"},{value:"SENIOR_CITIZEN",label:"Senior Citizen"},{value:"PWD",label:"PWD"},{value:"PREGNANT",label:"Pregnant"}];function Et(){var A;const t=ge(),[r,o]=i.useState(!0),[n,l]=i.useState(!1),[c,j]=i.useState([]),[x,p]=i.useState({clientName:"",clientType:"REGULAR",categoryIds:[],subCategoryIds:[]}),[u,m]=i.useState({});i.useEffect(()=>{s()},[]);const s=async()=>{var d;try{const f=await T.get("/categories");j(Array.isArray((d=f.data)==null?void 0:d.categories)?f.data.categories:[])}catch(f){console.error("Failed to load categories:",f)}finally{o(!1)}},b=i.useMemo(()=>{var z;if(!((z=x.categoryIds)!=null&&z.length))return[];const d=(c||[]).filter(D=>x.categoryIds.includes(D.id)),f=new Map;return d.forEach(D=>{(D.subCategories||[]).forEach(P=>{f.has(P.id)||f.set(P.id,{...P,categoryName:D.name})})}),Array.from(f.values())},[x.categoryIds,c]),I=d=>{const f=x.categoryIds||[],z=f.includes(d)?f.filter(H=>H!==d):[...f,d],D=(c||[]).filter(H=>z.includes(H.id)),P=new Set;D.forEach(H=>{(H.subCategories||[]).forEach(Y=>P.add(Y.id))}),p({...x,categoryIds:z,subCategoryIds:(x.subCategoryIds||[]).filter(H=>P.has(H))})},W=d=>{const f=x.subCategoryIds||[],z=f.includes(d)?f.filter(D=>D!==d):[...f,d];p({...x,subCategoryIds:z})},h=async d=>{var z,D,P,H;d.preventDefault(),m({});const f={};if(x.clientName.trim()||(f.clientName="Name is required"),(z=x.categoryIds)!=null&&z.length||(f.categoryId="Select at least one category"),Object.keys(f).length>0){m(f);return}l(!0);try{const G=(await T.post("/queue/join",{clientName:x.clientName.trim(),clientType:x.clientType,categoryIds:x.categoryIds,subCategoryIds:(D=x.subCategoryIds)!=null&&D.length?x.subCategoryIds:void 0})).data.queueEntry,ae=(G.concernCategories||[G.category]).map(X=>X.name).join(", "),Q=(G.concernSubCategories||[]).map(X=>X.name).join(", ")||null;ot({queueNumber:G.queueNumber,clientName:G.clientName,date:G.date,category:ae,subCategory:Q,clientType:G.clientType,status:G.status}),t("/success")}catch(Y){console.error("Failed to join queue:",Y),m({submit:((H=(P=Y.response)==null?void 0:P.data)==null?void 0:H.error)||"Failed to join queue"})}finally{l(!1)}};return r?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{})}):e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(fe,{size:"medium"})}),e.jsx("h1",{style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Join Queue"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Fill in your details to get a queue number"}),e.jsxs("form",{onSubmit:h,children:[e.jsx(ne,{label:"Your Name",value:x.clientName,onChange:d=>p({...x,clientName:d.target.value}),error:u.clientName,placeholder:"Enter your full name",required:!0}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Client Type"}),e.jsx("div",{className:"client-type-pills",children:Bt.map(({value:d,label:f})=>e.jsxs("label",{className:`pill-radio ${x.clientType===d?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"clientType",value:d,checked:x.clientType===d,onChange:()=>p({...x,clientType:d})}),e.jsx("span",{children:f})]},d))})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:["Concern Category ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),u.categoryId&&e.jsx("div",{style:{fontSize:"12px",color:"#ef4444",marginBottom:"8px"},children:u.categoryId}),e.jsx("div",{className:"checkbox-group",children:(c||[]).map(d=>e.jsxs("label",{className:`checkbox-row ${(x.categoryIds||[]).includes(d.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(x.categoryIds||[]).includes(d.id),onChange:()=>I(d.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:d.name})]},d.id))})]}),b.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Sub-Concern (Optional)"}),e.jsx("div",{className:"checkbox-group",children:b.map(d=>e.jsxs("label",{className:`checkbox-row ${(x.subCategoryIds||[]).includes(d.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(x.subCategoryIds||[]).includes(d.id),onChange:()=>W(d.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:d.name})]},d.id))})]}),u.submit&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:u.submit}),e.jsx(N,{type:"submit",variant:"gradient",fullWidth:!0,disabled:n||!x.clientType||!((A=x.categoryIds)!=null&&A.length),style:{marginTop:"8px",padding:"14px 24px",fontSize:"16px"},children:n?"Joining...":"Join Queue"})]}),e.jsx("div",{style:{marginTop:"24px",textAlign:"center"},children:e.jsx("a",{href:"/monitor",style:{color:"#2563eb",textDecoration:"none",fontSize:"14px"},children:"View Queue Status â†’"})})]})})}function Pe(t){if(!t)return"";const r=t.split("-");return r.length>1?r[1]:t}function Nt(t){return t?t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "):""}function it({window:t}){const{label:r,staff:o,currentServing:n}=t,l=p=>{const u=p.trim().split(" ");return u.length>=2?(u[0][0]+u[u.length-1][0]).toUpperCase():p.substring(0,2).toUpperCase()},c=(o==null?void 0:o.name)||"â€”",j=n?Pe(n.queueNumber):null,x=n&&[n.clientName||"",n.clientType?`(${Nt(n.clientType)})`:""].filter(Boolean).join(" ").trim()||null;return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",border:"2px solid #e2e8f0",transition:"all 0.2s",display:"flex",alignItems:"stretch",gap:"20px",minHeight:"180px"},children:[e.jsx("div",{style:{flex:"0 0 38%",maxWidth:"200px",borderRadius:"12px",overflow:"hidden",background:o!=null&&o.profilePicture?void 0:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:o!=null&&o.profilePicture?e.jsx("img",{src:o.profilePicture,alt:c,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):e.jsx("span",{style:{color:"white",fontWeight:"700",fontSize:"32px"},children:l(c)})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[e.jsx("div",{style:{fontSize:"26px",fontWeight:"700",color:"#1e293b",marginBottom:"4px"},children:c}),n?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:"22px",fontWeight:"700",color:"#1e293b",marginBottom:"8px"},children:"is now serving:"}),e.jsx("div",{style:{fontSize:"clamp(48px, 8vw, 84px)",fontWeight:"700",color:"#1e293b",lineHeight:1.1,marginBottom:"8px"},children:j}),x&&e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#475569",marginBottom:"8px"},children:x})]}):e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#94a3b8",fontStyle:"italic"},children:"No active service"}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"12px",fontSize:"32px",fontWeight:"700",color:"#1e293b"},children:r})]})]})}function st({clientType:t}){const r={REGULAR:{bg:"#e2e8f0",color:"#475569"},SENIOR_CITIZEN:{bg:"#fef3c7",color:"#92400e"},PWD:{bg:"#dbeafe",color:"#1e40af"},PREGNANT:{bg:"#fce7f3",color:"#9f1239"}},o={REGULAR:"Regular",SENIOR_CITIZEN:"Senior",PWD:"PWD",PREGNANT:"Pregnant"},n=r[t]||r.REGULAR;return e.jsx("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:n.bg,color:n.color},children:o[t]})}function Lt(){const t=ge(),[r,o]=i.useState(null),[n,l]=i.useState([]),[c,j]=i.useState(!0),[x,p]=i.useState(0);i.useEffect(()=>{const b=Ae();if(!b){t("/");return}o(b),u();const I=setInterval(u,2e3);return()=>clearInterval(I)},[t]),i.useEffect(()=>{(r==null?void 0:r.status)==="SERVED"&&t("/thank-you")},[r==null?void 0:r.status,t]);const u=async()=>{var b;try{const I=Ae()||r;if(I!=null&&I.queueNumber){const A=(await T.get(`/queue/${I.queueNumber}`)).data.queueEntry,d={...I,status:A.status};if(o(d),ot(d),A.status==="SERVED"){t("/thank-you");return}if(A.status==="WAITING")try{const f=await T.get(`/queue/${I.queueNumber}/ahead`);p(f.data.peopleAhead||0)}catch{const z=await T.get("/queue/public/stats");p(z.data.waiting||0)}else p(0)}const W=await T.get("/queue/public/windows");l(W.data.windows)}catch(I){console.error("Failed to load data:",I),((b=I.response)==null?void 0:b.status)===404&&(Ie(),t("/"))}finally{j(!1)}};if(c||!r)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{})});const m={WAITING:{bg:"#fef3c7",color:"#92400e",text:"Waiting"},NOW_SERVING:{bg:"#dbeafe",color:"#1e40af",text:"Being served"},SERVED:{bg:"#d1fae5",color:"#065f46",text:"Served"},SKIPPED:{bg:"#fee2e2",color:"#991b1b",text:"Skipped"}},s=m[r.status]||m.WAITING;return e.jsx("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"20px"},children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(fe,{size:"medium"})}),e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:["Hello, ",r.clientName]}),e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",color:"#2563eb",marginBottom:"16px",letterSpacing:"2px"},children:Pe(r.queueNumber)}),e.jsx("div",{style:{display:"inline-block",padding:"8px 16px",borderRadius:"20px",backgroundColor:s.bg,color:s.color,fontSize:"14px",fontWeight:"600",marginBottom:"16px"},children:s.text}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(st,{clientType:r.clientType}),e.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:"#e2e8f0",color:"#475569"},children:[r.category,r.subCategory&&` - ${r.subCategory}`]})]}),r.status==="WAITING"&&x>0&&e.jsxs("div",{style:{marginTop:"16px",fontSize:"14px",color:"#64748b"},children:["Approximately ",x," ",x===1?"person":"people"," ahead"]}),e.jsx("div",{style:{marginTop:"24px",padding:"16px",background:"#f1f5f9",borderRadius:"8px",fontSize:"14px",color:"#475569"},children:"ðŸ’¡ You can leave and monitor your queue status from this page. We'll update automatically."})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px",color:"#1e293b"},children:"Active Windows"}),e.jsx("div",{className:"grid-responsive",style:{display:"grid",gap:"16px"},children:n.length>0?n.map(b=>e.jsx(it,{window:b},b.id)):e.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"40px",background:"white",borderRadius:"12px",color:"#64748b"},children:"No active windows at the moment"})})]})]})})}function Ot(){const t=ge();i.useEffect(()=>{const o=Ae();if(!o||o.status!=="SERVED"){t("/");return}const n=setTimeout(()=>{Ie()},5e3);return()=>clearTimeout(n)},[t]);const r=Ae();return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"48px",maxWidth:"600px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(fe,{size:"medium"})}),e.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:"âœ…"}),e.jsx("h1",{style:{fontSize:"32px",fontWeight:"700",marginBottom:"16px",color:"#1e293b"},children:"Thank You!"}),r&&e.jsxs("p",{style:{fontSize:"18px",color:"#64748b",marginBottom:"24px"},children:["Thank you, ",e.jsx("strong",{children:r.clientName}),", for your visit."]}),e.jsx("p",{style:{fontSize:"16px",color:"#475569",marginBottom:"32px",lineHeight:"1.6"},children:"We appreciate your business and look forward to serving you again."}),e.jsx("div",{style:{padding:"20px",background:"#f1f5f9",borderRadius:"12px",marginBottom:"32px"},children:e.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Your service has been completed. Have a wonderful day!"})}),e.jsx("button",{onClick:()=>{Ie(),t("/")},style:{padding:"12px 32px",borderRadius:"8px",border:"none",background:"#2563eb",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:o=>{o.target.style.background="#1e40af"},onMouseOut:o=>{o.target.style.background="#2563eb"},children:"Return to Home"})]})})}function Ft(){const[t,r]=i.useState([]),[o,n]=i.useState([]),[l,c]=i.useState(null),[j,x]=i.useState(!0),[p,u]=i.useState(!1),m=i.useRef(null),s=i.useRef([]),b=i.useRef(!1),I=i.useRef([]),W=i.useRef(!1),h=i.useRef(null),A=i.useRef(0),d=8e3,[f,z]=i.useState(null),D=i.useRef(null),P=i.useRef(!1),H=i.useRef(null);i.useEffect(()=>{Y(),G();const w=setInterval(Y,2e3);return()=>clearInterval(w)},[]),i.useEffect(()=>{R()},[]),i.useEffect(()=>{o.length>0&&!l&&c(o[0])},[o,l]),i.useEffect(()=>{if(m.current&&l){const w=m.current,a=()=>{const O=(o.findIndex(q=>q.url===l.url)+1)%o.length;c(o[O])};w.addEventListener("ended",a),w.volume=1,w.load();const g=w.play();return g!==void 0&&g.then(()=>{w.muted=!1}).catch(()=>{w.muted=!0,w.play().catch(console.error)}),()=>{w.removeEventListener("ended",a)}}},[l,o]);const Y=async()=>{try{const a=(await T.get("/queue/public/windows")).data.windows||[],g=s.current;r(a),s.current=a,setTimeout(()=>{try{$(g,a)}catch(B){console.error("Failed to run TTS announcements:",B)}},0)}catch(w){console.error("Failed to load windows:",w)}finally{x(!1)}},G=async()=>{try{const a=(await T.get("/admin/settings/ding-sound")).data.dingSoundUrl||null;z(a),D.current=a}catch(w){console.error("Failed to load ding sound URL:",w),z(null),D.current=null}},ae=w=>{if(typeof window>"u"){console.log("playDing: window undefined"),w&&setTimeout(w,7e3);return}console.log("playDing: starting");let g=!1,B=null;B=setTimeout(()=>{if(!g&&(console.warn("playDing: Ultimate timeout reached, forcing safeDone"),g=!0,w))try{w()}catch(q){console.error("playDing: Error in onDone callback:",q)}},7e3);const O=()=>{if(g){console.log("playDing: safeDone called but already done");return}if(g=!0,B&&(clearTimeout(B),B=null),console.log("playDing: done - calling onDone callback"),w)try{w()}catch(q){console.error("playDing: Error in onDone callback:",q)}else console.warn("playDing: No onDone callback provided")};try{const q=D.current||f;if(q&&typeof q=="string"){const _=q.startsWith("http")?q:`${window.location.origin}${q.startsWith("/")?"":"/"}${q}`;console.log("playDing: Using custom ding sound:",_);const C=new Audio(_);C.volume=1;let ee=!1;const te=()=>{if(g)return;console.log("playDing: Trying synthesized chime fallback");const v=window.AudioContext||window.webkitAudioContext;if(!v){console.warn("playDing: No AudioContext available"),O();return}let k=H.current;if(!k)try{k=new v,k.state,H.current=k}catch(E){console.warn("playDing: Cannot create AudioContext (needs user gesture):",E),g||O();return}if(!k){console.warn("playDing: No AudioContext available"),g||O();return}const F=()=>{if(!g)try{console.log("playDing: Playing synthesized chime");const E=k.createOscillator(),oe=k.createOscillator(),ce=k.createGain();E.type="sine",oe.type="sine";const le=k.currentTime;E.frequency.setValueAtTime(880,le),oe.frequency.setValueAtTime(1175,le+.08),E.connect(ce),oe.connect(ce),ce.connect(k.destination),ce.gain.setValueAtTime(1e-4,le),ce.gain.exponentialRampToValueAtTime(.25,le+.03),ce.gain.exponentialRampToValueAtTime(1e-4,le+.4),E.start(le),oe.start(le+.08),E.stop(le+.4),oe.stop(le+.4),setTimeout(()=>{g||(console.log("playDing: Synthesized chime finished"),O())},500)}catch(E){console.error("playDing: Failed to play chime:",E),g||O()}};k.state==="suspended"&&k.resume?k.resume().then(()=>{g||F()}).catch(E=>{console.warn("playDing: AudioContext resume failed:",E),g||O()}):F()},Z=()=>{if(g)return;console.log("playDing: Audio ended event fired, currentTime:",C.currentTime,"duration:",C.duration),C.removeEventListener("ended",Z),C.removeEventListener("error",J),C.removeEventListener("canplaythrough",se),C.removeEventListener("loadeddata",se),C.currentTime>=Math.min(.1,C.duration*.1)||C.duration===0?(console.log("playDing: Custom ding played successfully"),ee=!0,O()):(console.warn("playDing: Custom ding ended immediately, trying fallback chime"),te())},J=v=>{console.error("Failed to play custom ding sound:",v),C.removeEventListener("ended",Z),C.removeEventListener("error",J),C.removeEventListener("canplaythrough",se),C.removeEventListener("loadeddata",se),te()},de=()=>{console.log("playDing: Audio ready, attempting to play, readyState:",C.readyState,"duration:",C.duration,"currentTime:",C.currentTime),C.currentTime=0,setTimeout(()=>{const v=C.play();v!==void 0?v.then(()=>{console.log("playDing: Audio playing successfully, paused:",C.paused,"currentTime:",C.currentTime,"duration:",C.duration),setTimeout(()=>{C.paused&&!g&&!ee?(console.warn("playDing: Audio paused after play() promise resolved, may be blocked by autoplay policy. Will try fallback chime."),J(new Error("Autoplay blocked"))):C.paused||console.log("playDing: Audio confirmed playing, currentTime:",C.currentTime)},100)}).catch(k=>{console.error("Failed to start custom ding sound:",k),J(k)}):(console.warn("playDing: play() returned undefined"),setTimeout(()=>{C.paused&&!g&&!ee&&(console.warn("playDing: Audio is paused after play(), treating as error. Will try fallback chime."),J(new Error("Audio did not start playing")))},100))},10)},se=()=>{C.removeEventListener("canplaythrough",se),C.removeEventListener("loadeddata",se),de()};C.addEventListener("ended",Z),C.addEventListener("error",J),C.readyState>=2?(console.log("playDing: Audio already loaded, playing immediately"),de()):(C.addEventListener("canplaythrough",se),C.addEventListener("loadeddata",se),C.load()),setTimeout(()=>{!g&&!ee&&(console.warn("playDing: Custom ding timeout (2s), trying fallback chime"),C.removeEventListener("ended",Z),C.removeEventListener("error",J),C.removeEventListener("canplaythrough",se),C.removeEventListener("loadeddata",se),te())},2e3);return}const V=window.AudioContext||window.webkitAudioContext;if(V){const _=H.current||new V,C=()=>{console.log("playDing: Playing synthesized chime");const ee=_.createOscillator(),te=_.createOscillator(),Z=_.createGain();ee.type="sine",te.type="sine";const J=_.currentTime;ee.frequency.setValueAtTime(880,J),te.frequency.setValueAtTime(1175,J+.08),ee.connect(Z),te.connect(Z),Z.connect(_.destination),Z.gain.setValueAtTime(1e-4,J),Z.gain.exponentialRampToValueAtTime(.25,J+.03),Z.gain.exponentialRampToValueAtTime(1e-4,J+.4),ee.start(J),te.start(J+.08),ee.stop(J+.4),te.stop(J+.4),setTimeout(()=>{console.log("playDing: Synthesized chime finished"),O()},500)};_.state==="suspended"&&_.resume?_.resume().then(()=>{C()}).catch(()=>{C()}):C();return}console.warn("playDing: No AudioContext available, cannot play chime"),O()}catch(q){console.error("Failed to play ding sound:",q)}setTimeout(O,7e3)},Q=w=>{const a=m.current;a&&(a.volume=Math.max(0,Math.min(1,w)))},X=(w,a)=>{if(typeof window<"u"&&window.speechSynthesis){window.speechSynthesis.cancel();const g=new SpeechSynthesisUtterance(w);g.lang="en-US",g.rate=1,g.pitch=1,g.onend=a,g.onerror=a,window.speechSynthesis.speak(g)}else a()},re=w=>new Promise(a=>{if(!w||typeof w!="string"||!w.trim()){console.warn("TTS: Empty or invalid text provided"),a();return}T.post("/tts",{text:w},{responseType:"arraybuffer"}).then(g=>{const B=g.headers&&g.headers["content-type"]||"",O=B.includes("audio/")||B.includes("mpeg");if(g.status!==200||!O||!g.data){console.warn("TTS: Invalid response, falling back to speechSynthesis"),X(w,a);return}const q=g.data,V=new Blob([q],{type:"audio/mpeg"}),_=URL.createObjectURL(V),C=new Audio(_);C.volume=1;const ee=()=>{C.src="",C.removeEventListener("ended",te),C.removeEventListener("error",Z),setTimeout(()=>URL.revokeObjectURL(_),100)},te=()=>{ee(),a()},Z=de=>{console.error("TTS audio playback error:",de),ee(),X(w,a)};C.addEventListener("ended",te),C.addEventListener("error",Z);const J=C.play();J!==void 0&&J.catch(de=>{console.error("TTS audio play() failed:",de),ee(),X(w,a)})}).catch(g=>{console.error("TTS API call failed:",g),X(w,a)})}),y=()=>new Promise(w=>ae(w)),S=async()=>{if(W.current){console.log("Already processing announcement, skipping");return}if(I.current.length===0){console.log("No announcements in queue");return}console.log(`Processing announcement, queue length: ${I.current.length}`),W.current=!0;const w=I.current.shift();if(!w){console.log("No item to process"),W.current=!1,I.current.length>0&&S();return}const{text:a}=w;console.log("Starting announcement:",a);try{Q(.5),console.log("Playing ding..."),await y(),console.log("Ding finished, playing TTS..."),await re(a),console.log("TTS finished"),M(w.key)}catch(g){console.error("Announcement playback error:",g)}finally{Q(1),W.current=!1,I.current.length>0&&S()}},$=(w,a)=>{if(typeof window>"u")return;if(!b.current){b.current=!0;return}const g=new Map;(w||[]).forEach(V=>{V&&V.id&&V.currentServing&&g.set(V.id,V.currentServing.queueNumber)});const B=Date.now(),O=new Set(I.current.map(V=>V.key).filter(Boolean)),q=[];(a||[]).forEach(V=>{if(!V||!V.id||!V.currentServing)return;const _=V.currentServing.queueNumber,C=V.currentServing.clientName,ee=g.get(V.id);if(!_||_===ee)return;const te=`${V.id}:${_}`;if(O.has(te)||h.current===te&&B-A.current<d)return;O.add(te);const Z=Pe?Pe(_):_;let J=Z;const de=parseInt(Z,10);Number.isNaN(de)||(J=String(de));const se=V.label||"Window",v=C?`, ${C}`:"",F="Ang atong {{window}},... mu assist na sa kyu number, {{queueNumber}}. {{clientNamePart}}, please proceed to {{window}}.".replace(/{{\s*window\s*}}/gi,se).replace(/{{\s*queueNumber\s*}}/gi,J).replace(/{{\s*clientNamePart\s*}}/gi,v);console.log("Announcement queued:",{windowLabel:se,spokenCounter:J,text:F}),q.push({text:F,key:te})}),q.length>0&&(console.log(`Adding ${q.length} announcement(s) to queue`),q.forEach(V=>I.current.push(V)),S())},M=w=>{w&&(h.current=w,A.current=Date.now())},R=async()=>{try{const w=await T.get("/videos");n(w.data.videos||[]),u(!1)}catch(w){console.error("Failed to load videos:",w),u(!0),n([])}},L=()=>{if(!P.current){P.current=!0;try{const w=window.AudioContext||window.webkitAudioContext;if(w&&!H.current){const a=new w;H.current=a,a.resume&&a.resume()}}catch{}}};return e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:"#f8fafc",overflow:"hidden"},onClick:L,onTouchStart:L,role:"presentation",children:[e.jsx("div",{style:{flex:"0 0 50vh",minHeight:0,overflowY:"auto"},children:e.jsxs("div",{style:{padding:"20px",maxWidth:"1400px",margin:"0 auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px",padding:"8px 0"},children:[e.jsx(fe,{size:"large"}),e.jsx("h1",{style:{fontSize:"28px",fontWeight:"700",color:"#1e293b",margin:0},children:"Queue Monitoring"})]}),j?e.jsx(xe,{}):e.jsx("div",{style:{display:"grid",gap:"16px",marginBottom:"24px"},className:"grid-responsive",children:t.length>0?t.map(w=>e.jsx(it,{window:w},w.id)):e.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"40px",background:"white",borderRadius:"12px",color:"#64748b"},children:"No active windows at the moment"})})]})}),e.jsx("div",{style:{flex:"0 0 50vh",minHeight:0,background:"#1e293b",display:"flex",flexDirection:"column"},children:o.length>0&&!p?e.jsx("div",{style:{flex:1,minHeight:0,position:"relative",background:"#000"},children:e.jsx("video",{ref:m,src:l==null?void 0:l.url,controls:!0,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"contain"}})}):e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"60px 40px",textAlign:"center"},children:[e.jsx("div",{style:{color:"#94a3b8",fontSize:"18px",fontWeight:"500",marginBottom:"8px"},children:"No video playlist set yet"}),e.jsx("div",{style:{color:"#64748b",fontSize:"14px"},children:"Please configure the video folder path in the admin settings"})]})})]})}function Mt(){const t=ge(),[r,o]=i.useState({username:"",password:""}),[n,l]=i.useState(""),[c,j]=i.useState(!1);i.useEffect(()=>{const p=localStorage.getItem("token"),u=me();p&&(u==null?void 0:u.role)==="STAFF"&&t("/staff/dashboard")},[t]);const x=async p=>{var u,m;p.preventDefault(),l(""),j(!0);try{const s=await T.post("/auth/staff/login",r);localStorage.setItem("token",s.data.token),localStorage.setItem("user",JSON.stringify(s.data.user)),t("/staff/dashboard")}catch(s){l(((m=(u=s.response)==null?void 0:u.data)==null?void 0:m.error)||"Login failed")}finally{j(!1)}};return e.jsxs("div",{className:"staff-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .staff-login-root { padding: 16px !important; }
          .staff-login-card { padding: 24px !important; }
          .staff-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"staff-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(fe,{size:"medium"})}),e.jsx("h1",{className:"staff-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Staff Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage your queue"}),e.jsxs("form",{onSubmit:x,children:[e.jsx(ne,{label:"Username",value:r.username,onChange:p=>o({...r,username:p.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(ne,{label:"Password",type:"password",value:r.password,onChange:p=>o({...r,password:p.target.value}),placeholder:"Enter your password",required:!0}),n&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:n}),e.jsx(N,{type:"submit",fullWidth:!0,disabled:c,children:c?"Logging in...":"Login"})]})]})]})}function Be({label:t,error:r,children:o,...n}){return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("select",{style:{width:"100%",padding:"12px",borderRadius:"8px",border:r?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",backgroundColor:"white",cursor:"pointer"},...n,children:o}),r&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:r})]})}function Ut({onProfileClick:t,onLogout:r}){const[o,n]=i.useState(!1),[l,c]=i.useState(null),[j,x]=i.useState(!0),p=i.useRef(null);i.useEffect(()=>{u()},[]),i.useEffect(()=>{const s=b=>{p.current&&!p.current.contains(b.target)&&n(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const u=async()=>{try{const s=await T.get("/staff/profile");c(s.data.staff)}catch(s){console.error("Failed to load profile:",s)}finally{x(!1)}},m=s=>{if(!s)return"?";const b=s.trim().split(" ");return b.length>=2?(b[0][0]+b[b.length-1][0]).toUpperCase():s.substring(0,2).toUpperCase()};return j?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:()=>n(!o),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:l!=null&&l.profilePicture?`url(${l.profilePicture}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:s=>{s.target.style.borderColor="#2563eb",s.target.style.transform="scale(1.05)"},onMouseOut:s=>{s.target.style.borderColor="#e2e8f0",s.target.style.transform="scale(1)"},children:!(l!=null&&l.profilePicture)&&m(l==null?void 0:l.name)}),o&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(l==null?void 0:l.name)||"Staff"}),e.jsxs("button",{onClick:()=>{n(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#f1f5f9"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(_e,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{n(!1),r()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#fee2e2"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(Qe,{size:18}),"Logout"]})]})]})}const $e={success:{icon:Fe,color:"#10b981",bg:"#d1fae5"},error:{icon:ut,color:"#ef4444",bg:"#fee2e2"},warning:{icon:pt,color:"#f59e0b",bg:"#fef3c7"},info:{icon:ct,color:"#2563eb",bg:"#dbeafe"}};let Ht=0;const je=[],Se=[];function rt(t,r="info",o=3e3){const n=Ht++,l={id:n,message:t,type:r,duration:o};return je.push(l),Se.forEach(c=>c([...je])),o>0&&setTimeout(()=>{lt(n)},o),n}function lt(t){const r=je.findIndex(o=>o.id===t);r>-1&&(je.splice(r,1),Se.forEach(o=>o([...je])))}function K(t,r){return rt(t,"success",r)}function U(t,r){return rt(t,"error",r)}function qt(){const[t,r]=i.useState([]);return i.useEffect(()=>{const o=n=>{r(n)};return Se.push(o),r([...je]),()=>{const n=Se.indexOf(o);n>-1&&Se.splice(n,1)}},[]),e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e4,display:"flex",flexDirection:"column",gap:"12px",pointerEvents:"none"},children:[(t||[]).map(o=>{const n=$e[o.type]||$e.info,l=n.icon;return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px 20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:"12px",minWidth:"300px",maxWidth:"400px",pointerEvents:"auto",animation:"slideIn 0.3s ease-out",borderLeft:`4px solid ${n.color}`},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:n.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(l,{size:16,color:n.color})}),e.jsx("div",{style:{flex:1,fontSize:"14px",color:"#1e293b",lineHeight:"1.5"},children:o.message}),e.jsx("button",{onClick:()=>lt(o.id),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",transition:"color 0.2s"},onMouseOver:c=>{c.target.style.color="#1e293b"},onMouseOut:c=>{c.target.style.color="#64748b"},children:e.jsx(ie,{size:18})})]},o.id)}),e.jsx("style",{children:`
        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      `})]})}function be({open:t,title:r,message:o,onConfirm:n,onCancel:l,confirmText:c="Confirm",cancelText:j="Cancel",variant:x="danger"}){if(!t)return null;const p={danger:{confirmBg:"#ef4444",confirmHover:"#dc2626"},warning:{confirmBg:"#f59e0b",confirmHover:"#d97706"},info:{confirmBg:"#2563eb",confirmHover:"#1e40af"}},u=p[x]||p.danger;return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:r}),e.jsx("button",{onClick:l,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ie,{size:20})})]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px",lineHeight:"1.6"},children:o}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:l,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:m=>{m.target.style.background="#f1f5f9",m.target.style.borderColor="#cbd5e1"},onMouseOut:m=>{m.target.style.background="transparent",m.target.style.borderColor="#e2e8f0"},children:j}),e.jsx("button",{onClick:n,style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:u.confirmBg,color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:m=>{m.target.style.background=u.confirmHover,m.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)"},onMouseOut:m=>{m.target.style.background=u.confirmBg,m.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:c})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const Ve=["#2563eb","#10b981","#f59e0b","#ef4444"];function $t(){const t=ge(),[r,o]=i.useState(!0),[n,l]=i.useState(null),[c,j]=i.useState([]),[x,p]=i.useState({}),[u,m]=i.useState([]),[s,b]=i.useState(null),[I,W]=i.useState("today"),[h,A]=i.useState(new Date),[d,f]=i.useState({open:!1,queueEntryId:null}),[z,D]=i.useState(null);i.useEffect(()=>{const a=localStorage.getItem("token"),g=me();if(!a||(g==null?void 0:g.role)!=="STAFF"){t("/staff/login");return}P(),H();const B=setInterval(P,3e3);return()=>clearInterval(B)},[t]),i.useEffect(()=>{I&&Y()},[I]),i.useEffect(()=>{const a=setInterval(()=>A(new Date),1e3);return()=>clearInterval(a)},[]);const P=async()=>{var a;try{const g=await T.get("/staff/dashboard");l(g.data.window),j(g.data.queue||[]),p(g.data.stats||{})}catch(g){console.error("Failed to load dashboard:",g),((a=g.response)==null?void 0:a.status)===401&&t("/staff/login")}finally{o(!1)}},H=async()=>{try{const a=await T.get("/windows/active");m(a.data.windows||[])}catch(a){console.error("Failed to load windows:",a)}},Y=async()=>{try{let a,g;const B=new Date;if(I==="today")a=B.toISOString().split("T")[0],g=a;else if(I==="yesterday"){const q=new Date(B);q.setDate(q.getDate()-1),a=q.toISOString().split("T")[0],g=a}else a=B.toISOString().split("T")[0],g=a;const O=await T.get(`/staff/analytics?startDate=${a}&endDate=${g}`);b(O.data)}catch(a){console.error("Failed to load analytics:",a)}},G=async a=>{var g,B;try{await T.post("/staff/assign-window",{windowId:a}),P(),H()}catch(O){console.error("Failed to assign window:",O),alert(((B=(g=O.response)==null?void 0:g.data)==null?void 0:B.error)||"Failed to assign window")}},ae=async a=>{var g,B,O,q,V,_;if(!z){D(a);try{const ee=(g=(await T.post(`/staff/serve/${a}`)).data)==null?void 0:g.queueEntry;ee?j(te=>te.map(Z=>Z.id===a?ee:Z)):P()}catch(C){console.error("Failed to start serving:",C),((B=C.response)==null?void 0:B.status)===409?(U(((q=(O=C.response)==null?void 0:O.data)==null?void 0:q.error)||"Client was already claimed. Refreshing..."),P()):U(((_=(V=C.response)==null?void 0:V.data)==null?void 0:_.error)||"Failed to start serving")}finally{D(null)}}},Q=async a=>{var g,B;try{await T.post(`/staff/complete/${a}`),P(),Y()}catch(O){console.error("Failed to complete:",O),alert(((B=(g=O.response)==null?void 0:g.data)==null?void 0:B.error)||"Failed to complete")}},X=a=>{f({open:!0,queueEntryId:a})},re=async()=>{var g,B;const{queueEntryId:a}=d;if(f({open:!1,queueEntryId:null}),!!a)try{await T.post(`/staff/skip/${a}`),P(),Y(),K("Client marked as skipped")}catch(O){console.error("Failed to skip:",O),U(((B=(g=O.response)==null?void 0:g.data)==null?void 0:B.error)||"Failed to skip")}},y=async()=>{try{await T.get("/staff/dashboard").then(g=>g.data.window)&&await T.post("/staff/assign-window",{windowId:null})}catch(a){console.error("Error deactivating window on logout:",a)}localStorage.removeItem("token"),localStorage.removeItem("user"),t("/staff/login")},S=()=>{t("/staff/profile")};if(r)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{})});const $=c.filter(a=>["SENIOR_CITIZEN","PWD","PREGNANT"].includes(a.clientType)),M=c.filter(a=>a.clientType==="REGULAR"),R=s!=null&&s.byCategory?Object.entries(s.byCategory).map(([a,g])=>({name:a,value:g})):[],L=s!=null&&s.byClientType?Object.entries(s.byClientType).map(([a,g])=>({name:a,value:g})):[],w=a=>{const g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],B=["January","February","March","April","May","June","July","August","September","October","November","December"],O=g[a.getDay()],q=B[a.getMonth()],V=a.getDate(),_=a.getFullYear();let C=a.getHours();const ee=String(a.getMinutes()).padStart(2,"0"),te=String(a.getSeconds()).padStart(2,"0"),Z=C>=12?"PM":"AM";return C=C%12,C=C||12,`${O}, ${q} ${V}, ${_} at ${C}:${ee}:${te} ${Z}`};return e.jsxs(e.Fragment,{children:[e.jsx(be,{open:d.open,title:"Skip Client",message:"Mark this client as skipped? They will be removed from the queue and not counted as served.",confirmText:"Skip",cancelText:"Cancel",variant:"warning",onConfirm:re,onCancel:()=>f({open:!1,queueEntryId:null})}),e.jsx("style",{children:`
        .staff-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .staff-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        .queue-item-buttons button {
          min-height: 44px;
        }
        @media (max-width: 768px) {
          .staff-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-dashboard-header > div:first-child {
            width: 100%;
            flex-direction: column;
            align-items: flex-start !important;
            gap: 8px !important;
          }
          .staff-dashboard-header-center {
            width: 100%;
            text-align: left;
          }
          .staff-dashboard-main-grid {
            grid-template-columns: 1fr !important;
          }
          .staff-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .queue-item-grid {
            grid-template-columns: 1fr !important;
            gap: 12px !important;
          }
          .queue-item-buttons {
            flex-direction: row !important;
            width: 100% !important;
            flex-wrap: wrap;
          }
          .queue-item-buttons button {
            flex: 1;
            min-width: 120px;
          }
          .staff-window-assign-grid {
            grid-template-columns: 1fr !important;
          }
        }
        @media (max-width: 480px) {
          .queue-item-buttons {
            flex-direction: column !important;
          }
          .queue-item-buttons button {
            min-width: 100%;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .staff-dashboard-main-grid {
            grid-template-columns: 60% 40% !important;
          }
        }
      `}),e.jsxs("div",{className:"staff-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsxs("div",{className:"staff-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px",flex:1},children:[e.jsx(fe,{size:"small"}),n&&e.jsxs("div",{className:"staff-dashboard-header-center",style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:["Operating: ",n.label]})]}),e.jsx(Ut,{onProfileClick:S,onLogout:y})]}),e.jsxs("div",{className:"staff-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:w(h)})}),!n&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Assign Window"}),e.jsx("div",{className:"staff-window-assign-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"12px"},children:u.map(a=>e.jsx(N,{onClick:()=>G(a.id),variant:"outline",children:a.label},a.id))})]}),e.jsxs("div",{className:"staff-dashboard-main-grid",style:{display:"grid",gridTemplateColumns:"75% 25%",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"20px"},children:["Queue (",c.length,")"]}),$.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#f59e0b",marginBottom:"12px"},children:"Priority Clients"}),$.map(a=>e.jsx(Ye,{entry:a,onServe:ae,onComplete:Q,onSkip:X,servingId:z},a.id))]}),M.length>0&&e.jsxs("div",{children:[$.length>0&&e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#64748b",marginBottom:"12px"},children:"Regular Clients"}),M.map(a=>e.jsx(Ye,{entry:a,onServe:ae,onComplete:Q,onSkip:X,servingId:z},a.id))]}),c.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#94a3b8"},children:"No clients in queue"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"In Queue"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#f59e0b"},children:c.length})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Total Served Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2563eb"},children:x.totalServed||0})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Skipped Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#ef4444"},children:x.totalSkipped||0})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Analytics"}),e.jsxs(Be,{value:I,onChange:a=>W(a.target.value),style:{width:"100%"},children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"yesterday",children:"Yesterday"})]})]}),s&&e.jsxs(e.Fragment,{children:[R.length>0&&e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Category"}),e.jsx(we,{width:"100%",height:200,children:e.jsxs(Le,{data:R,children:[e.jsx(De,{strokeDasharray:"3 3"}),e.jsx(ze,{dataKey:"name"}),e.jsx(We,{}),e.jsx(ve,{}),e.jsx(Oe,{dataKey:"value",fill:"#2563eb"})]})})]}),L.length>0&&e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Client Type"}),e.jsx(we,{width:"100%",height:200,children:e.jsxs(tt,{children:[e.jsx(nt,{data:L,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:g})=>`${a}: ${(g*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:L.map((a,g)=>e.jsx(at,{fill:Ve[g%Ve.length]},`cell-${g}`))}),e.jsx(ve,{})]})})]})]})]})]})]})]})]})]})}function Ye({entry:t,onServe:r,onComplete:o,onSkip:n,servingId:l}){var x,p,u;const c=t.status==="NOW_SERVING",j=l===t.id;return e.jsxs("div",{className:"queue-item-grid",style:{padding:"16px",border:c?"2px solid #2563eb":"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"12px",background:c?"#eff6ff":"white",display:"grid",gridTemplateColumns:"1fr auto",gap:"20px",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"700",color:"#2563eb",marginBottom:"4px"},children:t.queueNumber}),e.jsx("div",{style:{fontSize:"14px",color:"#1e293b",marginBottom:"4px"},children:t.clientName}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px",flexWrap:"wrap"},children:[e.jsx(st,{clientType:t.clientType}),e.jsxs("span",{style:{fontSize:"12px",color:"#64748b"},children:[((x=t.concernCategories)!=null&&x.length?t.concernCategories:t.category?[t.category]:[]).map(m=>m==null?void 0:m.name).filter(Boolean).join(", "),((p=t.concernSubCategories)!=null&&p.length?t.concernSubCategories:t.subCategory?[t.subCategory]:[]).map(m=>m==null?void 0:m.name).filter(Boolean).length>0&&` - ${((u=t.concernSubCategories)!=null&&u.length?t.concernSubCategories:[t.subCategory]).map(m=>m==null?void 0:m.name).filter(Boolean).join(", ")}`]})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8"},children:["Joined: ",new Date(t.joinedAt).toLocaleTimeString()]})]}),e.jsxs("div",{className:"queue-item-buttons",style:{display:"flex",gap:"8px",flexDirection:"column"},children:[c?e.jsx(N,{variant:"success",icon:Fe,onClick:()=>o(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Mark as Served"}):e.jsx(N,{variant:"primary",icon:gt,onClick:()=>r(t.id),disabled:j,style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:j?"Serving...":"Start Serving"}),e.jsx(N,{variant:"danger",icon:xt,onClick:()=>n(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Skip"})]})]})}function Vt(){const t=ge(),[r,o]=i.useState(!0),[n,l]=i.useState(!1),[c,j]=i.useState(null),[x,p]=i.useState(null),[u,m]=i.useState(null),[s,b]=i.useState(!1),[I,W]=i.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[h,A]=i.useState(!1),[d,f]=i.useState(null),[z,D]=i.useState([]),[P,H]=i.useState(""),[Y,G]=i.useState(!1);i.useEffect(()=>{const R=localStorage.getItem("token"),L=me();if(!R||(L==null?void 0:L.role)!=="STAFF"){t("/staff/login");return}ae()},[t]);const ae=async()=>{var R;try{const L=await T.get("/staff/profile");j(L.data.staff),p(L.data.staff.profilePicture);const w=L.data.currentWindow||null;f(w),H((w==null?void 0:w.id)||"")}catch(L){console.error("Failed to load profile:",L),((R=L.response)==null?void 0:R.status)===401&&t("/staff/login")}finally{o(!1)}},Q=async()=>{try{const R=await T.get("/windows/active");D(R.data.windows||[])}catch(R){console.error("Failed to load windows:",R)}};i.useEffect(()=>{Q()},[]);const X=async R=>{var L,w;if(R.preventDefault(),!P||P===(d==null?void 0:d.id)){P===(d==null?void 0:d.id)&&U("You are already assigned to this window");return}G(!0);try{await T.post("/staff/assign-window",{windowId:P});const a=z.find(g=>g.id===P);f(a?{id:a.id,label:a.label}:null),K("Window changed successfully. You are now operating at "+((a==null?void 0:a.label)||"the selected window")+".")}catch(a){console.error("Failed to switch window:",a),U(((w=(L=a.response)==null?void 0:L.data)==null?void 0:w.error)||"Failed to switch window")}finally{G(!1)}},re=R=>{const L=R.target.files[0];if(L){const w=new FileReader;w.onloadend=()=>{m(w.result)},w.readAsDataURL(L),p(L)}},y=async R=>{var L,w;R.preventDefault(),l(!0);try{if(await T.put("/staff/profile",{name:c.name}),x instanceof File){const a=new FormData;a.append("picture",x);const g=await T.post("/staff/profile/picture",a,{headers:{"Content-Type":"multipart/form-data"}});p(g.data.profilePicture),m(null)}K("Profile updated successfully!"),t("/staff/dashboard")}catch(a){console.error("Failed to update profile:",a),U(((w=(L=a.response)==null?void 0:L.data)==null?void 0:w.error)||"Failed to update profile")}finally{l(!1)}},S=async R=>{var L,w;if(R.preventDefault(),I.newPassword!==I.confirmPassword){U("New passwords do not match");return}if(I.newPassword.length<6){U("Password must be at least 6 characters");return}A(!0);try{await T.post("/staff/profile/change-password",{currentPassword:I.currentPassword,newPassword:I.newPassword}),K("Password changed successfully!"),b(!1),W({currentPassword:"",newPassword:"",confirmPassword:""})}catch(a){console.error("Failed to change password:",a),U(((w=(L=a.response)==null?void 0:L.data)==null?void 0:w.error)||"Failed to change password")}finally{A(!1)}};if(r)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{})});const $=R=>{if(!R)return"?";const L=R.trim().split(" ");return L.length>=2?(L[0][0]+L[L.length-1][0]).toUpperCase():R.substring(0,2).toUpperCase()},M=u||(c!=null&&c.profilePicture?c.profilePicture:null);return e.jsxs("div",{className:"staff-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .staff-profile-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        @media (max-width: 768px) {
          .staff-profile-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-content {
            margin: 24px auto !important;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-card {
            padding: 24px !important;
          }
          .staff-profile-buttons {
            flex-direction: column !important;
          }
          .staff-profile-buttons button {
            width: 100%;
          }
        }
      `}),e.jsxs("div",{className:"staff-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(fe,{size:"small"}),e.jsx(N,{variant:"outline",icon:Je,onClick:()=>t("/staff/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"staff-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"staff-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"32px",color:"#1e293b"},children:"My Profile"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{style:{marginBottom:"32px",textAlign:"center"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",margin:"0 auto 16px",border:"3px solid #e2e8f0",background:M?`url(${M}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"36px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:!M&&$(c==null?void 0:c.name)}),e.jsxs("label",{style:{display:"inline-block",padding:"8px 16px",background:"#2563eb",color:"white",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s"},onMouseOver:R=>{R.target.style.background="#1e40af"},onMouseOut:R=>{R.target.style.background="#2563eb"},children:["Change Picture",e.jsx("input",{type:"file",accept:"image/*",onChange:re,style:{display:"none"}})]}),e.jsx("p",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"JPG, PNG, GIF, WebP (max 2MB)"})]}),e.jsx(ne,{label:"Name",value:(c==null?void 0:c.name)||"",onChange:R=>j({...c,name:R.target.value}),required:!0}),e.jsx(ne,{label:"Username",value:(c==null?void 0:c.username)||"",disabled:!0,readOnly:!0}),e.jsxs("div",{className:"staff-profile-buttons",style:{display:"flex",gap:"12px",marginTop:"24px"},children:[e.jsx(N,{type:"submit",icon:Ke,disabled:n,fullWidth:!0,children:n?"Saving...":"Save Changes"}),e.jsx(N,{variant:"outline",icon:ie,onClick:()=>t("/staff/dashboard"),fullWidth:!0,children:"Cancel"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Ee,{size:20}),"Operating window"]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"12px"},children:d?`You are currently at ${d.label}.`:"You are not assigned to a window yet."}),e.jsxs("form",{onSubmit:X,style:{display:"flex",flexDirection:"row",gap:"12px",alignItems:"flex-end",flexWrap:"wrap",maxWidth:"420px"},children:[e.jsx("div",{style:{flex:"1 1 200px"},children:e.jsxs(Be,{label:"Switch to window",value:P,onChange:R=>H(R.target.value),children:[e.jsx("option",{value:"",children:"â€” Select window â€”"}),z.map(R=>e.jsx("option",{value:R.id,children:R.label},R.id))]})}),e.jsx(N,{type:"submit",icon:Ee,disabled:Y||!P||P===(d==null?void 0:d.id),style:{flexShrink:0},children:Y?"Switching...":"Switch window"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(N,{variant:"outline",icon:Me,onClick:()=>{b(!s),s&&W({currentPassword:"",newPassword:"",confirmPassword:""})},children:s?"Cancel":"Change Password"})]}),s&&e.jsxs("form",{onSubmit:S,children:[e.jsx(ne,{label:"Current Password",type:"password",value:I.currentPassword,onChange:R=>W({...I,currentPassword:R.target.value}),required:!0}),e.jsx(ne,{label:"New Password",type:"password",value:I.newPassword,onChange:R=>W({...I,newPassword:R.target.value}),required:!0}),e.jsx(ne,{label:"Confirm New Password",type:"password",value:I.confirmPassword,onChange:R=>W({...I,confirmPassword:R.target.value}),required:!0}),e.jsx(N,{type:"submit",icon:Xe,disabled:h,fullWidth:!0,style:{marginTop:"16px"},children:h?"Changing...":"Change Password"})]})]})]})})]})}function Yt(){const t=ge(),[r,o]=i.useState({username:"",password:""}),[n,l]=i.useState(""),[c,j]=i.useState(!1);i.useEffect(()=>{const p=localStorage.getItem("token"),u=me();p&&(u==null?void 0:u.role)==="ADMIN"&&t("/admin/dashboard")},[t]);const x=async p=>{var u,m;p.preventDefault(),l(""),j(!0);try{const s=await T.post("/auth/admin/login",r);localStorage.setItem("token",s.data.token),localStorage.setItem("user",JSON.stringify(s.data.user)),t("/admin/dashboard")}catch(s){l(((m=(u=s.response)==null?void 0:u.data)==null?void 0:m.error)||"Login failed")}finally{j(!1)}};return e.jsxs("div",{className:"admin-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .admin-login-root { padding: 16px !important; }
          .admin-login-card { padding: 24px !important; }
          .admin-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"admin-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(fe,{size:"medium"})}),e.jsx("h1",{className:"admin-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Admin Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage the system"}),e.jsxs("form",{onSubmit:x,children:[e.jsx(ne,{label:"Username",value:r.username,onChange:p=>o({...r,username:p.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(ne,{label:"Password",type:"password",value:r.password,onChange:p=>o({...r,password:p.target.value}),placeholder:"Enter your password",required:!0}),n&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:n}),e.jsx(N,{type:"submit",fullWidth:!0,disabled:c,children:c?"Logging in...":"Login"})]})]})]})}function Gt({onProfileClick:t,onLogout:r}){const[o,n]=i.useState(!1),[l,c]=i.useState(null),[j,x]=i.useState(!0),p=i.useRef(null);ge(),i.useEffect(()=>{u()},[]),i.useEffect(()=>{const s=b=>{p.current&&!p.current.contains(b.target)&&n(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const u=async()=>{try{const s=me();s&&c({name:s.name||"Admin",username:s.username})}catch(s){console.error("Failed to load profile:",s)}finally{x(!1)}},m=s=>{if(!s)return"A";const b=s.trim().split(" ");return b.length>=2?(b[0][0]+b[b.length-1][0]).toUpperCase():s.substring(0,2).toUpperCase()};return j?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:()=>n(!o),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:s=>{s.target.style.borderColor="#2563eb",s.target.style.transform="scale(1.05)"},onMouseOut:s=>{s.target.style.borderColor="#e2e8f0",s.target.style.transform="scale(1)"},children:m(l==null?void 0:l.name)}),o&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(l==null?void 0:l.name)||(l==null?void 0:l.username)||"Admin"}),t&&e.jsxs("button",{onClick:()=>{n(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#f1f5f9"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(_e,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{n(!1),r()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#fee2e2"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(Qe,{size:18}),"Logout"]})]})]})}function _t({open:t,title:r,message:o,placeholder:n="",onConfirm:l,onCancel:c,confirmText:j="Confirm",cancelText:x="Cancel",type:p="text",required:u=!0}){const[m,s]=i.useState("");if(i.useEffect(()=>{t&&s("")},[t]),!t)return null;const b=()=>{u&&!m.trim()||(l(m),s(""))},I=()=>{s(""),c()};return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:r}),e.jsx("button",{onClick:I,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ie,{size:20})})]}),o&&e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px",lineHeight:"1.6"},children:o}),e.jsx("input",{type:p,value:m,onChange:W=>s(W.target.value),placeholder:n,required:u,style:{width:"100%",padding:"10px 12px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px",marginBottom:"24px",transition:"border-color 0.2s"},onFocus:W=>{W.target.style.borderColor="#2563eb"},onBlur:W=>{W.target.style.borderColor="#e2e8f0"},onKeyDown:W=>{W.key==="Enter"?b():W.key==="Escape"&&I()},autoFocus:!0}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:I,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:W=>{W.target.style.background="#f1f5f9",W.target.style.borderColor="#cbd5e1"},onMouseOut:W=>{W.target.style.background="transparent",W.target.style.borderColor="#e2e8f0"},children:x}),e.jsx("button",{onClick:b,disabled:u&&!m.trim(),style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:u&&!m.trim()?"#cbd5e1":"#2563eb",color:"white",fontSize:"14px",fontWeight:"600",cursor:u&&!m.trim()?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:W=>{u&&!m.trim()||(W.target.style.background="#1e40af",W.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)")},onMouseOut:W=>{u&&!m.trim()||(W.target.style.background="#2563eb",W.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)")},children:j})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const Ge=["#2563eb","#10b981","#f59e0b","#ef4444","#8b5cf6"];function ye(t,r){var n;const o=(n=t==null?void 0:t.response)==null?void 0:n.data;if(o!=null&&o.error&&typeof o.error=="string")return o.error;if(Array.isArray(o==null?void 0:o.errors)&&o.errors.length>0){const l=o.errors[0];return(l==null?void 0:l.msg)||(l==null?void 0:l.message)||r}return r}function Qt(){const t=ge(),[r,o]=i.useState("dashboard"),[n,l]=i.useState(!0),[c,j]=i.useState(null),[x,p]=i.useState([]),[u,m]=i.useState([]),[s,b]=i.useState([]),[I,W]=i.useState(null),[h,A]=i.useState({startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""}),[d,f]=i.useState(!1),[z,D]=i.useState({open:!1,data:{}}),[P,H]=i.useState({open:!1,data:{}}),[Y,G]=i.useState({open:!1,data:{}}),[ae,Q]=i.useState({open:!1,data:{}}),[X,re]=i.useState({open:!1,title:"",message:"",placeholder:"",type:"text",onConfirm:()=>{},onCancel:()=>{}});i.useEffect(()=>{const a=localStorage.getItem("token"),g=me();if(!a||(g==null?void 0:g.role)!=="ADMIN"){t("/admin/login");return}y();const B=setInterval(()=>{r==="dashboard"&&S()},3e3);return()=>clearInterval(B)},[t,r]),i.useEffect(()=>{r==="reports"&&L()},[r,h]);const y=async()=>{try{await Promise.all([S(),$(),M(),R()])}catch(a){console.error("Error loading data:",a)}finally{l(!1)}},S=async()=>{try{const a=await T.get("/admin/dashboard");j(a.data.stats)}catch(a){console.error("Failed to load dashboard:",a)}},$=async()=>{try{const a=await T.get("/admin/staff");p(a.data.staff)}catch(a){console.error("Failed to load staff:",a)}},M=async()=>{try{const a=await T.get("/admin/windows");m(a.data.windows)}catch(a){console.error("Failed to load windows:",a)}},R=async()=>{try{const a=await T.get("/categories");b(a.data.categories)}catch(a){console.error("Failed to load categories:",a)}},L=async()=>{try{const a=new URLSearchParams;a.append("startDate",h.startDate),a.append("endDate",h.endDate),h.staffIds&&h.staffIds.length>0&&h.staffIds.forEach(B=>a.append("staffId",B)),h.categoryIds&&h.categoryIds.length>0&&h.categoryIds.forEach(B=>a.append("categoryId",B)),h.clientTypes&&h.clientTypes.length>0&&h.clientTypes.forEach(B=>a.append("clientType",B)),h.startHour&&a.append("startHour",h.startHour),h.endHour&&a.append("endHour",h.endHour);const g=await T.get(`/admin/reports?${a.toString()}`);W(g.data)}catch(a){console.error("Failed to load reports:",a)}},w=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t("/admin/login")};return n?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .admin-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .admin-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        @media (max-width: 768px) {
          .admin-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-dashboard-header > div:first-child {
            flex-direction: row;
            align-items: center;
            gap: 12px;
          }
          .admin-dashboard-header h1 {
            font-size: 20px !important;
          }
          .admin-dashboard-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
          }
          .admin-dashboard-tabs button {
            white-space: nowrap;
            font-size: 13px;
            padding: 10px 16px !important;
            min-height: 44px;
            flex-shrink: 0;
          }
          .admin-dashboard-tabs button span {
            display: none;
          }
          .admin-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-stats-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-reports-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-filter-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-page-header {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 12px;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) !important;
          }
          .admin-modal-overlay {
            padding: 16px;
            align-items: flex-start;
            overflow-y: auto;
          }
          .admin-modal-box {
            max-height: calc(100vh - 32px);
            overflow-y: auto;
            width: 100%;
            margin: auto;
          }
          .admin-settings-buttons {
            flex-wrap: wrap;
          }
          .admin-settings-buttons button {
            min-width: 140px;
          }
          .admin-reports-table-wrap {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -16px;
            padding: 0 16px;
          }
        }
        @media (max-width: 480px) {
          .admin-stats-grid,
          .admin-stats-grid-4,
          .admin-cards-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-dashboard-tabs button {
            padding: 12px 14px !important;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(3, 1fr) !important;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 16px;
          }
        }
      `}),e.jsxs("div",{className:"admin-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx(_t,{...X}),e.jsxs("div",{className:"admin-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px",flex:1},children:[e.jsx(fe,{size:"small"}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:"#1e293b",margin:0},children:"Admin Dashboard"})]}),e.jsx(Gt,{onProfileClick:()=>t("/admin/profile"),onLogout:w})]}),e.jsx("div",{className:"admin-dashboard-tabs",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"0 24px",display:"flex",gap:"4px"},children:[{id:"dashboard",label:"Dashboard",icon:ft},{id:"staff",label:"Staff",icon:ht},{id:"windows",label:"Windows",icon:Ze},{id:"categories",label:"Categories",icon:et},{id:"reports",label:"Reports",icon:mt},{id:"settings",label:"Settings",icon:yt}].map(a=>{const g=a.icon,B=r===a.id;return e.jsxs("button",{onClick:()=>o(a.id),style:{padding:"12px 20px",border:"none",background:B?"#eff6ff":"transparent",borderBottom:B?"3px solid #2563eb":"3px solid transparent",color:B?"#2563eb":"#64748b",fontWeight:B?"600":"400",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s",borderRadius:"8px 8px 0 0"},onMouseOver:O=>{B||(O.target.style.background="#f1f5f9",O.target.style.color="#475569")},onMouseOut:O=>{B||(O.target.style.background="transparent",O.target.style.color="#64748b")},children:[e.jsx(g,{size:18}),e.jsx("span",{children:a.label})]},a.id)})}),e.jsxs("div",{className:"admin-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[r==="dashboard"&&e.jsx(Jt,{stats:c}),r==="staff"&&e.jsx(Kt,{staff:x,categories:s,onRefresh:$,form:z,setForm:D,setInputDialog:re}),r==="windows"&&e.jsx(Xt,{windows:u,onRefresh:M,form:P,setForm:H}),r==="categories"&&e.jsx(Zt,{categories:s,onRefresh:R,categoryForm:Y,setCategoryForm:G,subCategoryForm:ae,setSubCategoryForm:Q}),r==="reports"&&e.jsx(en,{reports:I,filters:h,setFilters:A,staff:x,categories:s,showFilters:d,setShowFilters:f,onRefresh:L}),r==="settings"&&e.jsx(tn,{})]})]})]})}function Jt({stats:t}){const[r,o]=i.useState(new Date);if(i.useEffect(()=>{const l=setInterval(()=>{o(new Date)},1e3);return()=>clearInterval(l)},[]),!t)return e.jsx(xe,{});const n=l=>{const c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["January","February","March","April","May","June","July","August","September","October","November","December"],x=c[l.getDay()],p=j[l.getMonth()],u=l.getDate(),m=l.getFullYear();let s=l.getHours();const b=String(l.getMinutes()).padStart(2,"0"),I=String(l.getSeconds()).padStart(2,"0"),W=s>=12?"PM":"AM";return s=s%12,s=s||12,`${x}, ${p} ${u}, ${m} at ${s}:${b}:${I} ${W}`};return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:n(r)})}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"16px"},children:[e.jsx(ue,{label:"Queue Entries Today",value:t.todayQueueEntries,icon:bt,color:"#2563eb"}),e.jsx(ue,{label:"Serving",value:t.servingCount,icon:wt,color:"#2563eb"}),e.jsx(ue,{label:"Waiting",value:t.waitingCount,icon:vt,color:"#f59e0b"}),e.jsx(ue,{label:"Served Today",value:t.todayServed,icon:Fe,color:"#10b981"})]}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsx(ue,{label:"Active Windows",value:t.activeWindows,icon:Ee,color:"#10b981"}),e.jsx(ue,{label:"Active Staff",value:t.activeStaff,icon:jt,color:"#10b981"}),e.jsx(ue,{label:"Total Windows",value:t.totalWindows,icon:St,color:"#2563eb"}),e.jsx(ue,{label:"Total Staff",value:t.totalStaff,icon:Ct,color:"#2563eb"})]})]})}function ue({label:t,value:r,color:o="#2563eb",icon:n}){return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[n&&e.jsx(n,{size:20,color:o,style:{flexShrink:0}}),e.jsx("div",{style:{fontSize:"14px",color:"#64748b",fontWeight:"500"},children:t})]}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:o,lineHeight:"1.2"},children:r||0})]})}function Kt({staff:t,categories:r,onRefresh:o,form:n,setForm:l,setInputDialog:c}){const[j,x]=i.useState(null),[p,u]=i.useState(!1),m=i.useRef(null),[s,b]=i.useState({open:!1});i.useEffect(()=>{const d=f=>{m.current&&!m.current.contains(f.target)&&u(!1)};return p&&document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[p]);const I=async d=>{d.preventDefault();try{await T.post("/admin/staff",n.data),l({open:!1,data:{}}),K("Staff created successfully!"),o()}catch(f){U(ye(f,"Failed to create staff"))}},W=async d=>{d.preventDefault();try{await T.put(`/admin/staff/${j.id}`,n.data),l({open:!1,data:{}}),x(null),K("Staff updated successfully!"),o()}catch(f){U(ye(f,"Failed to update staff"))}},h=async(d,f)=>{try{await T.put(`/admin/staff/${d}`,{isActive:!f}),K(`Staff ${f?"deactivated":"activated"} successfully!`),o()}catch(z){U(ye(z,"Failed to update staff"))}},A=async(d,f)=>{c({open:!0,title:"Reset Password",message:`Enter new password for ${f}:`,placeholder:"New password (min 6 characters)",type:"password",onConfirm:async z=>{var D,P;if(c({open:!1}),!!z){if(z.length<6){U("Password must be at least 6 characters");return}try{await T.post(`/admin/staff/${d}/reset-password`,{password:z}),K("Password reset successfully!")}catch(H){U(((P=(D=H.response)==null?void 0:D.data)==null?void 0:P.error)||"Failed to reset password")}}},onCancel:()=>c({open:!1})})};return e.jsxs("div",{children:[e.jsx(be,{...s}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Staff Management"}),e.jsx(N,{onClick:()=>{l({open:!0,data:{}}),x(null)},children:"Add Staff"})]}),n.open&&Ce.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{l({open:!1,data:{}}),x(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:j?"Edit Staff":"Create Staff"}),e.jsx("button",{onClick:()=>{l({open:!1,data:{}}),x(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ie,{size:20})})]}),e.jsxs("form",{onSubmit:j?W:I,children:[e.jsx(ne,{label:"Username",value:n.data.username||"",onChange:d=>l({...n,data:{...n.data,username:d.target.value}}),required:!j,disabled:!!j}),e.jsx(ne,{label:"Name",value:n.data.name||"",onChange:d=>l({...n,data:{...n.data,name:d.target.value}}),required:!0}),(!j||n.data.password)&&e.jsx(ne,{label:"Password",type:"password",value:n.data.password||"",onChange:d=>l({...n,data:{...n.data,password:d.target.value}}),required:!j}),e.jsxs("div",{style:{marginBottom:"16px",position:"relative"},ref:m,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Specializations (Categories)"}),e.jsx("div",{onClick:()=>u(!p),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:n.data.categoryIds&&n.data.categoryIds.length>0?n.data.categoryIds.map(d=>{const f=r.find(z=>z.id===d);return f?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:z=>{z.stopPropagation(),l({...n,data:{...n.data,categoryIds:n.data.categoryIds.filter(D=>D!==d)}})},children:[f.name,e.jsx(ie,{size:12})]},d):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),p&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:r.map(d=>{var z;const f=((z=n.data.categoryIds)==null?void 0:z.includes(d.id))||!1;return e.jsxs("div",{onClick:()=>{const D=n.data.categoryIds||[];l(f?{...n,data:{...n.data,categoryIds:D.filter(P=>P!==d.id)}}:{...n,data:{...n.data,categoryIds:[...D,d.id]}})},style:{padding:"10px 12px",cursor:"pointer",background:f?"#eff6ff":"white",color:f?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:D=>{f||(D.currentTarget.style.background="#f8fafc")},onMouseOut:D=>{f||(D.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:f,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:d.name})]},d.id)})})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(N,{variant:"outline",icon:ie,onClick:()=>{l({open:!1,data:{}}),x(null)},children:"Cancel"}),e.jsx(N,{type:"submit",icon:ke,children:j?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(d=>{const f=d.name?d.name.split(" ").map(D=>D[0]).join("").toUpperCase().slice(0,2):d.username.charAt(0).toUpperCase(),z=d.specializations?d.specializations.map(D=>D.category.name):[];return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:d.profilePictureUrl?"transparent":"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",marginBottom:"8px",border:d.profilePictureUrl?"2px solid #e2e8f0":"none"},children:d.profilePictureUrl?e.jsx("img",{src:d.profilePictureUrl,alt:d.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("span",{style:{color:"white",fontSize:"28px",fontWeight:"600"},children:f})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:d.name}),e.jsx("div",{style:{fontSize:"12px",color:"#64748b"},children:d.username})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:z.length>0?z.map((D,P)=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:D},P)):e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#f1f5f9",color:"#64748b",fontWeight:"500"},children:"All categories"})}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:d.isActive?"#ecfdf5":"#fef2f2",color:d.isActive?"#059669":"#dc2626",fontWeight:"600"},children:d.isActive?"Active":"Inactive"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{x(d),l({open:!0,data:{username:d.username,name:d.name,categoryIds:d.specializations?d.specializations.map(D=>D.categoryId):[]}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"25%"},onMouseOver:D=>{D.target.style.background="#eff6ff"},onMouseOut:D=>{D.target.style.background="transparent"},children:[e.jsx(Ue,{size:14}),"Edit"]}),e.jsxs("button",{onClick:()=>A(d.id,d.name),style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"75%"},onMouseOver:D=>{D.target.style.background="#eff6ff"},onMouseOut:D=>{D.target.style.background="transparent"},children:[e.jsx(Me,{size:14}),"Reset Password"]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",width:"100%"},children:[e.jsx(N,{variant:d.isActive?"danger":"success",icon:kt,onClick:()=>h(d.id,d.isActive),style:{fontSize:"12px",padding:"6px 12px",flex:1},children:d.isActive?"Deactivate":"Activate"}),e.jsx(N,{variant:"danger",icon:Re,onClick:()=>{b({open:!0,title:"Remove Staff",message:`Are you sure you want to remove ${d.name||d.username}? This cannot be undone and is only allowed if the staff has no serving history.`,onConfirm:async()=>{b({open:!1});try{await T.delete(`/admin/staff/${d.id}`),K("Staff removed successfully!"),o()}catch(D){U(ye(D,"Failed to remove staff"))}},onCancel:()=>b({open:!1})})},style:{fontSize:"12px",padding:"6px 12px",flex:1},children:"Remove"})]})]})]},d.id)})})]})}function Xt({windows:t,onRefresh:r,form:o,setForm:n}){const[l,c]=i.useState(null),[j,x]=i.useState({open:!1}),p=async s=>{s.preventDefault();try{await T.post("/admin/windows",o.data),n({open:!1,data:{}}),K("Window created successfully!"),r()}catch(b){U(ye(b,"Failed to create window"))}},u=async s=>{s.preventDefault();try{await T.put(`/admin/windows/${l.id}`,o.data),n({open:!1,data:{}}),c(null),K("Window updated successfully!"),r()}catch(b){U(ye(b,"Failed to update window"))}},m=async s=>{x({open:!0,title:"Delete Window",message:"Are you sure you want to delete this window? This action cannot be undone.",onConfirm:async()=>{x({open:!1});try{await T.delete(`/admin/windows/${s}`),K("Window deleted successfully!"),r()}catch(b){U(ye(b,"Failed to delete window"))}},onCancel:()=>x({open:!1})})};return e.jsxs("div",{children:[e.jsx(be,{...j}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Window Management"}),e.jsx(N,{icon:Ne,onClick:()=>{n({open:!0,data:{isActive:!0}}),c(null)},children:"Add Window"})]}),o.open&&Ce.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{n({open:!1,data:{}}),c(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:l?"Edit Window":"Create Window"}),e.jsx("button",{onClick:()=>{n({open:!1,data:{}}),c(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ie,{size:20})})]}),e.jsxs("form",{onSubmit:l?u:p,children:[e.jsx(ne,{label:"Window Label",value:o.data.label||"",onChange:s=>n({...o,data:{...o.data,label:s.target.value}}),required:!0}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[e.jsx("input",{type:"checkbox",checked:o.data.isActive!==!1,onChange:s=>n({...o,data:{...o.data,isActive:s.target.checked}})}),"Active"]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(N,{variant:"outline",icon:ie,onClick:()=>{n({open:!1,data:{}}),c(null)},children:"Cancel"}),e.jsx(N,{type:"submit",icon:ke,children:l?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(s=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(Ze,{size:40,color:"white"})}),e.jsx("div",{style:{textAlign:"center",marginBottom:"8px"},children:e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:s.label})}),s.assignments&&s.assignments.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:s.assignments.map(b=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:b.staff.name},b.id))}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:s.isActive?"#ecfdf5":"#fef2f2",color:s.isActive?"#059669":"#dc2626",fontWeight:"600"},children:s.isActive?"Active":"Inactive"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{c(s),n({open:!0,data:{label:s.label,isActive:s.isActive}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:b=>{b.target.style.background="#eff6ff"},onMouseOut:b=>{b.target.style.background="transparent"},children:[e.jsx(Ue,{size:14}),"Edit"]}),e.jsx(N,{variant:"danger",icon:Re,onClick:()=>m(s.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})})]},s.id))})]})}function Zt({categories:t,onRefresh:r,categoryForm:o,setCategoryForm:n,subCategoryForm:l,setSubCategoryForm:c}){const[j,x]=i.useState(null),[p,u]=i.useState({open:!1}),m=async h=>{var A,d;h.preventDefault();try{await T.post("/admin/categories",o.data),n({open:!1,data:{}}),K("Category created successfully!"),r()}catch(f){U(((d=(A=f.response)==null?void 0:A.data)==null?void 0:d.error)||"Failed to create category")}},s=async h=>{var A,d;h.preventDefault();try{await T.put(`/admin/categories/${j.id}`,o.data),n({open:!1,data:{}}),x(null),K("Category updated successfully!"),r()}catch(f){U(((d=(A=f.response)==null?void 0:A.data)==null?void 0:d.error)||"Failed to update category")}},b=async h=>{u({open:!0,title:"Delete Category",message:"Are you sure you want to delete this category? All subcategories will be deleted. This action cannot be undone.",onConfirm:async()=>{var A,d;u({open:!1});try{await T.delete(`/admin/categories/${h}`),K("Category deleted successfully!"),r()}catch(f){U(((d=(A=f.response)==null?void 0:A.data)==null?void 0:d.error)||"Failed to delete category")}},onCancel:()=>u({open:!1})})},I=async h=>{var A,d;h.preventDefault();try{await T.post(`/admin/categories/${l.data.categoryId}/subcategories`,{name:l.data.name,description:l.data.description}),c({open:!1,data:{}}),K("Subcategory created successfully!"),r()}catch(f){U(((d=(A=f.response)==null?void 0:A.data)==null?void 0:d.error)||"Failed to create subcategory")}},W=async h=>{u({open:!0,title:"Delete Subcategory",message:"Are you sure you want to delete this subcategory? This action cannot be undone.",onConfirm:async()=>{var A,d;u({open:!1});try{await T.delete(`/admin/subcategories/${h}`),K("Subcategory deleted successfully!"),r()}catch(f){U(((d=(A=f.response)==null?void 0:A.data)==null?void 0:d.error)||"Failed to delete subcategory")}},onCancel:()=>u({open:!1})})};return e.jsxs("div",{children:[e.jsx(be,{...p}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Category Management"}),e.jsx(N,{icon:Ne,onClick:()=>{n({open:!0,data:{}}),x(null)},children:"Add Category"})]}),o.open&&Ce.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{n({open:!1,data:{}}),x(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:j?"Edit Category":"Create Category"}),e.jsx("button",{onClick:()=>{n({open:!1,data:{}}),x(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ie,{size:20})})]}),e.jsxs("form",{onSubmit:j?s:m,children:[e.jsx(ne,{label:"Category Name",value:o.data.name||"",onChange:h=>n({...o,data:{...o.data,name:h.target.value}}),required:!0}),e.jsx(ne,{label:"Description (Optional)",value:o.data.description||"",onChange:h=>n({...o,data:{...o.data,description:h.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(N,{variant:"outline",icon:ie,onClick:()=>{n({open:!1,data:{}}),x(null)},children:"Cancel"}),e.jsx(N,{type:"submit",icon:ke,children:j?"Update":"Create"})]})]})]})}),document.body),l.open&&Ce.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{c({open:!1,data:{}})},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Add Subcategory"}),e.jsx("button",{onClick:()=>{c({open:!1,data:{}})},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ie,{size:20})})]}),e.jsxs("form",{onSubmit:I,children:[e.jsx(ne,{label:"Subcategory Name",value:l.data.name||"",onChange:h=>c({...l,data:{...l.data,name:h.target.value}}),required:!0}),e.jsx(ne,{label:"Description (Optional)",value:l.data.description||"",onChange:h=>c({...l,data:{...l.data,description:h.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(N,{variant:"outline",icon:ie,onClick:()=>{c({open:!1,data:{}})},children:"Cancel"}),e.jsx(N,{type:"submit",icon:ke,children:"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(h=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#10b981",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(et,{size:40,color:"white"})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:h.name}),h.description&&e.jsx("div",{style:{fontSize:"12px",color:"#64748b",lineHeight:"1.4"},children:h.description})]}),h.subCategories&&h.subCategories.length>0&&e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"600"},children:[h.subCategories.length," Subcategor",h.subCategories.length===1?"y":"ies"]})}),h.subCategories&&h.subCategories.length>0&&e.jsx("div",{style:{width:"100%",marginBottom:"8px",maxHeight:"120px",overflowY:"auto",padding:"8px",background:"#f8fafc",borderRadius:"8px"},children:h.subCategories.map(A=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",marginBottom:"4px",background:"white",borderRadius:"6px",fontSize:"12px"},children:[e.jsx("span",{style:{fontWeight:"500",color:"#1e293b"},children:A.name}),e.jsx("button",{onClick:()=>W(A.id),style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"2px 6px",fontSize:"12px",borderRadius:"4px"},onMouseOver:d=>{d.target.style.background="#fee2e2"},onMouseOut:d=>{d.target.style.background="transparent"},children:e.jsx(Re,{size:12})})]},A.id))}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsx(N,{variant:"outline",icon:Ne,onClick:()=>{c({open:!0,data:{categoryId:h.id,name:"",description:""}})},style:{fontSize:"12px",padding:"6px 12px",width:"100%"},children:"Add Subcategory"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{x(h),n({open:!0,data:{name:h.name,description:h.description||""}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:A=>{A.target.style.background="#eff6ff"},onMouseOut:A=>{A.target.style.background="transparent"},children:[e.jsx(Ue,{size:14}),"Edit"]}),e.jsx(N,{variant:"danger",icon:Re,onClick:()=>b(h.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})]})]},h.id))})]})}function en({reports:t,filters:r,setFilters:o,staff:n,categories:l,showFilters:c,setShowFilters:j,onRefresh:x}){const[p,u]=i.useState(r),[m,s]=i.useState(!1),[b,I]=i.useState(!1),[W,h]=i.useState(!1),A=i.useRef(null),d=i.useRef(null),f=i.useRef(null);i.useEffect(()=>{c&&u(r)},[c]),i.useEffect(()=>{const y=S=>{A.current&&!A.current.contains(S.target)&&s(!1),d.current&&!d.current.contains(S.target)&&I(!1),f.current&&!f.current.contains(S.target)&&h(!1)};return(m||b||W)&&document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[m,b,W]);const z=["REGULAR","SENIOR_CITIZEN","PWD","PREGNANT"],D=Array.from({length:24},(y,S)=>S),P=()=>{const y=new Date().toISOString().split("T")[0],S={startDate:y,endDate:y,staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""};o(S),u(S)},H=()=>{o(p),j(!1)},Y=()=>{u(r),j(!1)},G=r.staffIds.length>0||r.categoryIds.length>0||r.clientTypes.length>0||r.startHour||r.endHour;if(!t)return e.jsx(xe,{});const ae=t.byCategory?Object.entries(t.byCategory).map(([y,S])=>({name:y,value:S})):[],Q=t.byClientType?Object.entries(t.byClientType).map(([y,S])=>({name:y,value:S})):[],X=t.byStaff?Object.entries(t.byStaff).map(([y,S])=>({name:y,value:S})):[],re=t.byHour?Object.entries(t.byHour).sort((y,S)=>parseInt(y[0])-parseInt(S[0])).map(([y,S])=>({hour:`${y}:00`,value:S})):[];return e.jsxs("div",{children:[e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Reports & Analytics"}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[G&&e.jsxs("button",{onClick:P,style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontWeight:"500"},onMouseOver:y=>{y.target.style.color="#1e293b"},onMouseOut:y=>{y.target.style.color="#64748b"},children:[e.jsx(ie,{size:16}),"Clear Filters"]}),e.jsxs("button",{onClick:()=>j(!0),style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:G?"#2563eb":"#64748b",fontWeight:"500"},onMouseOver:y=>{y.target.style.color="#2563eb"},onMouseOut:y=>{y.target.style.color=G?"#2563eb":"#64748b"},children:[e.jsx(It,{size:16}),"Filters"]})]})]}),c&&Ce.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:Y,className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"800px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Filter Reports"}),e.jsx("button",{onClick:Y,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ie,{size:20})})]}),e.jsxs("div",{className:"admin-filter-grid",style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 2fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Date"}),e.jsx("input",{type:"date",value:p.startDate,onChange:y=>u({...p,startDate:y.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Date"}),e.jsx("input",{type:"date",value:p.endDate,onChange:y=>u({...p,endDate:y.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{style:{position:"relative"},ref:A,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Staff"}),e.jsx("div",{onClick:()=>s(!m),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.staffIds&&p.staffIds.length>0?p.staffIds.map(y=>{const S=n.find($=>$.id===y);return S?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:$=>{$.stopPropagation(),u({...p,staffIds:p.staffIds.filter(M=>M!==y)})},children:[S.name,e.jsx(ie,{size:12})]},y):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select staff..."})}),m&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:n.map(y=>{var $;const S=(($=p.staffIds)==null?void 0:$.includes(y.id))||!1;return e.jsxs("div",{onClick:()=>{const M=p.staffIds||[];u(S?{...p,staffIds:M.filter(R=>R!==y.id)}:{...p,staffIds:[...M,y.id]})},style:{padding:"10px 12px",cursor:"pointer",background:S?"#eff6ff":"white",color:S?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:M=>{S||(M.currentTarget.style.background="#f8fafc")},onMouseOut:M=>{S||(M.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:S,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:y.name})]},y.id)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{style:{position:"relative"},ref:d,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Categories"}),e.jsx("div",{onClick:()=>I(!b),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.categoryIds&&p.categoryIds.length>0?p.categoryIds.map(y=>{const S=l.find($=>$.id===y);return S?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:$=>{$.stopPropagation(),u({...p,categoryIds:p.categoryIds.filter(M=>M!==y)})},children:[S.name,e.jsx(ie,{size:12})]},y):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),b&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:l.map(y=>{var $;const S=(($=p.categoryIds)==null?void 0:$.includes(y.id))||!1;return e.jsxs("div",{onClick:()=>{const M=p.categoryIds||[];u(S?{...p,categoryIds:M.filter(R=>R!==y.id)}:{...p,categoryIds:[...M,y.id]})},style:{padding:"10px 12px",cursor:"pointer",background:S?"#eff6ff":"white",color:S?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:M=>{S||(M.currentTarget.style.background="#f8fafc")},onMouseOut:M=>{S||(M.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:S,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:y.name})]},y.id)})})]}),e.jsxs("div",{style:{position:"relative"},ref:f,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Client Types"}),e.jsx("div",{onClick:()=>h(!W),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.clientTypes&&p.clientTypes.length>0?p.clientTypes.map(y=>e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:S=>{S.stopPropagation(),u({...p,clientTypes:p.clientTypes.filter($=>$!==y)})},children:[y.replace("_"," "),e.jsx(ie,{size:12})]},y)):e.jsx("span",{style:{color:"#94a3b8"},children:"Select client types..."})}),W&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:z.map(y=>{var $;const S=(($=p.clientTypes)==null?void 0:$.includes(y))||!1;return e.jsxs("div",{onClick:()=>{const M=p.clientTypes||[];u(S?{...p,clientTypes:M.filter(R=>R!==y)}:{...p,clientTypes:[...M,y]})},style:{padding:"10px 12px",cursor:"pointer",background:S?"#eff6ff":"white",color:S?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:M=>{S||(M.currentTarget.style.background="#f8fafc")},onMouseOut:M=>{S||(M.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:S,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:y.replace("_"," ")})]},y)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Hour (Peak Hours)"}),e.jsxs(Be,{value:p.startHour,onChange:y=>u({...p,startHour:y.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),D.map(y=>e.jsxs("option",{value:y,children:[String(y).padStart(2,"0"),":00"]},y))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Hour (Peak Hours)"}),e.jsxs(Be,{value:p.endHour,onChange:y=>u({...p,endHour:y.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),D.map(y=>e.jsxs("option",{value:y,children:[String(y).padStart(2,"0"),":00"]},y))]})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end",marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #e2e8f0"},children:[e.jsx(N,{variant:"outline",icon:ie,onClick:Y,children:"Cancel"}),e.jsx(N,{variant:"primary",icon:ke,onClick:H,children:"Apply Filters"})]})]})}),document.body),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"24px"},children:[e.jsx(ue,{label:"Total Served",value:t.totalServed}),e.jsx(ue,{label:"Average Duration",value:`${Math.floor((t.averageDuration||0)/60)}m ${(t.averageDuration||0)%60}s`})]}),e.jsxs("div",{className:"admin-reports-grid",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"24px"},children:[ae.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Category"}),e.jsx(we,{width:"100%",height:300,children:e.jsxs(Le,{data:ae,children:[e.jsx(De,{strokeDasharray:"3 3"}),e.jsx(ze,{dataKey:"name"}),e.jsx(We,{}),e.jsx(ve,{}),e.jsx(Oe,{dataKey:"value",fill:"#2563eb"})]})})]}),Q.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Client Type"}),e.jsx(we,{width:"100%",height:300,children:e.jsxs(tt,{children:[e.jsx(nt,{data:Q,cx:"50%",cy:"50%",labelLine:!1,label:({name:y,percent:S})=>`${y}: ${(S*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:Q.map((y,S)=>e.jsx(at,{fill:Ge[S%Ge.length]},`cell-${S}`))}),e.jsx(ve,{})]})})]})]}),re.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",marginBottom:"24px"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"Peak Hours"}),e.jsx(we,{width:"100%",height:300,children:e.jsxs(Rt,{data:re,children:[e.jsx(De,{strokeDasharray:"3 3"}),e.jsx(ze,{dataKey:"hour"}),e.jsx(We,{}),e.jsx(ve,{}),e.jsx(At,{type:"monotone",dataKey:"value",stroke:"#2563eb",strokeWidth:2})]})})]}),X.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Staff"}),e.jsx(we,{width:"100%",height:300,children:e.jsxs(Le,{data:X,children:[e.jsx(De,{strokeDasharray:"3 3"}),e.jsx(ze,{dataKey:"name"}),e.jsx(We,{}),e.jsx(ve,{}),e.jsx(Oe,{dataKey:"value",fill:"#10b981"})]})})]})]})}function tn(){const[t,r]=i.useState(null),[o,n]=i.useState(null),[l,c]=i.useState(null),[j,x]=i.useState(!0),[p,u]=i.useState(!1),[m,s]=i.useState({open:!1}),[b,I]=i.useState(null),[W,h]=i.useState(null),[A,d]=i.useState(!1),[f,z]=i.useState({open:!1}),[D,P]=i.useState([{id:"",name:""},{id:"",name:""},{id:"",name:""}]),[H,Y]=i.useState(""),[G,ae]=i.useState(!1),[Q,X]=i.useState(""),[re,y]=i.useState(!1),[S,$]=i.useState("branding"),[M,R]=i.useState({open:!1}),[L,w]=i.useState(!1);i.useEffect(()=>{a(),g(),B(),O()},[]);const a=async()=>{try{const v=await T.get("/admin/settings/logo");v.data.logoUrl&&c(v.data.logoUrl)}catch(v){console.error("Failed to load logo:",v)}finally{x(!1)}},g=async()=>{try{const v=await T.get("/admin/settings/ding-sound");v.data.dingSoundUrl&&h(v.data.dingSoundUrl)}catch(v){console.error("Failed to load ding sound:",v)}},B=async()=>{var v;try{const k=await T.get("/admin/settings/tts-voices"),F=Array.isArray(k.data.voices)?k.data.voices:[],E=[...F];for(;E.length<3;)E.push({id:"",name:""});P(E.slice(0,3)),k.data.activeVoiceId?Y(k.data.activeVoiceId):(v=F[0])!=null&&v.id&&Y(F[0].id)}catch(k){console.error("Failed to load TTS voices:",k)}},O=async()=>{try{const v=await T.get("/admin/settings/video-folder");v.data.videoFolderPath&&X(v.data.videoFolderPath)}catch(v){console.error("Failed to load video folder path:",v)}},q=v=>{const k=v.target.files[0];if(k){r(k);const F=new FileReader;F.onloadend=()=>{n(F.result)},F.readAsDataURL(k)}},V=async v=>{var k,F;if(v.preventDefault(),!!t){u(!0);try{const E=new FormData;E.append("logo",t);const oe=await T.post("/admin/settings/logo",E,{headers:{"Content-Type":"multipart/form-data"}});c(oe.data.logoUrl),r(null),n(null),K("Logo uploaded successfully!")}catch(E){console.error("Failed to upload logo:",E),U(((F=(k=E.response)==null?void 0:k.data)==null?void 0:F.error)||"Failed to upload logo")}finally{u(!1)}}},_=async()=>{s({open:!0,title:"Delete Logo",message:"Are you sure you want to delete the current logo?",onConfirm:async()=>{var v,k;s({open:!1});try{await T.delete("/admin/settings/logo"),c(null),r(null),n(null),K("Logo deleted successfully!")}catch(F){console.error("Failed to delete logo:",F),U(((k=(v=F.response)==null?void 0:v.data)==null?void 0:k.error)||"Failed to delete logo")}},onCancel:()=>s({open:!1})})},C=v=>{const k=v.target.files[0];k&&I(k)},ee=async v=>{var k,F;if(v.preventDefault(),!!b){d(!0);try{const E=new FormData;E.append("sound",b);const oe=await T.post("/admin/settings/ding-sound",E,{headers:{"Content-Type":"multipart/form-data"}});h(oe.data.dingSoundUrl),I(null),K("Ding sound uploaded successfully!")}catch(E){console.error("Failed to upload ding sound:",E),U(((F=(k=E.response)==null?void 0:k.data)==null?void 0:F.error)||"Failed to upload ding sound")}finally{d(!1)}}},te=async()=>{z({open:!0,title:"Delete Ding Sound",message:"Are you sure you want to delete the current ding sound?",onConfirm:async()=>{var v,k;z({open:!1});try{await T.delete("/admin/settings/ding-sound"),h(null),I(null),K("Ding sound deleted successfully!")}catch(F){console.error("Failed to delete ding sound:",F),U(((k=(v=F.response)==null?void 0:v.data)==null?void 0:k.error)||"Failed to delete ding sound")}},onCancel:()=>z({open:!1})})},Z=async v=>{var k,F;if(v.preventDefault(),!Q.trim()){U("Video folder path cannot be empty");return}y(!0);try{await T.post("/admin/settings/video-folder",{videoFolderPath:Q.trim()}),K("Video folder path updated successfully!")}catch(E){console.error("Failed to save video folder path:",E),U(((F=(k=E.response)==null?void 0:k.data)==null?void 0:F.error)||"Failed to save video folder path")}finally{y(!1)}},J=async v=>{const k=typeof v=="string"?v.trim():"";if(!k){U("Please enter a voice ID first");return}const F="Window 1 will now serve number 123, or John Doe.";try{const oe=(await T.post("/tts",{text:F,voiceId:k},{responseType:"arraybuffer"})).data;if(!oe)return;const ce=new Blob([oe],{type:"audio/mpeg"}),le=URL.createObjectURL(ce);new Audio(le).play().catch(he=>{console.error("Failed to play preview TTS audio:",he)}).finally(()=>{URL.revokeObjectURL(le)})}catch(E){console.error("Failed to preview TTS voice:",E),U("Failed to preview this voice. Please check your ElevenLabs settings.")}},de=(v,k,F)=>{P(E=>{const oe=[...E];return oe[v]={...oe[v],[k]:F},oe})},se=async v=>{var k,F;v.preventDefault(),ae(!0);try{const E=D.map(he=>({id:(he.id||"").trim(),name:(he.name||"").trim()})).filter(he=>he.id);if(E.length===0){U("Please enter at least one ElevenLabs voice ID"),ae(!1);return}const oe=H&&E.some(he=>he.id===H)?H:E[0].id,ce=await T.post("/admin/settings/tts-voices",{voices:E,activeVoiceId:oe}),Te=[...Array.isArray(ce.data.voices)?ce.data.voices:E];for(;Te.length<3;)Te.push({id:"",name:""});P(Te.slice(0,3)),Y(ce.data.activeVoiceId||oe),K("TTS voices updated successfully!")}catch(E){console.error("Failed to save TTS voices:",E),U(((F=(k=E.response)==null?void 0:k.data)==null?void 0:F.error)||"Failed to save TTS voices")}finally{ae(!1)}};return j?e.jsx(xe,{}):e.jsxs("div",{children:[e.jsx(be,{...m}),e.jsx(be,{...f}),e.jsx(be,{...M}),e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px"},children:"Settings"}),e.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",borderBottom:"1px solid #e2e8f0",paddingBottom:"4px",overflowX:"auto"},children:[{id:"branding",label:"Branding"},{id:"audio",label:"Audio & TTS"},{id:"videos",label:"Videos"},{id:"data",label:"Data"}].map(v=>{const k=S===v.id;return e.jsx("button",{type:"button",onClick:()=>$(v.id),style:{padding:"8px 16px",borderRadius:"9999px",border:"none",backgroundColor:k?"#1d4ed8":"transparent",color:k?"#ffffff":"#475569",fontSize:"14px",fontWeight:k?600:500,cursor:"pointer",boxShadow:k?"0 1px 3px rgba(15, 23, 42, 0.25)":"none",whiteSpace:"nowrap"},children:v.label},v.id)})}),S==="branding"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #2563eb"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Logo"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a logo to display across all pages. Supported formats: JPG, PNG, GIF, SVG, WebP (max 5MB)"}),l&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Logo:"}),e.jsx("img",{src:l,alt:"Current logo",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("form",{onSubmit:V,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Logo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:q,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),o&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Preview:"}),e.jsx("img",{src:o,alt:"Preview",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(N,{type:"submit",disabled:!t||p,children:p?"Uploading...":"Upload Logo"}),l&&e.jsx(N,{variant:"danger",onClick:_,children:"Delete Logo"})]})]})]})}),S==="audio"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #f97316"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Ding Sound (Announcement Chime)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a short audio file to play before each queue announcement on the public monitoring page. Supported formats: MP3, WAV, OGG, M4A, AAC (max 2MB). Keep it brief (under 2 seconds) for best results."}),W&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Ding Sound:"}),e.jsx("audio",{controls:!0,src:W,style:{width:"100%",maxWidth:"400px"},children:"Your browser does not support the audio element."})]}),e.jsxs("form",{onSubmit:ee,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Ding Sound"}),e.jsx("input",{type:"file",accept:"audio/*",onChange:C,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(N,{type:"submit",disabled:!b||A,children:A?"Uploading...":"Upload Ding Sound"}),W&&e.jsx(N,{variant:"danger",onClick:te,children:"Delete Ding Sound"})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #10b981"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Text-to-Speech Voices (ElevenLabs)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:"Configure up to three ElevenLabs voice IDs and choose which one is active for queue announcements. Voice IDs can be copied from your ElevenLabs dashboard."}),e.jsxs("form",{onSubmit:se,children:[D.map((v,k)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1.2fr) minmax(0, 1.4fr) auto",gap:"12px",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",k+1," Name (optional)"]}),e.jsx("input",{type:"text",value:v.name||"",onChange:F=>de(k,"name",F.target.value),placeholder:"e.g. Front Desk Female",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",k+1," ID"]}),e.jsx("input",{type:"text",value:v.id||"",onChange:F=>de(k,"id",F.target.value),placeholder:"ElevenLabs voice ID",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace"}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"6px"},children:[e.jsx("button",{type:"button",onClick:()=>J(v.id),disabled:!v.id,style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:v.id?"#eff6ff":"#f8fafc",color:v.id?"#2563eb":"#94a3b8",fontSize:"12px",fontWeight:500,cursor:v.id?"pointer":"not-allowed"},children:"Preview Voice"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px"},children:[e.jsx("input",{type:"radio",name:"activeVoice",checked:!!v.id&&H===v.id,disabled:!v.id,onChange:()=>{v.id&&Y(v.id)}}),"Active"]})]})]},k)),e.jsx("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:e.jsx(N,{type:"submit",disabled:G,children:G?"Saving Voices...":"Save Voices"})})]})]})]}),S==="videos"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #6366f1"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Video Folder Path"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Configure the local folder path where video files are stored. The system will scan this folder for video files (mp4, webm, ogg, mov, avi) to play on the public monitoring page."}),e.jsxs("form",{onSubmit:Z,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Video Folder Path"}),e.jsx("input",{type:"text",value:Q,onChange:v=>X(v.target.value),placeholder:"C:\\\\Users\\\\username\\\\videos or /Users/username/videos or videos",style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",backgroundColor:"#f8fafc",color:"#1e293b",transition:"all 0.2s",boxSizing:"border-box"},onFocus:v=>{v.target.style.borderColor="#2563eb",v.target.style.backgroundColor="#ffffff",v.target.style.boxShadow="0 0 0 3px rgba(37, 99, 235, 0.1)"},onBlur:v=>{v.target.style.borderColor="#e2e8f0",v.target.style.backgroundColor="#f8fafc",v.target.style.boxShadow="none"}}),e.jsxs("p",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px",marginBottom:0},children:["Enter an absolute path (Windows: ",e.jsx("code",{style:{fontFamily:"monospace",fontSize:"11px",background:"#f1f5f9",padding:"2px 4px",borderRadius:"4px"},children:"C:\\Users\\username\\videos"})," or Mac/Linux: ",e.jsx("code",{style:{fontFamily:"monospace",fontSize:"11px",background:"#f1f5f9",padding:"2px 4px",borderRadius:"4px"},children:"/Users/username/videos"}),") or a relative path from the backend directory (e.g., ",e.jsx("code",{style:{fontFamily:"monospace",fontSize:"11px",background:"#f1f5f9",padding:"2px 4px",borderRadius:"4px"},children:"videos"}),")"]})]}),e.jsx("div",{style:{display:"flex",gap:"8px"},children:e.jsx(N,{type:"submit",disabled:re||!Q.trim(),children:re?"Saving...":"Save Video Folder Path"})})]})]})}),S==="data"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #dc2626"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Reset queue stats"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Permanently delete all queue entries, serving logs, and daily queue counters. Staff, windows, and categories are not affected. This cannot be undone."}),e.jsx(N,{variant:"danger",disabled:L,onClick:()=>{R({open:!0,title:"Reset all queue stats?",message:"This will delete all queue entries, serving logs, and daily counters. Staff, windows, and categories will be kept. This action cannot be undone.",onConfirm:async()=>{var v,k;R({open:!1}),w(!0);try{await T.post("/admin/settings/reset-queue-stats"),K("Queue stats reset successfully.")}catch(F){U(((k=(v=F.response)==null?void 0:v.data)==null?void 0:k.error)||"Failed to reset queue stats")}finally{w(!1)}},onCancel:()=>R({open:!1})})},children:L?"Resetting...":"Reset queue stats"})]})})]})}function nn(){const t=ge(),[r,o]=i.useState(!0),[n,l]=i.useState(null),[c,j]=i.useState(""),[x,p]=i.useState(!1),[u,m]=i.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[s,b]=i.useState(!1),[I,W]=i.useState(!1);i.useEffect(()=>{const f=localStorage.getItem("token"),z=me();if(!f||(z==null?void 0:z.role)!=="ADMIN"){t("/admin/login");return}h()},[t]),i.useEffect(()=>{j((n==null?void 0:n.name)??"")},[n==null?void 0:n.name]);const h=async()=>{var f;try{const z=await T.get("/admin/profile");l(z.data.admin)}catch(z){console.error("Failed to load profile:",z),((f=z.response)==null?void 0:f.status)===401&&t("/admin/login")}finally{o(!1)}},A=async f=>{var D,P,H,Y,G,ae;f.preventDefault();const z=(c??"").trim();W(!0);try{const Q=await T.put("/admin/profile",{name:z||null});l(Q.data.admin);const X=me();X&&(X.name=Q.data.admin.name??null,localStorage.setItem("user",JSON.stringify(X))),K("Name updated successfully")}catch(Q){U(((P=(D=Q.response)==null?void 0:D.data)==null?void 0:P.error)||((ae=(G=(Y=(H=Q.response)==null?void 0:H.data)==null?void 0:Y.errors)==null?void 0:G[0])==null?void 0:ae.msg)||"Failed to update name")}finally{W(!1)}},d=async f=>{var z,D;if(f.preventDefault(),u.newPassword!==u.confirmPassword){U("New passwords do not match");return}if(u.newPassword.length<6){U("Password must be at least 6 characters");return}b(!0);try{await T.post("/admin/profile/change-password",{currentPassword:u.currentPassword,newPassword:u.newPassword}),K("Password changed successfully!"),p(!1),m({currentPassword:"",newPassword:"",confirmPassword:""})}catch(P){U(((D=(z=P.response)==null?void 0:z.data)==null?void 0:D.error)||"Failed to change password")}finally{b(!1)}};return r?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(xe,{})}):e.jsxs("div",{className:"admin-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .admin-profile-root { padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right); }
        @media (max-width: 768px) {
          .admin-profile-header { flex-wrap: wrap; gap: 12px; padding: 12px 16px !important; }
          .admin-profile-content { margin: 24px auto !important; padding: 0 16px !important; }
          .admin-profile-card { padding: 24px !important; }
        }
      `}),e.jsxs("div",{className:"admin-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(fe,{size:"small"}),e.jsx(N,{variant:"outline",icon:Je,onClick:()=>t("/admin/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"admin-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"admin-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"24px",color:"#1e293b"},children:"Admin Profile"}),e.jsxs("form",{onSubmit:A,children:[e.jsx(ne,{label:"Name",value:c,onChange:f=>j(f.target.value),placeholder:"Your display name"}),e.jsx(N,{type:"submit",icon:Ke,disabled:I,style:{marginTop:"16px"},children:I?"Saving...":"Save name"})]}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsx(ne,{label:"Username",value:(n==null?void 0:n.username)||"",disabled:!0,readOnly:!0,style:{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed",border:"2px solid #e2e8f0",borderRadius:"8px",padding:"12px"}})}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(N,{variant:"outline",icon:Me,onClick:()=>{p(!x),x&&m({currentPassword:"",newPassword:"",confirmPassword:""})},children:x?"Cancel":"Change Password"})]}),x&&e.jsxs("form",{onSubmit:d,children:[e.jsx(ne,{label:"Current Password",type:"password",value:u.currentPassword,onChange:f=>m({...u,currentPassword:f.target.value}),required:!0}),e.jsx(ne,{label:"New Password",type:"password",value:u.newPassword,onChange:f=>m({...u,newPassword:f.target.value}),required:!0}),e.jsx(ne,{label:"Confirm New Password",type:"password",value:u.confirmPassword,onChange:f=>m({...u,confirmPassword:f.target.value}),required:!0}),e.jsx(N,{type:"submit",icon:Xe,disabled:s,style:{marginTop:"16px"},children:s?"Changing...":"Change Password"})]})]})]})})]})}function an(){return i.useEffect(()=>{let t=document.querySelector('link[rel="icon"]');t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t));const r=c=>{const j=c&&!c.startsWith("http")&&!c.startsWith("data:")?c.startsWith("/")?window.location.origin+c:window.location.origin+"/"+c:c;t.href=j},o="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23667eea' rx='12'/%3E%3Ctext x='50' y='68' font-size='60' font-weight='bold' dominant-baseline='middle' text-anchor='middle' fill='white' font-family='system-ui,sans-serif'%3EQ%3C/text%3E%3C/svg%3E",n=async()=>{var c;try{const j=await T.get("/admin/settings/logo");(c=j.data)!=null&&c.logoUrl?r(j.data.logoUrl):r(o)}catch{r(o)}};n();const l=setInterval(n,3e4);return()=>clearInterval(l)},[]),null}function on(){return e.jsxs(e.Fragment,{children:[e.jsx(an,{}),e.jsx(qt,{}),e.jsxs(Tt,{children:[e.jsx(pe,{path:"/",element:e.jsx(Et,{})}),e.jsx(pe,{path:"/success",element:e.jsx(Lt,{})}),e.jsx(pe,{path:"/thank-you",element:e.jsx(Ot,{})}),e.jsx(pe,{path:"/monitor",element:e.jsx(Ft,{})}),e.jsx(pe,{path:"/staff/login",element:e.jsx(Mt,{})}),e.jsx(pe,{path:"/staff/dashboard",element:e.jsx($t,{})}),e.jsx(pe,{path:"/staff/profile",element:e.jsx(Vt,{})}),e.jsx(pe,{path:"/admin/login",element:e.jsx(Yt,{})}),e.jsx(pe,{path:"/admin/dashboard",element:e.jsx(Qt,{})}),e.jsx(pe,{path:"/admin/profile",element:e.jsx(nn,{})})]})]})}Dt.createRoot(document.getElementById("root")).render(e.jsx(zt.StrictMode,{children:e.jsx(Wt,{children:e.jsx(on,{})})}));
