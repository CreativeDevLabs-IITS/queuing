import{ad as St,ae as e,r as o,af as ye,ag as lt,ah as dt,ai as Ct,aj as kt,ak as It,al as Ze,am as ce,an as Tt,ao as Dt,ap as ct,aq as pt,ar as Qe,as as et,at as ut,au as zt,av as Rt,aw as xt,ax as gt,ay as Wt,az as Pt,aA as At,aB as Et,aC as Bt,aD as Nt,aE as Lt,aF as Ot,aG as Ne,aH as Le,aI as tt,aJ as Mt,aK as Ve,aL as Ke,aM as Ft,aN as Ut,aO as he,aP as Vt,R as Ht,aQ as qt}from"./vendor-DxPz6D9i.js";import{R as We,B as Je,C as Me,X as Fe,Y as Ue,T as Pe,a as Xe,P as ft,b as ht,c as mt,L as $t,d as Yt}from"./recharts-DmFB1HYV.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const S of c.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&n(S)}).observe(document,{childList:!0,subtree:!0});function a(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(i){if(i.ep)return;i.ep=!0;const c=a(i);fetch(i.href,c)}})();const _t="/api",C=St.create({baseURL:_t,headers:{"Content-Type":"application/json"}});C.interceptors.request.use(t=>{const s=localStorage.getItem("token");return s&&(t.headers.Authorization=`Bearer ${s}`),t});C.interceptors.response.use(t=>t,t=>{var a;const s=(a=t.response)==null?void 0:a.status;if(s===401||s===403){localStorage.removeItem("token"),localStorage.removeItem("user");const n=window.location.pathname;n.startsWith("/admin")?n!=="/admin/login"&&(window.location.href="/admin/login"):n.startsWith("/staff")&&n!=="/staff/login"&&(window.location.href="/staff/login")}return Promise.reject(t)});function Ie(){const t=localStorage.getItem("user");if(t==null||t===""||t==="undefined")return null;try{return JSON.parse(t)}catch{return null}}const nt="queueEntry",ot="queueDate",yt=t=>{const s=new Date().toISOString().split("T")[0];localStorage.setItem(nt,JSON.stringify(t)),localStorage.setItem(ot,s)},He=()=>{const t=localStorage.getItem(nt),s=localStorage.getItem(ot),a=new Date().toISOString().split("T")[0];if(!t||s!==a)return s!==a&&Oe(),null;try{return JSON.parse(t)}catch{return Oe(),null}},Oe=()=>{localStorage.removeItem(nt),localStorage.removeItem(ot)};function ie({label:t,error:s,style:a,disabled:n,...i}){const c={width:"100%",padding:"12px",borderRadius:"8px",border:s?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",transition:"border-color 0.2s",...n&&{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed"},...a};return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("input",{style:c,disabled:n,...i}),s&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:s})]})}function O({children:t,onClick:s,variant:a="primary",disabled:n=!1,fullWidth:i=!1,icon:c,iconPosition:S="left",type:m,style:p,...u}){const f={padding:"10px 20px",borderRadius:"8px",border:"none",fontSize:"14px",fontWeight:"600",cursor:n?"not-allowed":"pointer",transition:"all 0.2s",opacity:n?.6:1,width:i?"100%":"auto",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:a==="primary"||a==="success"||a==="danger"||a==="gradient"?"0 2px 4px rgba(0,0,0,0.1)":"none",...p},r={primary:{background:n?"#cbd5e1":"#2563eb",color:"white"},gradient:{background:n?"#cbd5e1":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",boxShadow:n?"none":"0 4px 12px rgba(102, 126, 234, 0.4)"},secondary:{background:n?"#cbd5e1":"#64748b",color:"white"},success:{background:n?"#cbd5e1":"#10b981",color:"white"},danger:{background:n?"#cbd5e1":"#ef4444",color:"white"},outline:{background:"transparent",color:n?"#cbd5e1":"#2563eb",border:`2px solid ${n?"#cbd5e1":"#2563eb"}`}},v=r[a]||r.primary,j=c&&e.jsx(c,{size:18,strokeWidth:2.5}),R=S==="left"?e.jsxs(e.Fragment,{children:[" ",j," ",t," "]}):e.jsxs(e.Fragment,{children:[" ",t," ",j," "]});return e.jsx("button",{type:m||"button",style:{...f,...v},onClick:n?void 0:s,disabled:n,onMouseOver:g=>{n||(a==="primary"?(g.target.style.background="#1e40af",g.target.style.boxShadow="0 4px 8px rgba(37, 99, 235, 0.3)"):a==="outline"?g.target.style.background="#eff6ff":a==="danger"?(g.target.style.background="#dc2626",g.target.style.boxShadow="0 4px 8px rgba(239, 68, 68, 0.3)"):a==="success"?(g.target.style.background="#059669",g.target.style.boxShadow="0 4px 8px rgba(16, 185, 129, 0.3)"):a==="gradient"&&(g.target.style.background="linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)",g.target.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.5)"))},onMouseOut:g=>{n||(g.target.style.background=v.background,g.target.style.boxShadow=a==="gradient"?"0 4px 12px rgba(102, 126, 234, 0.4)":a==="primary"||a==="success"||a==="danger"?"0 2px 4px rgba(0,0,0,0.1)":"none")},...u,children:R})}function be(){return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #e2e8f0",borderTop:"4px solid #2563eb",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})}function we({size:t="medium",showText:s=!0,gap:a="12px"}){const[n,i]=o.useState(null),[c,S]=o.useState(!0),[m,p]=o.useState(!1);o.useEffect(()=>{u();const v=setInterval(u,3e4);return()=>clearInterval(v)},[]);const u=async()=>{try{const v=await C.get("/admin/settings/logo");if(v.data.logoUrl){let j=v.data.logoUrl;j&&!j.startsWith("http")&&!j.startsWith("/")&&(j="/"+j);const R=j.includes("?")?"&":"?";j=j+R+"_t="+Date.now(),i(j),p(!1)}else i(null),p(!1)}catch(v){console.error("Failed to load logo:",v),p(!0)}finally{S(!1)}},f={small:{width:"80px",height:"40px"},medium:{width:"120px",height:"60px"},large:{width:"180px",height:"90px"},monitor:{width:"88px",height:"80px"}},r=f[t]||f.medium;return c?null:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:a},children:[n&&!m?e.jsx("img",{src:n,alt:"Logo",style:{...r,objectFit:"contain",maxWidth:"100%"},onError:v=>{console.error("Failed to load logo image:",n),p(!0),i(null)}}):e.jsx("div",{style:{...r,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",color:"white",fontWeight:"700",fontSize:t==="small"?"14px":t==="large"?"24px":"18px"},children:"Q"}),s&&e.jsx("span",{style:{fontSize:t==="small"?"18px":t==="large"?"28px":"24px",fontWeight:"700",color:"#1e293b"}})]})}const Gt=[{value:"REGULAR",label:"Regular"},{value:"SENIOR_CITIZEN",label:"Senior Citizen"},{value:"PWD",label:"PWD"},{value:"PREGNANT",label:"Pregnant"}];function Qt(){var E;const t=ye(),[s,a]=o.useState(!0),[n,i]=o.useState(!1),[c,S]=o.useState([]),[m,p]=o.useState({clientName:"",clientType:"REGULAR",categoryIds:[],subCategoryIds:[]}),[u,f]=o.useState({});o.useEffect(()=>{r()},[]);const r=async()=>{var l;try{const h=await C.get("/categories");S(Array.isArray((l=h.data)==null?void 0:l.categories)?h.data.categories:[])}catch(h){console.error("Failed to load categories:",h)}finally{a(!1)}},v=o.useMemo(()=>{var W;if(!((W=m.categoryIds)!=null&&W.length))return[];const l=(c||[]).filter(I=>m.categoryIds.includes(I.id)),h=new Map;return l.forEach(I=>{(I.subCategories||[]).forEach(N=>{h.has(N.id)||h.set(N.id,{...N,categoryName:I.name})})}),Array.from(h.values())},[m.categoryIds,c]),j=l=>{const h=m.categoryIds||[],W=h.includes(l)?h.filter($=>$!==l):[...h,l],I=(c||[]).filter($=>W.includes($.id)),N=new Set;I.forEach($=>{($.subCategories||[]).forEach(K=>N.add(K.id))}),p({...m,categoryIds:W,subCategoryIds:(m.subCategoryIds||[]).filter($=>N.has($))})},R=l=>{const h=m.subCategoryIds||[],W=h.includes(l)?h.filter(I=>I!==l):[...h,l];p({...m,subCategoryIds:W})},g=async l=>{var W,I,N,$;l.preventDefault(),f({});const h={};if(m.clientName.trim()||(h.clientName="Name is required"),(W=m.categoryIds)!=null&&W.length||(h.categoryId="Select at least one category"),Object.keys(h).length>0){f(h);return}i(!0);try{const te=(await C.post("/queue/join",{clientName:m.clientName.trim(),clientType:m.clientType,categoryIds:m.categoryIds,subCategoryIds:(I=m.subCategoryIds)!=null&&I.length?m.subCategoryIds:void 0})).data.queueEntry,re=(te.concernCategories||[te.category]).map(ae=>ae.name).join(", "),J=(te.concernSubCategories||[]).map(ae=>ae.name).join(", ")||null;yt({queueNumber:te.queueNumber,clientName:te.clientName,date:te.date,category:re,subCategory:J,clientType:te.clientType,status:te.status}),t("/success")}catch(K){console.error("Failed to join queue:",K),f({submit:(($=(N=K.response)==null?void 0:N.data)==null?void 0:$.error)||"Failed to join queue"})}finally{i(!1)}};return s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(be,{})}):e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(we,{size:"medium"})}),e.jsx("h1",{style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Join Queue"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Fill in your details to get a queue number"}),e.jsxs("form",{onSubmit:g,children:[e.jsx(ie,{label:"Your Name",value:m.clientName,onChange:l=>p({...m,clientName:l.target.value}),error:u.clientName,placeholder:"Enter your full name",required:!0}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Client Type"}),e.jsx("div",{className:"client-type-pills",children:Gt.map(({value:l,label:h})=>e.jsxs("label",{className:`pill-radio ${m.clientType===l?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"clientType",value:l,checked:m.clientType===l,onChange:()=>p({...m,clientType:l})}),e.jsx("span",{children:h})]},l))})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:["Concern Category ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),u.categoryId&&e.jsx("div",{style:{fontSize:"12px",color:"#ef4444",marginBottom:"8px"},children:u.categoryId}),e.jsx("div",{className:"checkbox-group",children:(c||[]).map(l=>e.jsxs("label",{className:`checkbox-row ${(m.categoryIds||[]).includes(l.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(m.categoryIds||[]).includes(l.id),onChange:()=>j(l.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:l.name})]},l.id))})]}),v.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Sub-Concern (Optional)"}),e.jsx("div",{className:"checkbox-group",children:v.map(l=>e.jsxs("label",{className:`checkbox-row ${(m.subCategoryIds||[]).includes(l.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(m.subCategoryIds||[]).includes(l.id),onChange:()=>R(l.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:l.name})]},l.id))})]}),u.submit&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:u.submit}),e.jsx(O,{type:"submit",variant:"gradient",fullWidth:!0,disabled:n||!m.clientType||!((E=m.categoryIds)!=null&&E.length),style:{marginTop:"8px",padding:"14px 24px",fontSize:"16px"},children:n?"Joining...":"Join Queue"})]}),e.jsx("div",{style:{marginTop:"24px",textAlign:"center"},children:e.jsx("a",{href:"/monitor",style:{color:"#2563eb",textDecoration:"none",fontSize:"14px"},children:"View Queue Status â†’"})})]})})}function qe(t){if(!t)return"";const s=t.split("-");return s.length>1?s[1]:t}function Kt(t){return t?t.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()).join(" "):""}function bt({window:t}){const{label:s,staff:a,currentServing:n}=t,i=p=>{const u=p.trim().split(" ");return u.length>=2?(u[0][0]+u[u.length-1][0]).toUpperCase():p.substring(0,2).toUpperCase()},c=(a==null?void 0:a.name)||"â€”",S=n?qe(n.queueNumber):null,m=n&&[n.clientName||"",n.clientType?`(${Kt(n.clientType)})`:""].filter(Boolean).join(" ").trim()||null;return e.jsxs("div",{style:{background:"#0b1120",borderRadius:"12px",padding:0,boxShadow:"0 4px 12px rgba(15,23,42,0.6)",border:"1px solid #1e293b",transition:"all 0.2s",display:"flex",alignItems:"stretch",minHeight:"96px",overflow:"hidden"},children:[e.jsx("div",{style:{flex:"0 0 34%",maxWidth:"110px",borderRadius:"12px",background:a!=null&&a.profilePicture?void 0:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:a!=null&&a.profilePicture?e.jsx("img",{src:a.profilePicture,alt:c,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):e.jsx("span",{style:{color:"white",fontWeight:"700",fontSize:"24px"},children:i(c)})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0,padding:"6px 8px 6px 8px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"700",color:"#e5e7eb",marginBottom:"2px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:c}),n?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:"700",color:"#cbd5f5",marginBottom:"4px"},children:"is now serving:"}),e.jsx("div",{style:{fontSize:"clamp(22px, 2.8vw, 34px)",fontWeight:"700",color:"#fbbf24",lineHeight:1.05,marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:S}),m&&e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#cbd5f5",marginBottom:"4px",maxHeight:"2.6em",overflow:"hidden"},children:m})]}):e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#64748b",fontStyle:"italic"},children:"No active service"}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"2px",fontSize:"15px",fontWeight:"700",color:"#38bdf8",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:s})]})]})}function wt({clientType:t}){const s={REGULAR:{bg:"#e2e8f0",color:"#475569"},SENIOR_CITIZEN:{bg:"#fef3c7",color:"#92400e"},PWD:{bg:"#dbeafe",color:"#1e40af"},PREGNANT:{bg:"#fce7f3",color:"#9f1239"}},a={REGULAR:"Regular",SENIOR_CITIZEN:"Senior",PWD:"PWD",PREGNANT:"Pregnant"},n=s[t]||s.REGULAR;return e.jsx("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:n.bg,color:n.color},children:a[t]})}function Jt(){const t=ye(),[s,a]=o.useState(null),[n,i]=o.useState([]),[c,S]=o.useState(!0),[m,p]=o.useState(0);o.useEffect(()=>{const v=He();if(!v){t("/");return}a(v),u();const j=setInterval(u,2e3);return()=>clearInterval(j)},[t]),o.useEffect(()=>{(s==null?void 0:s.status)==="SERVED"&&t("/thank-you")},[s==null?void 0:s.status,t]);const u=async()=>{var v;try{const j=He()||s;if(j!=null&&j.queueNumber){const E=(await C.get(`/queue/${j.queueNumber}`)).data.queueEntry,l={...j,status:E.status};if(a(l),yt(l),E.status==="SERVED"){t("/thank-you");return}if(E.status==="WAITING")try{const h=await C.get(`/queue/${j.queueNumber}/ahead`);p(h.data.peopleAhead||0)}catch{const W=await C.get("/queue/public/stats");p(W.data.waiting||0)}else p(0)}const R=await C.get("/queue/public/windows");i(R.data.windows)}catch(j){console.error("Failed to load data:",j),((v=j.response)==null?void 0:v.status)===404&&(Oe(),t("/"))}finally{S(!1)}};if(c||!s)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(be,{})});const f={WAITING:{bg:"#fef3c7",color:"#92400e",text:"Waiting"},NOW_SERVING:{bg:"#dbeafe",color:"#1e40af",text:"Being served"},SERVED:{bg:"#d1fae5",color:"#065f46",text:"Served"},SKIPPED:{bg:"#fee2e2",color:"#991b1b",text:"Skipped"}},r=f[s.status]||f.WAITING;return e.jsx("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"20px"},children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(we,{size:"medium"})}),e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:["Hello, ",s.clientName]}),e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",color:"#2563eb",marginBottom:"16px",letterSpacing:"2px"},children:qe(s.queueNumber)}),e.jsx("div",{style:{display:"inline-block",padding:"8px 16px",borderRadius:"20px",backgroundColor:r.bg,color:r.color,fontSize:"14px",fontWeight:"600",marginBottom:"16px"},children:r.text}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(wt,{clientType:s.clientType}),e.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:"#e2e8f0",color:"#475569"},children:[s.category,s.subCategory&&` - ${s.subCategory}`]})]}),s.status==="WAITING"&&m>0&&e.jsxs("div",{style:{marginTop:"16px",fontSize:"14px",color:"#64748b"},children:["Approximately ",m," ",m===1?"person":"people"," ahead"]}),e.jsx("div",{style:{marginTop:"24px",padding:"16px",background:"#f1f5f9",borderRadius:"8px",fontSize:"14px",color:"#475569"},children:"ðŸ’¡ You can leave and monitor your queue status from this page. We'll update automatically."})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px",color:"#1e293b"},children:"Active Windows"}),e.jsx("div",{className:"grid-responsive",style:{display:"grid",gap:"16px"},children:n.length>0?n.map(v=>e.jsx(bt,{window:v},v.id)):e.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"40px",background:"white",borderRadius:"12px",color:"#64748b"},children:"No active windows at the moment"})})]})]})})}function Xt(){const t=ye();o.useEffect(()=>{const a=He();if(!a||a.status!=="SERVED"){t("/");return}const n=setTimeout(()=>{Oe()},5e3);return()=>clearTimeout(n)},[t]);const s=He();return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"48px",maxWidth:"600px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(we,{size:"medium"})}),e.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:"âœ…"}),e.jsx("h1",{style:{fontSize:"32px",fontWeight:"700",marginBottom:"16px",color:"#1e293b"},children:"Thank You!"}),s&&e.jsxs("p",{style:{fontSize:"18px",color:"#64748b",marginBottom:"24px"},children:["Thank you, ",e.jsx("strong",{children:s.clientName}),", for your visit."]}),e.jsx("p",{style:{fontSize:"16px",color:"#475569",marginBottom:"32px",lineHeight:"1.6"},children:"We appreciate your business and look forward to serving you again."}),e.jsx("div",{style:{padding:"20px",background:"#f1f5f9",borderRadius:"12px",marginBottom:"32px"},children:e.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Your service has been completed. Have a wonderful day!"})}),e.jsx("button",{onClick:()=>{Oe(),t("/")},style:{padding:"12px 32px",borderRadius:"8px",border:"none",background:"#2563eb",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:a=>{a.target.style.background="#1e40af"},onMouseOut:a=>{a.target.style.background="#2563eb"},children:"Return to Home"})]})})}function Zt(){const[t,s]=o.useState([]),[a,n]=o.useState([]),[i,c]=o.useState(null),[S,m]=o.useState(!0),[p,u]=o.useState(!1),[f,r]=o.useState("youtube"),[v,j]=o.useState(null),R=o.useRef(null),g=o.useRef(null),E=o.useRef(null),l=o.useRef([]);l.current=a;const h=o.useRef([]),W=o.useRef(!1),I=o.useRef([]),N=o.useRef(!1),$=o.useRef(null),K=o.useRef(0),te=8e3,re=.5,[J,ae]=o.useState(null),ue=o.useRef(null),y=o.useRef(!1),k=o.useRef(null),[Y,F]=o.useState(!1),[P,U]=o.useState(50);o.useEffect(()=>{d(),A();const b=setInterval(d,2e3);return()=>clearInterval(b)},[]),o.useEffect(()=>{_e()},[]),o.useEffect(()=>{a.length>0&&!y.current&&F(!0)},[a]);const G=o.useRef(null);o.useEffect(()=>{const b=()=>{var B;return(B=G.current)==null?void 0:B.call(G)};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[]),o.useEffect(()=>{a.length>0&&!i&&c(a[0])},[a,i]),o.useEffect(()=>()=>{a.forEach(b=>{b._blobUrl&&b.url&&URL.revokeObjectURL(b.url)})},[a]),o.useEffect(()=>{if(f!=="local"||!R.current||!i)return;const b=R.current,B=()=>{const q=(a.findIndex(Q=>Q.url===i.url)+1)%a.length;c(a[q])};b.addEventListener("ended",B),b.volume=re,b.load();const T=b.play();return T!==void 0&&T.then(()=>{b.muted=!1}).catch(()=>{b.muted=!0,b.play().catch(console.error)}),()=>b.removeEventListener("ended",B)},[i,a,f]),o.useEffect(()=>{var q;if(f!=="youtube"||!(i!=null&&i.id))return;const b=Q=>{if(g.current){g.current.loadVideoById(Q);const z=Math.max(0,Math.min(100,P))/100;g.current.setVolume(Math.round(z*100));return}const _=E.current;if(!_)return;const Z=document.createElement("div");Z.id="youtube-player-"+Date.now(),_.innerHTML="",_.appendChild(Z),g.current=new window.YT.Player(Z.id,{videoId:Q,width:"100%",height:"100%",playerVars:{autoplay:1,mute:1,rel:0,modestbranding:1},events:{onReady:z=>{const oe=Math.max(0,Math.min(100,P))/100;z.target.setVolume(Math.round(oe*100)),y.current&&z.target.unMute()},onStateChange:z=>{if(z.data===0){const oe=l.current,w=(oe.findIndex(D=>D.id===Q)+1)%oe.length;oe[w]&&c(oe[w])}}}})};if((q=window.YT)!=null&&q.Player)return b(i.id),()=>{};if(window.YTLoadReady)return window.YT.ready(()=>b(i.id)),()=>{};const B=document.createElement("script");B.src="https://www.youtube.com/iframe_api";const T=document.getElementsByTagName("script")[0];T.parentNode.insertBefore(B,T);const X=window.onYouTubeIframeAPIReady;return window.onYouTubeIframeAPIReady=()=>{window.YTLoadReady=!0,X&&X(),b(i.id)},()=>{}},[i,a,f,P]),o.useEffect(()=>()=>{if(g.current){try{g.current.destroy()}catch{}g.current=null}E.current&&(E.current.innerHTML="")},[]);const d=async()=>{try{const B=(await C.get("/queue/public/windows")).data.windows||[],T=h.current;s(B),h.current=B,setTimeout(()=>{try{Se(T,B)}catch(X){console.error("Failed to run TTS announcements:",X)}},0)}catch(b){console.error("Failed to load windows:",b)}finally{m(!1)}},A=async()=>{try{const B=(await C.get("/admin/settings/ding-sound")).data.dingSoundUrl||null;ae(B),ue.current=B}catch(b){console.error("Failed to load ding sound URL:",b),ae(null),ue.current=null}},M=b=>{if(typeof window>"u"){console.log("playDing: window undefined"),b&&setTimeout(b,7e3);return}console.log("playDing: starting");let T=!1,X=null;X=setTimeout(()=>{if(!T&&(console.warn("playDing: Ultimate timeout reached, forcing safeDone"),T=!0,b))try{b()}catch(Q){console.error("playDing: Error in onDone callback:",Q)}},7e3);const q=()=>{if(T){console.log("playDing: safeDone called but already done");return}if(T=!0,X&&(clearTimeout(X),X=null),console.log("playDing: done - calling onDone callback"),b)try{b()}catch(Q){console.error("playDing: Error in onDone callback:",Q)}else console.warn("playDing: No onDone callback provided")};try{const Q=ue.current||J;if(Q&&typeof Q=="string"){const Z=Q.startsWith("http")?Q:`${window.location.origin}${Q.startsWith("/")?"":"/"}${Q}`;console.log("playDing: Using custom ding sound:",Z);const z=new Audio(Z);z.volume=1;let oe=!1;const x=()=>{if(T)return;console.log("playDing: Trying synthesized chime fallback");const pe=window.AudioContext||window.webkitAudioContext;if(!pe){console.warn("playDing: No AudioContext available"),q();return}let se=k.current;if(!se)try{se=new pe,se.state,k.current=se}catch(de){console.warn("playDing: Cannot create AudioContext (needs user gesture):",de),T||q();return}if(!se){console.warn("playDing: No AudioContext available"),T||q();return}const fe=()=>{if(!T)try{console.log("playDing: Playing synthesized chime");const de=se.createOscillator(),Ee=se.createOscillator(),Re=se.createGain();de.type="sine",Ee.type="sine";const je=se.currentTime;de.frequency.setValueAtTime(880,je),Ee.frequency.setValueAtTime(1175,je+.08),de.connect(Re),Ee.connect(Re),Re.connect(se.destination),Re.gain.setValueAtTime(1e-4,je),Re.gain.exponentialRampToValueAtTime(.25,je+.03),Re.gain.exponentialRampToValueAtTime(1e-4,je+.4),de.start(je),Ee.start(je+.08),de.stop(je+.4),Ee.stop(je+.4),setTimeout(()=>{T||(console.log("playDing: Synthesized chime finished"),q())},500)}catch(de){console.error("playDing: Failed to play chime:",de),T||q()}};se.state==="suspended"&&se.resume?se.resume().then(()=>{T||fe()}).catch(de=>{console.warn("playDing: AudioContext resume failed:",de),T||q()}):fe()},w=()=>{if(T)return;console.log("playDing: Audio ended event fired, currentTime:",z.currentTime,"duration:",z.duration),z.removeEventListener("ended",w),z.removeEventListener("error",D),z.removeEventListener("canplaythrough",H),z.removeEventListener("loadeddata",H),z.currentTime>=Math.min(.1,z.duration*.1)||z.duration===0?(console.log("playDing: Custom ding played successfully"),oe=!0,q()):(console.warn("playDing: Custom ding ended immediately, trying fallback chime"),x())},D=pe=>{console.error("Failed to play custom ding sound:",pe),z.removeEventListener("ended",w),z.removeEventListener("error",D),z.removeEventListener("canplaythrough",H),z.removeEventListener("loadeddata",H),x()},L=()=>{console.log("playDing: Audio ready, attempting to play, readyState:",z.readyState,"duration:",z.duration,"currentTime:",z.currentTime),z.currentTime=0,setTimeout(()=>{const pe=z.play();pe!==void 0?pe.then(()=>{console.log("playDing: Audio playing successfully, paused:",z.paused,"currentTime:",z.currentTime,"duration:",z.duration),setTimeout(()=>{z.paused&&!T&&!oe?(console.warn("playDing: Audio paused after play() promise resolved, may be blocked by autoplay policy. Will try fallback chime."),D(new Error("Autoplay blocked"))):z.paused||console.log("playDing: Audio confirmed playing, currentTime:",z.currentTime)},100)}).catch(se=>{console.error("Failed to start custom ding sound:",se),D(se)}):(console.warn("playDing: play() returned undefined"),setTimeout(()=>{z.paused&&!T&&!oe&&(console.warn("playDing: Audio is paused after play(), treating as error. Will try fallback chime."),D(new Error("Audio did not start playing")))},100))},10)},H=()=>{z.removeEventListener("canplaythrough",H),z.removeEventListener("loadeddata",H),L()};z.addEventListener("ended",w),z.addEventListener("error",D),z.readyState>=2?(console.log("playDing: Audio already loaded, playing immediately"),L()):(z.addEventListener("canplaythrough",H),z.addEventListener("loadeddata",H),z.load()),setTimeout(()=>{!T&&!oe&&(console.warn("playDing: Custom ding timeout (2s), trying fallback chime"),z.removeEventListener("ended",w),z.removeEventListener("error",D),z.removeEventListener("canplaythrough",H),z.removeEventListener("loadeddata",H),x())},2e3);return}const _=window.AudioContext||window.webkitAudioContext;if(_){const Z=k.current||new _,z=()=>{console.log("playDing: Playing synthesized chime");const oe=Z.createOscillator(),x=Z.createOscillator(),w=Z.createGain();oe.type="sine",x.type="sine";const D=Z.currentTime;oe.frequency.setValueAtTime(880,D),x.frequency.setValueAtTime(1175,D+.08),oe.connect(w),x.connect(w),w.connect(Z.destination),w.gain.setValueAtTime(1e-4,D),w.gain.exponentialRampToValueAtTime(.25,D+.03),w.gain.exponentialRampToValueAtTime(1e-4,D+.4),oe.start(D),x.start(D+.08),oe.stop(D+.4),x.stop(D+.4),setTimeout(()=>{console.log("playDing: Synthesized chime finished"),q()},500)};Z.state==="suspended"&&Z.resume?Z.resume().then(()=>{z()}).catch(()=>{z()}):z();return}console.warn("playDing: No AudioContext available, cannot play chime"),q()}catch(Q){console.error("Failed to play ding sound:",Q)}setTimeout(q,7e3)},ne=b=>{const B=R.current;B&&(B.volume=Math.max(0,Math.min(1,b)));const T=g.current;T&&typeof T.setVolume=="function"&&T.setVolume(Math.round(Math.max(0,Math.min(1,b))*100))},xe=(b,B)=>{if(typeof window<"u"&&window.speechSynthesis){window.speechSynthesis.cancel();const T=new SpeechSynthesisUtterance(b);T.lang="en-US",T.rate=1,T.pitch=1,T.onend=B,T.onerror=B,window.speechSynthesis.speak(T)}else B()},ge=b=>new Promise(B=>{if(!b||typeof b!="string"||!b.trim()){console.warn("TTS: Empty or invalid text provided"),B();return}C.post("/tts",{text:b},{responseType:"arraybuffer"}).then(T=>{const X=T.headers&&T.headers["content-type"]||"",q=X.includes("audio/")||X.includes("mpeg");if(T.status!==200||!q||!T.data){console.warn("TTS: Invalid response, falling back to speechSynthesis"),xe(b,B);return}const Q=T.data,_=new Blob([Q],{type:"audio/mpeg"}),Z=URL.createObjectURL(_),z=new Audio(Z);z.volume=1;const oe=()=>{z.src="",z.removeEventListener("ended",x),z.removeEventListener("error",w),setTimeout(()=>URL.revokeObjectURL(Z),100)},x=()=>{oe(),B()},w=L=>{console.error("TTS audio playback error:",L),oe(),xe(b,B)};z.addEventListener("ended",x),z.addEventListener("error",w);const D=z.play();D!==void 0&&D.catch(L=>{console.error("TTS audio play() failed:",L),oe(),xe(b,B)})}).catch(T=>{console.error("TTS API call failed:",T),xe(b,B)})}),ve=()=>new Promise(b=>M(b)),le=async()=>{if(N.current){console.log("Already processing announcement, skipping");return}if(I.current.length===0){console.log("No announcements in queue");return}console.log(`Processing announcement, queue length: ${I.current.length}`),N.current=!0;const b=I.current.shift();if(!b){console.log("No item to process"),N.current=!1,I.current.length>0&&le();return}const{text:B}=b;console.log("Starting announcement:",B);try{ne(.05),console.log("Playing ding..."),await ve(),console.log("Ding finished, playing TTS..."),await ge(B),console.log("TTS finished"),Te(b.key)}catch(T){console.error("Announcement playback error:",T)}finally{ne(re),N.current=!1,I.current.length>0&&le()}},Se=(b,B)=>{if(typeof window>"u")return;if(!W.current){W.current=!0;return}const T=new Map;(b||[]).forEach(_=>{_&&_.id&&_.currentServing&&T.set(_.id,_.currentServing.queueNumber)});const X=Date.now(),q=new Set(I.current.map(_=>_.key).filter(Boolean)),Q=[];(B||[]).forEach(_=>{if(!_||!_.id||!_.currentServing)return;const Z=_.currentServing.queueNumber,z=_.currentServing.clientName,oe=T.get(_.id);if(!Z||Z===oe)return;const x=`${_.id}:${Z}`;if(q.has(x)||$.current===x&&X-K.current<te)return;q.add(x);const w=qe?qe(Z):Z;let D=w;const L=parseInt(w,10);Number.isNaN(L)||(D=String(L));const H=_.label||"Window",pe=z?`, ${z}`:"",fe="Ang atong {{window}},... mu assist na sa kyu number, {{queueNumber}}. {{clientNamePart}}, please proceed to {{window}}.".replace(/{{\s*window\s*}}/gi,H).replace(/{{\s*queueNumber\s*}}/gi,D).replace(/{{\s*clientNamePart\s*}}/gi,pe);console.log("Announcement queued:",{windowLabel:H,spokenCounter:D,text:fe}),Q.push({text:fe,key:x})}),Q.length>0&&(console.log(`Adding ${Q.length} announcement(s) to queue`),Q.forEach(_=>I.current.push(_)),le())},Te=b=>{b&&($.current=b,K.current=Date.now())},Ce=[".mp4",".webm",".ogg",".mov",".avi"];function Ye(b){if(!b||typeof b!="string")return null;const B=b.trim(),T=B.match(/[?&]v=([^&]+)/);if(T)return T[1];const X=B.match(/youtu\.be\/([^?&]+)/);if(X)return X[1];const q=B.match(/youtube\.com\/embed\/([^?&]+)/);return q?q[1]:null}const _e=async()=>{var b;try{const[B,T]=await Promise.all([C.get("/admin/settings/video-source"),C.get("/admin/settings/video-volume").catch(()=>null)]),X=B.data.videoSource||"youtube";if(r(X),T&&typeof((b=T.data)==null?void 0:b.videoVolumePercent)=="number"){const q=T.data.videoVolumePercent;U(Math.max(0,Math.min(100,Math.round(q))))}if(X==="youtube"){const _=((await C.get("/admin/settings/youtube-playlist")).data.urls||[]).map(Z=>{const z=Ye(Z);return z?{id:z,url:Z,name:z}:null}).filter(Boolean);n(_),u(!1),j(null)}else n([]),j(null)}catch(B){console.error("Failed to load videos:",B),u(!0),n([])}},Ge=async()=>{if(!("showDirectoryPicker"in window)){j("Not supported in this browser. Use Chrome or Edge.");return}try{j(null);const b=await window.showDirectoryPicker(),B=[];for await(const T of b.values())if(T.kind==="file"){const X="."+(T.name.split(".").pop()||"").toLowerCase();if(Ce.includes(X)){const q=await T.getFile(),Q=URL.createObjectURL(q);B.push({filename:T.name,name:T.name.replace(/\.[^/.]+$/,""),url:Q,_blobUrl:!0})}}B.length>0?(n(B),u(!1)):j("No video files found in that folder.")}catch(b){b.name!=="AbortError"&&(console.error("Failed to pick folder:",b),j(b.message||"Failed to access folder."))}},ke=()=>{if(!y.current){y.current=!0,F(!1);try{const b=Math.max(0,Math.min(100,P))/100,B=window.AudioContext||window.webkitAudioContext;if(B&&!k.current){const q=new B;k.current=q,q.resume&&q.resume()}const T=g.current;T&&typeof T.unMute=="function"&&(T.unMute(),T.setVolume(Math.round(b*100)));const X=R.current;X&&(X.muted=!1,X.volume=b)}catch{}}};return G.current=ke,e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:"#0f172a",overflow:"hidden"},onClick:ke,onTouchStart:ke,role:"presentation",children:[Y&&a.length>0&&e.jsxs("div",{role:"button",tabIndex:0,onClick:ke,onKeyDown:b=>{b.key!=="Tab"&&ke()},style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(0,0,0,0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",cursor:"pointer"},children:[e.jsx("div",{style:{color:"#e5e7eb",fontSize:"24px",fontWeight:600,textAlign:"center",padding:"0 24px"},children:"Press any key or tap to start"}),e.jsx("div",{style:{color:"#9ca3af",fontSize:"16px",textAlign:"center",padding:"0 24px"},children:"Use your remote's OK/Enter button, or tap the screen"})]}),e.jsxs("div",{style:{flex:1,display:"flex",minHeight:0},children:[e.jsxs("div",{style:{flex:3,minWidth:0,background:"#000",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{position:"absolute",top:16,left:16,zIndex:10,display:"flex",alignItems:"center",gap:0,pointerEvents:"none"},children:[e.jsx("div",{children:e.jsx(we,{size:"monitor",showText:!1,gap:"0px"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",lineHeight:1.1,marginLeft:0},children:[e.jsx("span",{style:{fontSize:"18px",fontWeight:700,color:"#e5e7eb",textShadow:"0 2px 4px rgba(0,0,0,0.6)",whiteSpace:"nowrap"},children:"Hilongos Treasury Office"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:600,color:"#e5e7eb",textShadow:"0 2px 4px rgba(0,0,0,0.6)",textTransform:"uppercase",letterSpacing:"0.12em",whiteSpace:"nowrap"},children:"Queue Monitoring"})]})]}),a.length>0&&!p?f==="youtube"?e.jsx("div",{ref:E,style:{position:"relative",width:"100%",height:"100%"}}):e.jsx("video",{ref:R,src:i==null?void 0:i.url,controls:!0,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{textAlign:"center",padding:"40px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{color:"#9ca3af",fontSize:"22px",fontWeight:600,marginBottom:"8px"},children:f==="local"?"Select a video folder":"No YouTube playlist configured"}),e.jsx("div",{style:{color:"#6b7280",fontSize:"16px"},children:f==="local"?"Choose a folder on this computer containing video files (mp4, webm, ogg, mov, avi).":"Add YouTube URLs in Admin â†’ Settings â†’ Videos."}),f==="local"&&v&&e.jsx("div",{style:{color:"#ef4444",fontSize:"14px"},children:v}),f==="local"&&e.jsx("button",{type:"button",onClick:Ge,style:{padding:"12px 24px",fontSize:"16px",fontWeight:600,color:"white",background:"#6366f1",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Select folder"})]})]}),e.jsx("div",{style:{flex:1,minWidth:0,borderLeft:"1px solid #1f2937",background:"#020617",padding:"12px",display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto"},children:S?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(be,{})}):t.filter(b=>b.staff).length>0?t.filter(b=>b.staff).map(b=>e.jsx(bt,{window:b},b.id)):e.jsx("div",{style:{textAlign:"center",padding:"24px 16px",background:"#0b1120",borderRadius:"12px",color:"#64748b",border:"1px solid #1f2937"},children:"No active windows at the moment"})})]})]})}function en(){const t=ye(),[s,a]=o.useState({username:"",password:""}),[n,i]=o.useState(""),[c,S]=o.useState(!1);o.useEffect(()=>{const p=localStorage.getItem("token"),u=Ie();p&&(u==null?void 0:u.role)==="STAFF"&&t("/staff/dashboard")},[t]);const m=async p=>{var u,f;p.preventDefault(),i(""),S(!0);try{const r=await C.post("/auth/staff/login",s);localStorage.setItem("token",r.data.token),localStorage.setItem("user",JSON.stringify(r.data.user)),t("/staff/dashboard")}catch(r){i(((f=(u=r.response)==null?void 0:u.data)==null?void 0:f.error)||"Login failed")}finally{S(!1)}};return e.jsxs("div",{className:"staff-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .staff-login-root { padding: 16px !important; }
          .staff-login-card { padding: 24px !important; }
          .staff-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"staff-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(we,{size:"medium"})}),e.jsx("h1",{className:"staff-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Staff Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage your queue"}),e.jsxs("form",{onSubmit:m,children:[e.jsx(ie,{label:"Username",value:s.username,onChange:p=>a({...s,username:p.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(ie,{label:"Password",type:"password",value:s.password,onChange:p=>a({...s,password:p.target.value}),placeholder:"Enter your password",required:!0}),n&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:n}),e.jsx(O,{type:"submit",fullWidth:!0,disabled:c,children:c?"Logging in...":"Login"})]})]})]})}function $e({label:t,error:s,children:a,...n}){return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("select",{style:{width:"100%",padding:"12px",borderRadius:"8px",border:s?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",backgroundColor:"white",cursor:"pointer"},...n,children:a}),s&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:s})]})}function tn({onProfileClick:t,onLogout:s}){const[a,n]=o.useState(!1),[i,c]=o.useState(null),[S,m]=o.useState(!0),p=o.useRef(null);o.useEffect(()=>{u()},[]),o.useEffect(()=>{const r=v=>{p.current&&!p.current.contains(v.target)&&n(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const u=async()=>{try{const r=await C.get("/staff/profile");c(r.data.staff)}catch(r){console.error("Failed to load profile:",r)}finally{m(!1)}},f=r=>{if(!r)return"?";const v=r.trim().split(" ");return v.length>=2?(v[0][0]+v[v.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()};return S?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:()=>n(!a),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:i!=null&&i.profilePicture?`url(${i.profilePicture}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:r=>{r.target.style.borderColor="#2563eb",r.target.style.transform="scale(1.05)"},onMouseOut:r=>{r.target.style.borderColor="#e2e8f0",r.target.style.transform="scale(1)"},children:!(i!=null&&i.profilePicture)&&f(i==null?void 0:i.name)}),a&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(i==null?void 0:i.name)||"Staff"}),e.jsxs("button",{onClick:()=>{n(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#f1f5f9"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(lt,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{n(!1),s()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#fee2e2"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(dt,{size:18}),"Logout"]})]})]})}const at={success:{icon:Ze,color:"#10b981",bg:"#d1fae5"},error:{icon:It,color:"#ef4444",bg:"#fee2e2"},warning:{icon:kt,color:"#f59e0b",bg:"#fef3c7"},info:{icon:Ct,color:"#2563eb",bg:"#dbeafe"}};let nn=0;const Ae=[],Be=[];function vt(t,s="info",a=3e3){const n=nn++,i={id:n,message:t,type:s,duration:a};return Ae.push(i),Be.forEach(c=>c([...Ae])),a>0&&setTimeout(()=>{jt(n)},a),n}function jt(t){const s=Ae.findIndex(a=>a.id===t);s>-1&&(Ae.splice(s,1),Be.forEach(a=>a([...Ae])))}function ee(t,s){return vt(t,"success",s)}function V(t,s){return vt(t,"error",s)}function on(){const[t,s]=o.useState([]);return o.useEffect(()=>{const a=n=>{s(n)};return Be.push(a),s([...Ae]),()=>{const n=Be.indexOf(a);n>-1&&Be.splice(n,1)}},[]),e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e4,display:"flex",flexDirection:"column",gap:"12px",pointerEvents:"none"},children:[(t||[]).map(a=>{const n=at[a.type]||at.info,i=n.icon;return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px 20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:"12px",minWidth:"300px",maxWidth:"400px",pointerEvents:"auto",animation:"slideIn 0.3s ease-out",borderLeft:`4px solid ${n.color}`},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:n.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(i,{size:16,color:n.color})}),e.jsx("div",{style:{flex:1,fontSize:"14px",color:"#1e293b",lineHeight:"1.5"},children:a.message}),e.jsx("button",{onClick:()=>jt(a.id),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",transition:"color 0.2s"},onMouseOver:c=>{c.target.style.color="#1e293b"},onMouseOut:c=>{c.target.style.color="#64748b"},children:e.jsx(ce,{size:18})})]},a.id)}),e.jsx("style",{children:`
        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      `})]})}function ze({open:t,title:s,message:a,onConfirm:n,onCancel:i,confirmText:c="Confirm",cancelText:S="Cancel",variant:m="danger"}){if(!t)return null;const p={danger:{confirmBg:"#ef4444",confirmHover:"#dc2626"},warning:{confirmBg:"#f59e0b",confirmHover:"#d97706"},info:{confirmBg:"#2563eb",confirmHover:"#1e40af"}},u=p[m]||p.danger;return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:s}),e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ce,{size:20})})]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px",lineHeight:"1.6"},children:a}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:i,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:f=>{f.target.style.background="#f1f5f9",f.target.style.borderColor="#cbd5e1"},onMouseOut:f=>{f.target.style.background="transparent",f.target.style.borderColor="#e2e8f0"},children:S}),e.jsx("button",{onClick:n,style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:u.confirmBg,color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:f=>{f.target.style.background=u.confirmHover,f.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)"},onMouseOut:f=>{f.target.style.background=u.confirmBg,f.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:c})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const it=["#2563eb","#10b981","#f59e0b","#ef4444"];function an(){const t=ye(),[s,a]=o.useState(!0),[n,i]=o.useState(null),[c,S]=o.useState([]),[m,p]=o.useState({}),[u,f]=o.useState([]),[r,v]=o.useState(null),[j,R]=o.useState("today"),[g,E]=o.useState(new Date),[l,h]=o.useState({open:!1,queueEntryId:null}),[W,I]=o.useState(null);o.useEffect(()=>{const d=localStorage.getItem("token"),A=Ie();if(!d||(A==null?void 0:A.role)!=="STAFF"){t("/staff/login");return}N(),$();const M=setInterval(N,3e3);return()=>clearInterval(M)},[t]),o.useEffect(()=>{j&&K()},[j]),o.useEffect(()=>{const d=setInterval(()=>E(new Date),1e3);return()=>clearInterval(d)},[]);const N=async()=>{var d;try{const A=await C.get("/staff/dashboard");i(A.data.window),S(A.data.queue||[]),p(A.data.stats||{})}catch(A){console.error("Failed to load dashboard:",A),((d=A.response)==null?void 0:d.status)===401&&t("/staff/login")}finally{a(!1)}},$=async()=>{try{const d=await C.get("/windows/active");f(d.data.windows||[])}catch(d){console.error("Failed to load windows:",d)}},K=async()=>{try{let d,A;const M=new Date;if(j==="today")d=M.toISOString().split("T")[0],A=d;else if(j==="yesterday"){const xe=new Date(M);xe.setDate(xe.getDate()-1),d=xe.toISOString().split("T")[0],A=d}else d=M.toISOString().split("T")[0],A=d;const ne=await C.get(`/staff/analytics?startDate=${d}&endDate=${A}`);v(ne.data)}catch(d){console.error("Failed to load analytics:",d)}},te=async d=>{var A,M;try{await C.post("/staff/assign-window",{windowId:d}),N(),$()}catch(ne){console.error("Failed to assign window:",ne),alert(((M=(A=ne.response)==null?void 0:A.data)==null?void 0:M.error)||"Failed to assign window")}},re=async d=>{var A,M,ne,xe,ge,ve;if(!W){I(d);try{const Se=(A=(await C.post(`/staff/serve/${d}`)).data)==null?void 0:A.queueEntry;Se?S(Te=>Te.map(Ce=>Ce.id===d?Se:Ce)):N()}catch(le){console.error("Failed to start serving:",le),((M=le.response)==null?void 0:M.status)===409?(V(((xe=(ne=le.response)==null?void 0:ne.data)==null?void 0:xe.error)||"Client was already claimed. Refreshing..."),N()):V(((ve=(ge=le.response)==null?void 0:ge.data)==null?void 0:ve.error)||"Failed to start serving")}finally{I(null)}}},J=async d=>{var A,M;try{await C.post(`/staff/complete/${d}`),N(),K()}catch(ne){console.error("Failed to complete:",ne),alert(((M=(A=ne.response)==null?void 0:A.data)==null?void 0:M.error)||"Failed to complete")}},ae=d=>{h({open:!0,queueEntryId:d})},ue=async()=>{var A,M;const{queueEntryId:d}=l;if(h({open:!1,queueEntryId:null}),!!d)try{await C.post(`/staff/skip/${d}`),N(),K(),ee("Client marked as skipped")}catch(ne){console.error("Failed to skip:",ne),V(((M=(A=ne.response)==null?void 0:A.data)==null?void 0:M.error)||"Failed to skip")}},y=async()=>{try{await C.get("/staff/dashboard").then(A=>A.data.window)&&await C.post("/staff/assign-window",{windowId:null})}catch(d){console.error("Error deactivating window on logout:",d)}localStorage.removeItem("token"),localStorage.removeItem("user"),t("/staff/login")},k=()=>{t("/staff/profile")};if(s)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(be,{})});const Y=c.filter(d=>["SENIOR_CITIZEN","PWD","PREGNANT"].includes(d.clientType)),F=c.filter(d=>d.clientType==="REGULAR"),P=r!=null&&r.byCategory?Object.entries(r.byCategory).map(([d,A])=>({name:d,value:A})):[],U=r!=null&&r.byClientType?Object.entries(r.byClientType).map(([d,A])=>({name:d,value:A})):[],G=d=>{const A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],M=["January","February","March","April","May","June","July","August","September","October","November","December"],ne=A[d.getDay()],xe=M[d.getMonth()],ge=d.getDate(),ve=d.getFullYear();let le=d.getHours();const Se=String(d.getMinutes()).padStart(2,"0"),Te=String(d.getSeconds()).padStart(2,"0"),Ce=le>=12?"PM":"AM";return le=le%12,le=le||12,`${ne}, ${xe} ${ge}, ${ve} at ${le}:${Se}:${Te} ${Ce}`};return e.jsxs(e.Fragment,{children:[e.jsx(ze,{open:l.open,title:"Skip Client",message:"Mark this client as skipped? They will be removed from the queue and not counted as served.",confirmText:"Skip",cancelText:"Cancel",variant:"warning",onConfirm:ue,onCancel:()=>h({open:!1,queueEntryId:null})}),e.jsx("style",{children:`
        .staff-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .staff-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        .queue-item-buttons button {
          min-height: 44px;
        }
        @media (max-width: 768px) {
          .staff-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-dashboard-header > div:first-child {
            width: 100%;
            flex-direction: column;
            align-items: flex-start !important;
            gap: 8px !important;
          }
          .staff-dashboard-header-center {
            width: 100%;
            text-align: left;
          }
          .staff-dashboard-main-grid {
            grid-template-columns: 1fr !important;
          }
          .staff-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .queue-item-grid {
            grid-template-columns: 1fr !important;
            gap: 12px !important;
          }
          .queue-item-buttons {
            flex-direction: row !important;
            width: 100% !important;
            flex-wrap: wrap;
          }
          .queue-item-buttons button {
            flex: 1;
            min-width: 120px;
          }
          .staff-window-assign-grid {
            grid-template-columns: 1fr !important;
          }
        }
        @media (max-width: 480px) {
          .queue-item-buttons {
            flex-direction: column !important;
          }
          .queue-item-buttons button {
            min-width: 100%;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .staff-dashboard-main-grid {
            grid-template-columns: 60% 40% !important;
          }
        }
      `}),e.jsxs("div",{className:"staff-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsxs("div",{className:"staff-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px",flex:1},children:[e.jsx(we,{size:"small"}),n&&e.jsxs("div",{className:"staff-dashboard-header-center",style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:["Operating: ",n.label]})]}),e.jsx(tn,{onProfileClick:k,onLogout:y})]}),e.jsxs("div",{className:"staff-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:G(g)})}),!n&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Assign Window"}),e.jsx("div",{className:"staff-window-assign-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"12px"},children:u.map(d=>e.jsx(O,{onClick:()=>te(d.id),variant:"outline",children:d.label},d.id))})]}),e.jsxs("div",{className:"staff-dashboard-main-grid",style:{display:"grid",gridTemplateColumns:"75% 25%",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"20px"},children:["Queue (",c.length,")"]}),Y.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#f59e0b",marginBottom:"12px"},children:"Priority Clients"}),Y.map(d=>e.jsx(st,{entry:d,onServe:re,onComplete:J,onSkip:ae,servingId:W},d.id))]}),F.length>0&&e.jsxs("div",{children:[Y.length>0&&e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#64748b",marginBottom:"12px"},children:"Regular Clients"}),F.map(d=>e.jsx(st,{entry:d,onServe:re,onComplete:J,onSkip:ae,servingId:W},d.id))]}),c.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#94a3b8"},children:"No clients in queue"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"In Queue"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#f59e0b"},children:c.length})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Total Served Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2563eb"},children:m.totalServed||0})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Skipped Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#ef4444"},children:m.totalSkipped||0})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Analytics"}),e.jsxs($e,{value:j,onChange:d=>R(d.target.value),style:{width:"100%"},children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"yesterday",children:"Yesterday"})]})]}),r&&e.jsxs(e.Fragment,{children:[P.length>0&&e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Category"}),e.jsx(We,{width:"100%",height:200,children:e.jsxs(Je,{data:P,children:[e.jsx(Me,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"name"}),e.jsx(Ue,{}),e.jsx(Pe,{}),e.jsx(Xe,{dataKey:"value",fill:"#2563eb"})]})})]}),U.length>0&&e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Client Type"}),e.jsx(We,{width:"100%",height:200,children:e.jsxs(ft,{children:[e.jsx(ht,{data:U,cx:"50%",cy:"50%",labelLine:!1,label:({name:d,percent:A})=>`${d}: ${(A*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:U.map((d,A)=>e.jsx(mt,{fill:it[A%it.length]},`cell-${A}`))}),e.jsx(Pe,{})]})})]})]})]})]})]})]})]})]})}function st({entry:t,onServe:s,onComplete:a,onSkip:n,servingId:i}){var m,p,u;const c=t.status==="NOW_SERVING",S=i===t.id;return e.jsxs("div",{className:"queue-item-grid",style:{padding:"16px",border:c?"2px solid #2563eb":"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"12px",background:c?"#eff6ff":"white",display:"grid",gridTemplateColumns:"1fr auto",gap:"20px",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"700",color:"#2563eb",marginBottom:"4px"},children:t.queueNumber}),e.jsx("div",{style:{fontSize:"14px",color:"#1e293b",marginBottom:"4px"},children:t.clientName}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px",flexWrap:"wrap"},children:[e.jsx(wt,{clientType:t.clientType}),e.jsxs("span",{style:{fontSize:"12px",color:"#64748b"},children:[((m=t.concernCategories)!=null&&m.length?t.concernCategories:t.category?[t.category]:[]).map(f=>f==null?void 0:f.name).filter(Boolean).join(", "),((p=t.concernSubCategories)!=null&&p.length?t.concernSubCategories:t.subCategory?[t.subCategory]:[]).map(f=>f==null?void 0:f.name).filter(Boolean).length>0&&` - ${((u=t.concernSubCategories)!=null&&u.length?t.concernSubCategories:[t.subCategory]).map(f=>f==null?void 0:f.name).filter(Boolean).join(", ")}`]})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8"},children:["Joined: ",new Date(t.joinedAt).toLocaleTimeString()]})]}),e.jsxs("div",{className:"queue-item-buttons",style:{display:"flex",gap:"8px",flexDirection:"column"},children:[c?e.jsx(O,{variant:"success",icon:Ze,onClick:()=>a(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Mark as Served"}):e.jsx(O,{variant:"primary",icon:Tt,onClick:()=>s(t.id),disabled:S,style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:S?"Serving...":"Start Serving"}),e.jsx(O,{variant:"danger",icon:Dt,onClick:()=>n(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Skip"})]})]})}function sn(){const t=ye(),[s,a]=o.useState(!0),[n,i]=o.useState(!1),[c,S]=o.useState(null),[m,p]=o.useState(null),[u,f]=o.useState(null),[r,v]=o.useState(!1),[j,R]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[g,E]=o.useState(!1),[l,h]=o.useState(null),[W,I]=o.useState([]),[N,$]=o.useState(""),[K,te]=o.useState(!1);o.useEffect(()=>{const P=localStorage.getItem("token"),U=Ie();if(!P||(U==null?void 0:U.role)!=="STAFF"){t("/staff/login");return}re()},[t]);const re=async()=>{var P;try{const U=await C.get("/staff/profile");S(U.data.staff),p(U.data.staff.profilePicture);const G=U.data.currentWindow||null;h(G),$((G==null?void 0:G.id)||"")}catch(U){console.error("Failed to load profile:",U),((P=U.response)==null?void 0:P.status)===401&&t("/staff/login")}finally{a(!1)}},J=async()=>{try{const P=await C.get("/windows/active");I(P.data.windows||[])}catch(P){console.error("Failed to load windows:",P)}};o.useEffect(()=>{J()},[]);const ae=async P=>{var U,G;if(P.preventDefault(),!N||N===(l==null?void 0:l.id)){N===(l==null?void 0:l.id)&&V("You are already assigned to this window");return}te(!0);try{await C.post("/staff/assign-window",{windowId:N});const d=W.find(A=>A.id===N);h(d?{id:d.id,label:d.label}:null),ee("Window changed successfully. You are now operating at "+((d==null?void 0:d.label)||"the selected window")+".")}catch(d){console.error("Failed to switch window:",d),V(((G=(U=d.response)==null?void 0:U.data)==null?void 0:G.error)||"Failed to switch window")}finally{te(!1)}},ue=P=>{const U=P.target.files[0];if(U){const G=new FileReader;G.onloadend=()=>{f(G.result)},G.readAsDataURL(U),p(U)}},y=async P=>{var U,G;P.preventDefault(),i(!0);try{if(await C.put("/staff/profile",{name:c.name}),m instanceof File){const d=new FormData;d.append("picture",m);const A=await C.post("/staff/profile/picture",d,{headers:{"Content-Type":"multipart/form-data"}});p(A.data.profilePicture),f(null)}ee("Profile updated successfully!"),t("/staff/dashboard")}catch(d){console.error("Failed to update profile:",d),V(((G=(U=d.response)==null?void 0:U.data)==null?void 0:G.error)||"Failed to update profile")}finally{i(!1)}},k=async P=>{var U,G;if(P.preventDefault(),j.newPassword!==j.confirmPassword){V("New passwords do not match");return}if(j.newPassword.length<6){V("Password must be at least 6 characters");return}E(!0);try{await C.post("/staff/profile/change-password",{currentPassword:j.currentPassword,newPassword:j.newPassword}),ee("Password changed successfully!"),v(!1),R({currentPassword:"",newPassword:"",confirmPassword:""})}catch(d){console.error("Failed to change password:",d),V(((G=(U=d.response)==null?void 0:U.data)==null?void 0:G.error)||"Failed to change password")}finally{E(!1)}};if(s)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(be,{})});const Y=P=>{if(!P)return"?";const U=P.trim().split(" ");return U.length>=2?(U[0][0]+U[U.length-1][0]).toUpperCase():P.substring(0,2).toUpperCase()},F=u||(c!=null&&c.profilePicture?c.profilePicture:null);return e.jsxs("div",{className:"staff-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .staff-profile-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        @media (max-width: 768px) {
          .staff-profile-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-content {
            margin: 24px auto !important;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-card {
            padding: 24px !important;
          }
          .staff-profile-buttons {
            flex-direction: column !important;
          }
          .staff-profile-buttons button {
            width: 100%;
          }
        }
      `}),e.jsxs("div",{className:"staff-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(we,{size:"small"}),e.jsx(O,{variant:"outline",icon:ct,onClick:()=>t("/staff/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"staff-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"staff-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"32px",color:"#1e293b"},children:"My Profile"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{style:{marginBottom:"32px",textAlign:"center"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",margin:"0 auto 16px",border:"3px solid #e2e8f0",background:F?`url(${F}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"36px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:!F&&Y(c==null?void 0:c.name)}),e.jsxs("label",{style:{display:"inline-block",padding:"8px 16px",background:"#2563eb",color:"white",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s"},onMouseOver:P=>{P.target.style.background="#1e40af"},onMouseOut:P=>{P.target.style.background="#2563eb"},children:["Change Picture",e.jsx("input",{type:"file",accept:"image/*",onChange:ue,style:{display:"none"}})]}),e.jsx("p",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"JPG, PNG, GIF, WebP (max 2MB)"})]}),e.jsx(ie,{label:"Name",value:(c==null?void 0:c.name)||"",onChange:P=>S({...c,name:P.target.value}),required:!0}),e.jsx(ie,{label:"Username",value:(c==null?void 0:c.username)||"",disabled:!0,readOnly:!0}),e.jsxs("div",{className:"staff-profile-buttons",style:{display:"flex",gap:"12px",marginTop:"24px"},children:[e.jsx(O,{type:"submit",icon:pt,disabled:n,fullWidth:!0,children:n?"Saving...":"Save Changes"}),e.jsx(O,{variant:"outline",icon:ce,onClick:()=>t("/staff/dashboard"),fullWidth:!0,children:"Cancel"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Qe,{size:20}),"Operating window"]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"12px"},children:l?`You are currently at ${l.label}.`:"You are not assigned to a window yet."}),e.jsxs("form",{onSubmit:ae,style:{display:"flex",flexDirection:"row",gap:"12px",alignItems:"center",flexWrap:"wrap",maxWidth:"420px"},children:[e.jsx("div",{style:{flex:"1 1 200px"},children:e.jsxs($e,{label:"Switch to window",value:N,onChange:P=>$(P.target.value),children:[e.jsx("option",{value:"",children:"â€” Select window â€”"}),W.map(P=>e.jsx("option",{value:P.id,children:P.label},P.id))]})}),e.jsx(O,{type:"submit",icon:Qe,disabled:K||!N||N===(l==null?void 0:l.id),fullWidth:!0,style:{flex:"1 1 200px",padding:"12px 20px"},children:K?"Switching...":"Switch window"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(O,{variant:"outline",icon:et,onClick:()=>{v(!r),r&&R({currentPassword:"",newPassword:"",confirmPassword:""})},children:r?"Cancel":"Change Password"})]}),r&&e.jsxs("form",{onSubmit:k,children:[e.jsx(ie,{label:"Current Password",type:"password",value:j.currentPassword,onChange:P=>R({...j,currentPassword:P.target.value}),required:!0}),e.jsx(ie,{label:"New Password",type:"password",value:j.newPassword,onChange:P=>R({...j,newPassword:P.target.value}),required:!0}),e.jsx(ie,{label:"Confirm New Password",type:"password",value:j.confirmPassword,onChange:P=>R({...j,confirmPassword:P.target.value}),required:!0}),e.jsx(O,{type:"submit",icon:ut,disabled:g,fullWidth:!0,style:{marginTop:"16px"},children:g?"Changing...":"Change Password"})]})]})]})})]})}function rn(){const t=ye(),[s,a]=o.useState({username:"",password:""}),[n,i]=o.useState(""),[c,S]=o.useState(!1);o.useEffect(()=>{const p=localStorage.getItem("token"),u=Ie();p&&(u==null?void 0:u.role)==="ADMIN"&&t("/admin/dashboard")},[t]);const m=async p=>{var u,f;p.preventDefault(),i(""),S(!0);try{const r=await C.post("/auth/admin/login",s);localStorage.setItem("token",r.data.token),localStorage.setItem("user",JSON.stringify(r.data.user)),t("/admin/dashboard")}catch(r){i(((f=(u=r.response)==null?void 0:u.data)==null?void 0:f.error)||"Login failed")}finally{S(!1)}};return e.jsxs("div",{className:"admin-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .admin-login-root { padding: 16px !important; }
          .admin-login-card { padding: 24px !important; }
          .admin-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"admin-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(we,{size:"medium"})}),e.jsx("h1",{className:"admin-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Admin Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage the system"}),e.jsxs("form",{onSubmit:m,children:[e.jsx(ie,{label:"Username",value:s.username,onChange:p=>a({...s,username:p.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(ie,{label:"Password",type:"password",value:s.password,onChange:p=>a({...s,password:p.target.value}),placeholder:"Enter your password",required:!0}),n&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:n}),e.jsx(O,{type:"submit",fullWidth:!0,disabled:c,children:c?"Logging in...":"Login"})]})]})]})}function ln({onProfileClick:t,onLogout:s}){const[a,n]=o.useState(!1),[i,c]=o.useState(null),[S,m]=o.useState(!0),p=o.useRef(null);ye(),o.useEffect(()=>{u()},[]),o.useEffect(()=>{const r=v=>{p.current&&!p.current.contains(v.target)&&n(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const u=async()=>{try{const r=Ie();r&&c({name:r.name||"Admin",username:r.username})}catch(r){console.error("Failed to load profile:",r)}finally{m(!1)}},f=r=>{if(!r)return"A";const v=r.trim().split(" ");return v.length>=2?(v[0][0]+v[v.length-1][0]).toUpperCase():r.substring(0,2).toUpperCase()};return S?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:p,children:[e.jsx("button",{onClick:()=>n(!a),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:r=>{r.target.style.borderColor="#2563eb",r.target.style.transform="scale(1.05)"},onMouseOut:r=>{r.target.style.borderColor="#e2e8f0",r.target.style.transform="scale(1)"},children:f(i==null?void 0:i.name)}),a&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(i==null?void 0:i.name)||(i==null?void 0:i.username)||"Admin"}),t&&e.jsxs("button",{onClick:()=>{n(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#f1f5f9"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(lt,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{n(!1),s()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:r=>{r.currentTarget.style.background="#fee2e2"},onMouseOut:r=>{r.currentTarget.style.background="transparent"},children:[e.jsx(dt,{size:18}),"Logout"]})]})]})}function dn({open:t,title:s,message:a,placeholder:n="",onConfirm:i,onCancel:c,confirmText:S="Confirm",cancelText:m="Cancel",type:p="text",required:u=!0}){const[f,r]=o.useState("");if(o.useEffect(()=>{t&&r("")},[t]),!t)return null;const v=()=>{u&&!f.trim()||(i(f),r(""))},j=()=>{r(""),c()};return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:s}),e.jsx("button",{onClick:j,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ce,{size:20})})]}),a&&e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px",lineHeight:"1.6"},children:a}),e.jsx("input",{type:p,value:f,onChange:R=>r(R.target.value),placeholder:n,required:u,style:{width:"100%",padding:"10px 12px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px",marginBottom:"24px",transition:"border-color 0.2s"},onFocus:R=>{R.target.style.borderColor="#2563eb"},onBlur:R=>{R.target.style.borderColor="#e2e8f0"},onKeyDown:R=>{R.key==="Enter"?v():R.key==="Escape"&&j()},autoFocus:!0}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:j,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:R=>{R.target.style.background="#f1f5f9",R.target.style.borderColor="#cbd5e1"},onMouseOut:R=>{R.target.style.background="transparent",R.target.style.borderColor="#e2e8f0"},children:m}),e.jsx("button",{onClick:v,disabled:u&&!f.trim(),style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:u&&!f.trim()?"#cbd5e1":"#2563eb",color:"white",fontSize:"14px",fontWeight:"600",cursor:u&&!f.trim()?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:R=>{u&&!f.trim()||(R.target.style.background="#1e40af",R.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)")},onMouseOut:R=>{u&&!f.trim()||(R.target.style.background="#2563eb",R.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)")},children:S})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const rt=["#2563eb","#10b981","#f59e0b","#ef4444","#8b5cf6"];function De(t,s){var n;const a=(n=t==null?void 0:t.response)==null?void 0:n.data;if(a!=null&&a.error&&typeof a.error=="string")return a.error;if(Array.isArray(a==null?void 0:a.errors)&&a.errors.length>0){const i=a.errors[0];return(i==null?void 0:i.msg)||(i==null?void 0:i.message)||s}return s}function cn(){const t=ye(),[s,a]=o.useState("dashboard"),[n,i]=o.useState(!0),[c,S]=o.useState(null),[m,p]=o.useState([]),[u,f]=o.useState([]),[r,v]=o.useState([]),[j,R]=o.useState(null),[g,E]=o.useState({startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""}),[l,h]=o.useState(!1),[W,I]=o.useState({open:!1,data:{}}),[N,$]=o.useState({open:!1,data:{}}),[K,te]=o.useState({open:!1,data:{}}),[re,J]=o.useState({open:!1,data:{}}),[ae,ue]=o.useState({open:!1,title:"",message:"",placeholder:"",type:"text",onConfirm:()=>{},onCancel:()=>{}});o.useEffect(()=>{const d=localStorage.getItem("token"),A=Ie();if(!d||(A==null?void 0:A.role)!=="ADMIN"){t("/admin/login");return}y();const M=setInterval(()=>{s==="dashboard"&&k()},3e3);return()=>clearInterval(M)},[t,s]),o.useEffect(()=>{s==="reports"&&U()},[s,g]);const y=async()=>{try{await Promise.all([k(),Y(),F(),P()])}catch(d){console.error("Error loading data:",d)}finally{i(!1)}},k=async()=>{try{const d=await C.get("/admin/dashboard");S(d.data.stats)}catch(d){console.error("Failed to load dashboard:",d)}},Y=async()=>{try{const d=await C.get("/admin/staff");p(d.data.staff)}catch(d){console.error("Failed to load staff:",d)}},F=async()=>{try{const d=await C.get("/admin/windows");f(d.data.windows)}catch(d){console.error("Failed to load windows:",d)}},P=async()=>{try{const d=await C.get("/categories");v(d.data.categories)}catch(d){console.error("Failed to load categories:",d)}},U=async()=>{try{const d=new URLSearchParams;d.append("startDate",g.startDate),d.append("endDate",g.endDate),g.staffIds&&g.staffIds.length>0&&g.staffIds.forEach(M=>d.append("staffId",M)),g.categoryIds&&g.categoryIds.length>0&&g.categoryIds.forEach(M=>d.append("categoryId",M)),g.clientTypes&&g.clientTypes.length>0&&g.clientTypes.forEach(M=>d.append("clientType",M)),g.startHour&&d.append("startHour",g.startHour),g.endHour&&d.append("endHour",g.endHour);const A=await C.get(`/admin/reports?${d.toString()}`);R(A.data)}catch(d){console.error("Failed to load reports:",d)}},G=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t("/admin/login")};return n?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(be,{})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .admin-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .admin-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        @media (max-width: 768px) {
          .admin-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-dashboard-header > div:first-child {
            flex-direction: row;
            align-items: center;
            gap: 12px;
          }
          .admin-dashboard-header h1 {
            font-size: 20px !important;
          }
          .admin-dashboard-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
          }
          .admin-dashboard-tabs button {
            white-space: nowrap;
            font-size: 13px;
            padding: 10px 16px !important;
            min-height: 44px;
            flex-shrink: 0;
          }
          .admin-dashboard-tabs button span {
            display: none;
          }
          .admin-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-stats-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-reports-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-filter-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-page-header {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 12px;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) !important;
          }
          .admin-modal-overlay {
            padding: 16px;
            align-items: flex-start;
            overflow-y: auto;
          }
          .admin-modal-box {
            max-height: calc(100vh - 32px);
            overflow-y: auto;
            width: 100%;
            margin: auto;
          }
          .admin-settings-buttons {
            flex-wrap: wrap;
          }
          .admin-settings-buttons button {
            min-width: 140px;
          }
          .admin-reports-table-wrap {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -16px;
            padding: 0 16px;
          }
        }
        @media (max-width: 480px) {
          .admin-stats-grid,
          .admin-stats-grid-4,
          .admin-cards-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-dashboard-tabs button {
            padding: 12px 14px !important;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(3, 1fr) !important;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 16px;
          }
        }
      `}),e.jsxs("div",{className:"admin-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx(dn,{...ae}),e.jsxs("div",{className:"admin-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"24px",flex:1},children:[e.jsx(we,{size:"small"}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:"#1e293b",margin:0},children:"Admin Dashboard"})]}),e.jsx(ln,{onProfileClick:()=>t("/admin/profile"),onLogout:G})]}),e.jsx("div",{className:"admin-dashboard-tabs",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"0 24px",display:"flex",gap:"4px"},children:[{id:"dashboard",label:"Dashboard",icon:zt},{id:"staff",label:"Staff",icon:Rt},{id:"windows",label:"Windows",icon:xt},{id:"categories",label:"Categories",icon:gt},{id:"reports",label:"Reports",icon:Wt},{id:"settings",label:"Settings",icon:Pt}].map(d=>{const A=d.icon,M=s===d.id;return e.jsxs("button",{onClick:()=>a(d.id),style:{padding:"12px 20px",border:"none",background:M?"#eff6ff":"transparent",borderBottom:M?"3px solid #2563eb":"3px solid transparent",color:M?"#2563eb":"#64748b",fontWeight:M?"600":"400",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s",borderRadius:"8px 8px 0 0"},onMouseOver:ne=>{M||(ne.target.style.background="#f1f5f9",ne.target.style.color="#475569")},onMouseOut:ne=>{M||(ne.target.style.background="transparent",ne.target.style.color="#64748b")},children:[e.jsx(A,{size:18}),e.jsx("span",{children:d.label})]},d.id)})}),e.jsxs("div",{className:"admin-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[s==="dashboard"&&e.jsx(pn,{stats:c}),s==="staff"&&e.jsx(un,{staff:m,categories:r,onRefresh:Y,form:W,setForm:I,setInputDialog:ue}),s==="windows"&&e.jsx(xn,{windows:u,onRefresh:F,form:N,setForm:$}),s==="categories"&&e.jsx(gn,{categories:r,onRefresh:P,categoryForm:K,setCategoryForm:te,subCategoryForm:re,setSubCategoryForm:J}),s==="reports"&&e.jsx(fn,{reports:j,filters:g,setFilters:E,staff:m,categories:r,showFilters:l,setShowFilters:h,onRefresh:U}),s==="settings"&&e.jsx(hn,{})]})]})]})}function pn({stats:t}){const[s,a]=o.useState(new Date);if(o.useEffect(()=>{const i=setInterval(()=>{a(new Date)},1e3);return()=>clearInterval(i)},[]),!t)return e.jsx(be,{});const n=i=>{const c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],S=["January","February","March","April","May","June","July","August","September","October","November","December"],m=c[i.getDay()],p=S[i.getMonth()],u=i.getDate(),f=i.getFullYear();let r=i.getHours();const v=String(i.getMinutes()).padStart(2,"0"),j=String(i.getSeconds()).padStart(2,"0"),R=r>=12?"PM":"AM";return r=r%12,r=r||12,`${m}, ${p} ${u}, ${f} at ${r}:${v}:${j} ${R}`};return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:n(s)})}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"16px"},children:[e.jsx(me,{label:"Queue Entries Today",value:t.todayQueueEntries,icon:At,color:"#2563eb"}),e.jsx(me,{label:"Serving",value:t.servingCount,icon:Et,color:"#2563eb"}),e.jsx(me,{label:"Waiting",value:t.waitingCount,icon:Bt,color:"#f59e0b"}),e.jsx(me,{label:"Served Today",value:t.todayServed,icon:Ze,color:"#10b981"})]}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsx(me,{label:"Active Windows",value:t.activeWindows,icon:Qe,color:"#10b981"}),e.jsx(me,{label:"Active Staff",value:t.activeStaff,icon:Nt,color:"#10b981"}),e.jsx(me,{label:"Total Windows",value:t.totalWindows,icon:Lt,color:"#2563eb"}),e.jsx(me,{label:"Total Staff",value:t.totalStaff,icon:Ot,color:"#2563eb"})]})]})}function me({label:t,value:s,color:a="#2563eb",icon:n}){return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[n&&e.jsx(n,{size:20,color:a,style:{flexShrink:0}}),e.jsx("div",{style:{fontSize:"14px",color:"#64748b",fontWeight:"500"},children:t})]}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:a,lineHeight:"1.2"},children:s||0})]})}function un({staff:t,categories:s,onRefresh:a,form:n,setForm:i,setInputDialog:c}){const[S,m]=o.useState(null),[p,u]=o.useState(!1),f=o.useRef(null),[r,v]=o.useState({open:!1});o.useEffect(()=>{const l=h=>{f.current&&!f.current.contains(h.target)&&u(!1)};return p&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[p]);const j=async l=>{l.preventDefault();try{await C.post("/admin/staff",n.data),i({open:!1,data:{}}),ee("Staff created successfully!"),a()}catch(h){V(De(h,"Failed to create staff"))}},R=async l=>{l.preventDefault();try{await C.put(`/admin/staff/${S.id}`,n.data),i({open:!1,data:{}}),m(null),ee("Staff updated successfully!"),a()}catch(h){V(De(h,"Failed to update staff"))}},g=async(l,h)=>{try{await C.put(`/admin/staff/${l}`,{isActive:!h}),ee(`Staff ${h?"deactivated":"activated"} successfully!`),a()}catch(W){V(De(W,"Failed to update staff"))}},E=async(l,h)=>{c({open:!0,title:"Reset Password",message:`Enter new password for ${h}:`,placeholder:"New password (min 6 characters)",type:"password",onConfirm:async W=>{var I,N;if(c({open:!1}),!!W){if(W.length<6){V("Password must be at least 6 characters");return}try{await C.post(`/admin/staff/${l}/reset-password`,{password:W}),ee("Password reset successfully!")}catch($){V(((N=(I=$.response)==null?void 0:I.data)==null?void 0:N.error)||"Failed to reset password")}}},onCancel:()=>c({open:!1})})};return e.jsxs("div",{children:[e.jsx(ze,{...r}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Staff Management"}),e.jsx(O,{onClick:()=>{i({open:!0,data:{}}),m(null)},children:"Add Staff"})]}),n.open&&Ne.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{i({open:!1,data:{}}),m(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:S?"Edit Staff":"Create Staff"}),e.jsx("button",{onClick:()=>{i({open:!1,data:{}}),m(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ce,{size:20})})]}),e.jsxs("form",{onSubmit:S?R:j,children:[e.jsx(ie,{label:"Username",value:n.data.username||"",onChange:l=>i({...n,data:{...n.data,username:l.target.value}}),required:!S,disabled:!!S}),e.jsx(ie,{label:"Name",value:n.data.name||"",onChange:l=>i({...n,data:{...n.data,name:l.target.value}}),required:!0}),(!S||n.data.password)&&e.jsx(ie,{label:"Password",type:"password",value:n.data.password||"",onChange:l=>i({...n,data:{...n.data,password:l.target.value}}),required:!S}),e.jsxs("div",{style:{marginBottom:"16px",position:"relative"},ref:f,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Specializations (Categories)"}),e.jsx("div",{onClick:()=>u(!p),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:n.data.categoryIds&&n.data.categoryIds.length>0?n.data.categoryIds.map(l=>{const h=s.find(W=>W.id===l);return h?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:W=>{W.stopPropagation(),i({...n,data:{...n.data,categoryIds:n.data.categoryIds.filter(I=>I!==l)}})},children:[h.name,e.jsx(ce,{size:12})]},l):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),p&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:s.map(l=>{var W;const h=((W=n.data.categoryIds)==null?void 0:W.includes(l.id))||!1;return e.jsxs("div",{onClick:()=>{const I=n.data.categoryIds||[];i(h?{...n,data:{...n.data,categoryIds:I.filter(N=>N!==l.id)}}:{...n,data:{...n.data,categoryIds:[...I,l.id]}})},style:{padding:"10px 12px",cursor:"pointer",background:h?"#eff6ff":"white",color:h?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:I=>{h||(I.currentTarget.style.background="#f8fafc")},onMouseOut:I=>{h||(I.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:h,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:l.name})]},l.id)})})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(O,{variant:"outline",icon:ce,onClick:()=>{i({open:!1,data:{}}),m(null)},children:"Cancel"}),e.jsx(O,{type:"submit",icon:Le,children:S?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(l=>{const h=l.name?l.name.split(" ").map(I=>I[0]).join("").toUpperCase().slice(0,2):l.username.charAt(0).toUpperCase(),W=l.specializations?l.specializations.map(I=>I.category.name):[];return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:l.profilePictureUrl?"transparent":"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",marginBottom:"8px",border:l.profilePictureUrl?"2px solid #e2e8f0":"none"},children:l.profilePictureUrl?e.jsx("img",{src:l.profilePictureUrl,alt:l.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("span",{style:{color:"white",fontSize:"28px",fontWeight:"600"},children:h})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:l.name}),e.jsx("div",{style:{fontSize:"12px",color:"#64748b"},children:l.username})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:W.length>0?W.map((I,N)=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:I},N)):e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#f1f5f9",color:"#64748b",fontWeight:"500"},children:"All categories"})}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:l.isActive?"#ecfdf5":"#fef2f2",color:l.isActive?"#059669":"#dc2626",fontWeight:"600"},children:l.isActive?"Active":"Inactive"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{m(l),i({open:!0,data:{username:l.username,name:l.name,categoryIds:l.specializations?l.specializations.map(I=>I.categoryId):[]}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"25%"},onMouseOver:I=>{I.target.style.background="#eff6ff"},onMouseOut:I=>{I.target.style.background="transparent"},children:[e.jsx(tt,{size:14}),"Edit"]}),e.jsxs("button",{onClick:()=>E(l.id,l.name),style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"75%"},onMouseOver:I=>{I.target.style.background="#eff6ff"},onMouseOut:I=>{I.target.style.background="transparent"},children:[e.jsx(et,{size:14}),"Reset Password"]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",width:"100%"},children:[e.jsx(O,{variant:l.isActive?"danger":"success",icon:Mt,onClick:()=>g(l.id,l.isActive),style:{fontSize:"12px",padding:"6px 12px",flex:1},children:l.isActive?"Deactivate":"Activate"}),e.jsx(O,{variant:"danger",icon:Ve,onClick:()=>{v({open:!0,title:"Remove Staff",message:`Are you sure you want to remove ${l.name||l.username}? This cannot be undone and is only allowed if the staff has no serving history.`,onConfirm:async()=>{v({open:!1});try{await C.delete(`/admin/staff/${l.id}`),ee("Staff removed successfully!"),a()}catch(I){V(De(I,"Failed to remove staff"))}},onCancel:()=>v({open:!1})})},style:{fontSize:"12px",padding:"6px 12px",flex:1},children:"Remove"})]})]})]},l.id)})})]})}function xn({windows:t,onRefresh:s,form:a,setForm:n}){const[i,c]=o.useState(null),[S,m]=o.useState({open:!1}),p=async r=>{r.preventDefault();try{await C.post("/admin/windows",a.data),n({open:!1,data:{}}),ee("Window created successfully!"),s()}catch(v){V(De(v,"Failed to create window"))}},u=async r=>{r.preventDefault();try{await C.put(`/admin/windows/${i.id}`,a.data),n({open:!1,data:{}}),c(null),ee("Window updated successfully!"),s()}catch(v){V(De(v,"Failed to update window"))}},f=async r=>{m({open:!0,title:"Delete Window",message:"Are you sure you want to delete this window? This action cannot be undone.",onConfirm:async()=>{m({open:!1});try{await C.delete(`/admin/windows/${r}`),ee("Window deleted successfully!"),s()}catch(v){V(De(v,"Failed to delete window"))}},onCancel:()=>m({open:!1})})};return e.jsxs("div",{children:[e.jsx(ze,{...S}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Window Management"}),e.jsx(O,{icon:Ke,onClick:()=>{n({open:!0,data:{isActive:!0}}),c(null)},children:"Add Window"})]}),a.open&&Ne.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{n({open:!1,data:{}}),c(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:i?"Edit Window":"Create Window"}),e.jsx("button",{onClick:()=>{n({open:!1,data:{}}),c(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ce,{size:20})})]}),e.jsxs("form",{onSubmit:i?u:p,children:[e.jsx(ie,{label:"Window Label",value:a.data.label||"",onChange:r=>n({...a,data:{...a.data,label:r.target.value}}),required:!0}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[e.jsx("input",{type:"checkbox",checked:a.data.isActive!==!1,onChange:r=>n({...a,data:{...a.data,isActive:r.target.checked}})}),"Active"]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(O,{variant:"outline",icon:ce,onClick:()=>{n({open:!1,data:{}}),c(null)},children:"Cancel"}),e.jsx(O,{type:"submit",icon:Le,children:i?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(r=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(xt,{size:40,color:"white"})}),e.jsx("div",{style:{textAlign:"center",marginBottom:"8px"},children:e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:r.label})}),r.assignments&&r.assignments.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:r.assignments.map(v=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:v.staff.name},v.id))}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:r.isActive?"#ecfdf5":"#fef2f2",color:r.isActive?"#059669":"#dc2626",fontWeight:"600"},children:r.isActive?"Active":"Inactive"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{c(r),n({open:!0,data:{label:r.label,isActive:r.isActive}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:v=>{v.target.style.background="#eff6ff"},onMouseOut:v=>{v.target.style.background="transparent"},children:[e.jsx(tt,{size:14}),"Edit"]}),e.jsx(O,{variant:"danger",icon:Ve,onClick:()=>f(r.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})})]},r.id))})]})}function gn({categories:t,onRefresh:s,categoryForm:a,setCategoryForm:n,subCategoryForm:i,setSubCategoryForm:c}){const[S,m]=o.useState(null),[p,u]=o.useState({open:!1}),f=async g=>{var E,l;g.preventDefault();try{await C.post("/admin/categories",a.data),n({open:!1,data:{}}),ee("Category created successfully!"),s()}catch(h){V(((l=(E=h.response)==null?void 0:E.data)==null?void 0:l.error)||"Failed to create category")}},r=async g=>{var E,l;g.preventDefault();try{await C.put(`/admin/categories/${S.id}`,a.data),n({open:!1,data:{}}),m(null),ee("Category updated successfully!"),s()}catch(h){V(((l=(E=h.response)==null?void 0:E.data)==null?void 0:l.error)||"Failed to update category")}},v=async g=>{u({open:!0,title:"Delete Category",message:"Are you sure you want to delete this category? All subcategories will be deleted. This action cannot be undone.",onConfirm:async()=>{var E,l;u({open:!1});try{await C.delete(`/admin/categories/${g}`),ee("Category deleted successfully!"),s()}catch(h){V(((l=(E=h.response)==null?void 0:E.data)==null?void 0:l.error)||"Failed to delete category")}},onCancel:()=>u({open:!1})})},j=async g=>{var E,l;g.preventDefault();try{await C.post(`/admin/categories/${i.data.categoryId}/subcategories`,{name:i.data.name,description:i.data.description}),c({open:!1,data:{}}),ee("Subcategory created successfully!"),s()}catch(h){V(((l=(E=h.response)==null?void 0:E.data)==null?void 0:l.error)||"Failed to create subcategory")}},R=async g=>{u({open:!0,title:"Delete Subcategory",message:"Are you sure you want to delete this subcategory? This action cannot be undone.",onConfirm:async()=>{var E,l;u({open:!1});try{await C.delete(`/admin/subcategories/${g}`),ee("Subcategory deleted successfully!"),s()}catch(h){V(((l=(E=h.response)==null?void 0:E.data)==null?void 0:l.error)||"Failed to delete subcategory")}},onCancel:()=>u({open:!1})})};return e.jsxs("div",{children:[e.jsx(ze,{...p}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Category Management"}),e.jsx(O,{icon:Ke,onClick:()=>{n({open:!0,data:{}}),m(null)},children:"Add Category"})]}),a.open&&Ne.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{n({open:!1,data:{}}),m(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:S?"Edit Category":"Create Category"}),e.jsx("button",{onClick:()=>{n({open:!1,data:{}}),m(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ce,{size:20})})]}),e.jsxs("form",{onSubmit:S?r:f,children:[e.jsx(ie,{label:"Category Name",value:a.data.name||"",onChange:g=>n({...a,data:{...a.data,name:g.target.value}}),required:!0}),e.jsx(ie,{label:"Description (Optional)",value:a.data.description||"",onChange:g=>n({...a,data:{...a.data,description:g.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(O,{variant:"outline",icon:ce,onClick:()=>{n({open:!1,data:{}}),m(null)},children:"Cancel"}),e.jsx(O,{type:"submit",icon:Le,children:S?"Update":"Create"})]})]})]})}),document.body),i.open&&Ne.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{c({open:!1,data:{}})},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Add Subcategory"}),e.jsx("button",{onClick:()=>{c({open:!1,data:{}})},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ce,{size:20})})]}),e.jsxs("form",{onSubmit:j,children:[e.jsx(ie,{label:"Subcategory Name",value:i.data.name||"",onChange:g=>c({...i,data:{...i.data,name:g.target.value}}),required:!0}),e.jsx(ie,{label:"Description (Optional)",value:i.data.description||"",onChange:g=>c({...i,data:{...i.data,description:g.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(O,{variant:"outline",icon:ce,onClick:()=>{c({open:!1,data:{}})},children:"Cancel"}),e.jsx(O,{type:"submit",icon:Le,children:"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(g=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#10b981",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(gt,{size:40,color:"white"})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:g.name}),g.description&&e.jsx("div",{style:{fontSize:"12px",color:"#64748b",lineHeight:"1.4"},children:g.description})]}),g.subCategories&&g.subCategories.length>0&&e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"600"},children:[g.subCategories.length," Subcategor",g.subCategories.length===1?"y":"ies"]})}),g.subCategories&&g.subCategories.length>0&&e.jsx("div",{style:{width:"100%",marginBottom:"8px",maxHeight:"120px",overflowY:"auto",padding:"8px",background:"#f8fafc",borderRadius:"8px"},children:g.subCategories.map(E=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",marginBottom:"4px",background:"white",borderRadius:"6px",fontSize:"12px"},children:[e.jsx("span",{style:{fontWeight:"500",color:"#1e293b"},children:E.name}),e.jsx("button",{onClick:()=>R(E.id),style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"2px 6px",fontSize:"12px",borderRadius:"4px"},onMouseOver:l=>{l.target.style.background="#fee2e2"},onMouseOut:l=>{l.target.style.background="transparent"},children:e.jsx(Ve,{size:12})})]},E.id))}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsx(O,{variant:"outline",icon:Ke,onClick:()=>{c({open:!0,data:{categoryId:g.id,name:"",description:""}})},style:{fontSize:"12px",padding:"6px 12px",width:"100%"},children:"Add Subcategory"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{m(g),n({open:!0,data:{name:g.name,description:g.description||""}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:E=>{E.target.style.background="#eff6ff"},onMouseOut:E=>{E.target.style.background="transparent"},children:[e.jsx(tt,{size:14}),"Edit"]}),e.jsx(O,{variant:"danger",icon:Ve,onClick:()=>v(g.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})]})]},g.id))})]})}function fn({reports:t,filters:s,setFilters:a,staff:n,categories:i,showFilters:c,setShowFilters:S,onRefresh:m}){const[p,u]=o.useState(s),[f,r]=o.useState(!1),[v,j]=o.useState(!1),[R,g]=o.useState(!1),E=o.useRef(null),l=o.useRef(null),h=o.useRef(null);o.useEffect(()=>{c&&u(s)},[c]),o.useEffect(()=>{const y=k=>{E.current&&!E.current.contains(k.target)&&r(!1),l.current&&!l.current.contains(k.target)&&j(!1),h.current&&!h.current.contains(k.target)&&g(!1)};return(f||v||R)&&document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[f,v,R]);const W=["REGULAR","SENIOR_CITIZEN","PWD","PREGNANT"],I=Array.from({length:24},(y,k)=>k),N=()=>{const y=new Date().toISOString().split("T")[0],k={startDate:y,endDate:y,staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""};a(k),u(k)},$=()=>{a(p),S(!1)},K=()=>{u(s),S(!1)},te=s.staffIds.length>0||s.categoryIds.length>0||s.clientTypes.length>0||s.startHour||s.endHour;if(!t)return e.jsx(be,{});const re=t.byCategory?Object.entries(t.byCategory).map(([y,k])=>({name:y,value:k})):[],J=t.byClientType?Object.entries(t.byClientType).map(([y,k])=>({name:y,value:k})):[],ae=t.byStaff?Object.entries(t.byStaff).map(([y,k])=>({name:y,value:k})):[],ue=t.byHour?Object.entries(t.byHour).sort((y,k)=>parseInt(y[0])-parseInt(k[0])).map(([y,k])=>({hour:`${y}:00`,value:k})):[];return e.jsxs("div",{children:[e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Reports & Analytics"}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[te&&e.jsxs("button",{onClick:N,style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontWeight:"500"},onMouseOver:y=>{y.target.style.color="#1e293b"},onMouseOut:y=>{y.target.style.color="#64748b"},children:[e.jsx(ce,{size:16}),"Clear Filters"]}),e.jsxs("button",{onClick:()=>S(!0),style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:te?"#2563eb":"#64748b",fontWeight:"500"},onMouseOver:y=>{y.target.style.color="#2563eb"},onMouseOut:y=>{y.target.style.color=te?"#2563eb":"#64748b"},children:[e.jsx(Ft,{size:16}),"Filters"]})]})]}),c&&Ne.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:K,className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"800px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Filter Reports"}),e.jsx("button",{onClick:K,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"admin-filter-grid",style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 2fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Date"}),e.jsx("input",{type:"date",value:p.startDate,onChange:y=>u({...p,startDate:y.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Date"}),e.jsx("input",{type:"date",value:p.endDate,onChange:y=>u({...p,endDate:y.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{style:{position:"relative"},ref:E,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Staff"}),e.jsx("div",{onClick:()=>r(!f),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.staffIds&&p.staffIds.length>0?p.staffIds.map(y=>{const k=n.find(Y=>Y.id===y);return k?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:Y=>{Y.stopPropagation(),u({...p,staffIds:p.staffIds.filter(F=>F!==y)})},children:[k.name,e.jsx(ce,{size:12})]},y):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select staff..."})}),f&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:n.map(y=>{var Y;const k=((Y=p.staffIds)==null?void 0:Y.includes(y.id))||!1;return e.jsxs("div",{onClick:()=>{const F=p.staffIds||[];u(k?{...p,staffIds:F.filter(P=>P!==y.id)}:{...p,staffIds:[...F,y.id]})},style:{padding:"10px 12px",cursor:"pointer",background:k?"#eff6ff":"white",color:k?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:F=>{k||(F.currentTarget.style.background="#f8fafc")},onMouseOut:F=>{k||(F.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:k,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:y.name})]},y.id)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{style:{position:"relative"},ref:l,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Categories"}),e.jsx("div",{onClick:()=>j(!v),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.categoryIds&&p.categoryIds.length>0?p.categoryIds.map(y=>{const k=i.find(Y=>Y.id===y);return k?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:Y=>{Y.stopPropagation(),u({...p,categoryIds:p.categoryIds.filter(F=>F!==y)})},children:[k.name,e.jsx(ce,{size:12})]},y):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),v&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:i.map(y=>{var Y;const k=((Y=p.categoryIds)==null?void 0:Y.includes(y.id))||!1;return e.jsxs("div",{onClick:()=>{const F=p.categoryIds||[];u(k?{...p,categoryIds:F.filter(P=>P!==y.id)}:{...p,categoryIds:[...F,y.id]})},style:{padding:"10px 12px",cursor:"pointer",background:k?"#eff6ff":"white",color:k?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:F=>{k||(F.currentTarget.style.background="#f8fafc")},onMouseOut:F=>{k||(F.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:k,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:y.name})]},y.id)})})]}),e.jsxs("div",{style:{position:"relative"},ref:h,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Client Types"}),e.jsx("div",{onClick:()=>g(!R),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:p.clientTypes&&p.clientTypes.length>0?p.clientTypes.map(y=>e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:k=>{k.stopPropagation(),u({...p,clientTypes:p.clientTypes.filter(Y=>Y!==y)})},children:[y.replace("_"," "),e.jsx(ce,{size:12})]},y)):e.jsx("span",{style:{color:"#94a3b8"},children:"Select client types..."})}),R&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:W.map(y=>{var Y;const k=((Y=p.clientTypes)==null?void 0:Y.includes(y))||!1;return e.jsxs("div",{onClick:()=>{const F=p.clientTypes||[];u(k?{...p,clientTypes:F.filter(P=>P!==y)}:{...p,clientTypes:[...F,y]})},style:{padding:"10px 12px",cursor:"pointer",background:k?"#eff6ff":"white",color:k?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:F=>{k||(F.currentTarget.style.background="#f8fafc")},onMouseOut:F=>{k||(F.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:k,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:y.replace("_"," ")})]},y)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Hour (Peak Hours)"}),e.jsxs($e,{value:p.startHour,onChange:y=>u({...p,startHour:y.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),I.map(y=>e.jsxs("option",{value:y,children:[String(y).padStart(2,"0"),":00"]},y))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Hour (Peak Hours)"}),e.jsxs($e,{value:p.endHour,onChange:y=>u({...p,endHour:y.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),I.map(y=>e.jsxs("option",{value:y,children:[String(y).padStart(2,"0"),":00"]},y))]})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end",marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #e2e8f0"},children:[e.jsx(O,{variant:"outline",icon:ce,onClick:K,children:"Cancel"}),e.jsx(O,{variant:"primary",icon:Le,onClick:$,children:"Apply Filters"})]})]})}),document.body),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"24px"},children:[e.jsx(me,{label:"Total Served",value:t.totalServed}),e.jsx(me,{label:"Average Duration",value:`${Math.floor((t.averageDuration||0)/60)}m ${(t.averageDuration||0)%60}s`})]}),e.jsxs("div",{className:"admin-reports-grid",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"24px"},children:[re.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Category"}),e.jsx(We,{width:"100%",height:300,children:e.jsxs(Je,{data:re,children:[e.jsx(Me,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"name"}),e.jsx(Ue,{}),e.jsx(Pe,{}),e.jsx(Xe,{dataKey:"value",fill:"#2563eb"})]})})]}),J.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Client Type"}),e.jsx(We,{width:"100%",height:300,children:e.jsxs(ft,{children:[e.jsx(ht,{data:J,cx:"50%",cy:"50%",labelLine:!1,label:({name:y,percent:k})=>`${y}: ${(k*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:J.map((y,k)=>e.jsx(mt,{fill:rt[k%rt.length]},`cell-${k}`))}),e.jsx(Pe,{})]})})]})]}),ue.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",marginBottom:"24px"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"Peak Hours"}),e.jsx(We,{width:"100%",height:300,children:e.jsxs($t,{data:ue,children:[e.jsx(Me,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"hour"}),e.jsx(Ue,{}),e.jsx(Pe,{}),e.jsx(Yt,{type:"monotone",dataKey:"value",stroke:"#2563eb",strokeWidth:2})]})})]}),ae.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Staff"}),e.jsx(We,{width:"100%",height:300,children:e.jsxs(Je,{data:ae,children:[e.jsx(Me,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"name"}),e.jsx(Ue,{}),e.jsx(Pe,{}),e.jsx(Xe,{dataKey:"value",fill:"#10b981"})]})})]})]})}function hn(){const[t,s]=o.useState(null),[a,n]=o.useState(null),[i,c]=o.useState(null),[S,m]=o.useState(!0),[p,u]=o.useState(!1),[f,r]=o.useState({open:!1}),[v,j]=o.useState(null),[R,g]=o.useState(null),[E,l]=o.useState(!1),[h,W]=o.useState({open:!1}),[I,N]=o.useState([{id:"",name:""},{id:"",name:""},{id:"",name:""}]),[$,K]=o.useState(""),[te,re]=o.useState(!1),[J,ae]=o.useState("youtube"),[ue,y]=o.useState(!1),[k,Y]=o.useState(""),[F,P]=o.useState(!1),[U,G]=o.useState("50"),[d,A]=o.useState(!1),[M,ne]=o.useState("branding"),[xe,ge]=o.useState({open:!1}),[ve,le]=o.useState(!1);o.useEffect(()=>{Se(),Te(),Ce(),Ye(),Ge(),_e()},[]);const Se=async()=>{try{const x=await C.get("/admin/settings/logo");x.data.logoUrl&&c(x.data.logoUrl)}catch(x){console.error("Failed to load logo:",x)}finally{m(!1)}},Te=async()=>{try{const x=await C.get("/admin/settings/ding-sound");x.data.dingSoundUrl&&g(x.data.dingSoundUrl)}catch(x){console.error("Failed to load ding sound:",x)}},Ce=async()=>{var x;try{const w=await C.get("/admin/settings/tts-voices"),D=Array.isArray(w.data.voices)?w.data.voices:[],L=[...D];for(;L.length<3;)L.push({id:"",name:""});N(L.slice(0,3)),w.data.activeVoiceId?K(w.data.activeVoiceId):(x=D[0])!=null&&x.id&&K(D[0].id)}catch(w){console.error("Failed to load TTS voices:",w)}},Ye=async()=>{try{const x=await C.get("/admin/settings/video-source");ae(x.data.videoSource||"youtube")}catch(x){console.error("Failed to load video source:",x)}},_e=async()=>{try{const w=(await C.get("/admin/settings/video-volume")).data.videoVolumePercent;typeof w=="number"&&!Number.isNaN(w)&&G(String(Math.max(0,Math.min(100,w))))}catch(x){console.error("Failed to load video volume:",x)}},Ge=async()=>{try{const w=(await C.get("/admin/settings/youtube-playlist")).data.urls||[];Y(w.join(`
`))}catch(x){console.error("Failed to load YouTube playlist:",x)}},ke=async x=>{var w,D;y(!0);try{await C.post("/admin/settings/video-source",{videoSource:x}),ae(x),ee("Video source updated successfully!")}catch(L){V(((D=(w=L.response)==null?void 0:w.data)==null?void 0:D.error)||"Failed to save video source")}finally{y(!1)}},b=async x=>{var D,L;x.preventDefault();const w=k.split(`
`).map(H=>H.trim()).filter(H=>H);P(!0);try{await C.post("/admin/settings/youtube-playlist",{urls:w}),ee("YouTube playlist saved!")}catch(H){V(((L=(D=H.response)==null?void 0:D.data)==null?void 0:L.error)||"Failed to save playlist")}finally{P(!1)}},B=x=>{const w=x.target.files[0];if(w){s(w);const D=new FileReader;D.onloadend=()=>{n(D.result)},D.readAsDataURL(w)}},T=async x=>{var w,D;if(x.preventDefault(),!!t){u(!0);try{const L=new FormData;L.append("logo",t);const H=await C.post("/admin/settings/logo",L,{headers:{"Content-Type":"multipart/form-data"}});c(H.data.logoUrl),s(null),n(null),ee("Logo uploaded successfully!")}catch(L){console.error("Failed to upload logo:",L),V(((D=(w=L.response)==null?void 0:w.data)==null?void 0:D.error)||"Failed to upload logo")}finally{u(!1)}}},X=async()=>{r({open:!0,title:"Delete Logo",message:"Are you sure you want to delete the current logo?",onConfirm:async()=>{var x,w;r({open:!1});try{await C.delete("/admin/settings/logo"),c(null),s(null),n(null),ee("Logo deleted successfully!")}catch(D){console.error("Failed to delete logo:",D),V(((w=(x=D.response)==null?void 0:x.data)==null?void 0:w.error)||"Failed to delete logo")}},onCancel:()=>r({open:!1})})},q=x=>{const w=x.target.files[0];w&&j(w)},Q=async x=>{var w,D;if(x.preventDefault(),!!v){l(!0);try{const L=new FormData;L.append("sound",v);const H=await C.post("/admin/settings/ding-sound",L,{headers:{"Content-Type":"multipart/form-data"}});g(H.data.dingSoundUrl),j(null),ee("Ding sound uploaded successfully!")}catch(L){console.error("Failed to upload ding sound:",L),V(((D=(w=L.response)==null?void 0:w.data)==null?void 0:D.error)||"Failed to upload ding sound")}finally{l(!1)}}},_=async()=>{W({open:!0,title:"Delete Ding Sound",message:"Are you sure you want to delete the current ding sound?",onConfirm:async()=>{var x,w;W({open:!1});try{await C.delete("/admin/settings/ding-sound"),g(null),j(null),ee("Ding sound deleted successfully!")}catch(D){console.error("Failed to delete ding sound:",D),V(((w=(x=D.response)==null?void 0:x.data)==null?void 0:w.error)||"Failed to delete ding sound")}},onCancel:()=>W({open:!1})})},Z=async x=>{const w=typeof x=="string"?x.trim():"";if(!w){V("Please enter a voice ID first");return}const D="Window 1 will now serve number 123, or John Doe.";try{const H=(await C.post("/tts",{text:D,voiceId:w},{responseType:"arraybuffer"})).data;if(!H)return;const pe=new Blob([H],{type:"audio/mpeg"}),se=URL.createObjectURL(pe);new Audio(se).play().catch(de=>{console.error("Failed to play preview TTS audio:",de)}).finally(()=>{URL.revokeObjectURL(se)})}catch(L){console.error("Failed to preview TTS voice:",L),V("Failed to preview this voice. Please check your ElevenLabs settings.")}},z=(x,w,D)=>{N(L=>{const H=[...L];return H[x]={...H[x],[w]:D},H})},oe=async x=>{var w,D;x.preventDefault(),re(!0);try{const L=I.map(de=>({id:(de.id||"").trim(),name:(de.name||"").trim()})).filter(de=>de.id);if(L.length===0){V("Please enter at least one ElevenLabs voice ID"),re(!1);return}const H=$&&L.some(de=>de.id===$)?$:L[0].id,pe=await C.post("/admin/settings/tts-voices",{voices:L,activeVoiceId:H}),fe=[...Array.isArray(pe.data.voices)?pe.data.voices:L];for(;fe.length<3;)fe.push({id:"",name:""});N(fe.slice(0,3)),K(pe.data.activeVoiceId||H),ee("TTS voices updated successfully!")}catch(L){console.error("Failed to save TTS voices:",L),V(((D=(w=L.response)==null?void 0:w.data)==null?void 0:D.error)||"Failed to save TTS voices")}finally{re(!1)}};return S?e.jsx(be,{}):e.jsxs("div",{children:[e.jsx(ze,{...f}),e.jsx(ze,{...h}),e.jsx(ze,{...xe}),e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px"},children:"Settings"}),e.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",borderBottom:"1px solid #e2e8f0",paddingBottom:"4px",overflowX:"auto"},children:[{id:"branding",label:"Branding"},{id:"audio",label:"Audio & TTS"},{id:"videos",label:"Videos"},{id:"data",label:"Data"}].map(x=>{const w=M===x.id;return e.jsx("button",{type:"button",onClick:()=>ne(x.id),style:{padding:"8px 16px",borderRadius:"9999px",border:"none",backgroundColor:w?"#1d4ed8":"transparent",color:w?"#ffffff":"#475569",fontSize:"14px",fontWeight:w?600:500,cursor:"pointer",boxShadow:w?"0 1px 3px rgba(15, 23, 42, 0.25)":"none",whiteSpace:"nowrap"},children:x.label},x.id)})}),M==="branding"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #2563eb"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Logo"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a logo to display across all pages. Supported formats: JPG, PNG, GIF, SVG, WebP (max 5MB)"}),i&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Logo:"}),e.jsx("img",{src:i,alt:"Current logo",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Logo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:B,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),a&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Preview:"}),e.jsx("img",{src:a,alt:"Preview",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(O,{type:"submit",disabled:!t||p,children:p?"Uploading...":"Upload Logo"}),i&&e.jsx(O,{variant:"danger",onClick:X,children:"Delete Logo"})]})]})]})}),M==="audio"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #f97316"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Ding Sound (Announcement Chime)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a short audio file to play before each queue announcement on the public monitoring page. Supported formats: MP3, WAV, OGG, M4A, AAC (max 2MB). Keep it brief (under 2 seconds) for best results."}),R&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Ding Sound:"}),e.jsx("audio",{controls:!0,src:R,style:{width:"100%",maxWidth:"400px"},children:"Your browser does not support the audio element."})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Ding Sound"}),e.jsx("input",{type:"file",accept:"audio/*",onChange:q,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(O,{type:"submit",disabled:!v||E,children:E?"Uploading...":"Upload Ding Sound"}),R&&e.jsx(O,{variant:"danger",onClick:_,children:"Delete Ding Sound"})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #10b981"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Text-to-Speech Voices (ElevenLabs)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:"Configure up to three ElevenLabs voice IDs and choose which one is active for queue announcements. Voice IDs can be copied from your ElevenLabs dashboard."}),e.jsxs("form",{onSubmit:oe,children:[I.map((x,w)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1.2fr) minmax(0, 1.4fr) auto",gap:"12px",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",w+1," Name (optional)"]}),e.jsx("input",{type:"text",value:x.name||"",onChange:D=>z(w,"name",D.target.value),placeholder:"e.g. Front Desk Female",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",w+1," ID"]}),e.jsx("input",{type:"text",value:x.id||"",onChange:D=>z(w,"id",D.target.value),placeholder:"ElevenLabs voice ID",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace"}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"6px"},children:[e.jsx("button",{type:"button",onClick:()=>Z(x.id),disabled:!x.id,style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:x.id?"#eff6ff":"#f8fafc",color:x.id?"#2563eb":"#94a3b8",fontSize:"12px",fontWeight:500,cursor:x.id?"pointer":"not-allowed"},children:"Preview Voice"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px"},children:[e.jsx("input",{type:"radio",name:"activeVoice",checked:!!x.id&&$===x.id,disabled:!x.id,onChange:()=>{x.id&&K(x.id)}}),"Active"]})]})]},w)),e.jsx("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:e.jsx(O,{type:"submit",disabled:te,children:te?"Saving Voices...":"Save Voices"})})]})]})]}),M==="videos"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #6366f1"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Video Source"}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"20px"},children:[e.jsx("strong",{children:"YouTube"})," plays videos from a playlist you define. ",e.jsx("strong",{children:"Local"})," lets the display pick a folder on that computer."]}),e.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",border:`2px solid ${J==="youtube"?"#6366f1":"#e2e8f0"}`,borderRadius:"8px",cursor:"pointer",backgroundColor:J==="youtube"?"#eef2ff":"transparent"},children:[e.jsx("input",{type:"radio",name:"videoSource",value:"youtube",checked:J==="youtube",onChange:()=>ke("youtube"),disabled:ue}),e.jsxs("span",{children:[e.jsx("strong",{children:"YouTube"})," â€“ Playlist from admin-defined URLs"]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",border:`2px solid ${J==="local"?"#6366f1":"#e2e8f0"}`,borderRadius:"8px",cursor:"pointer",backgroundColor:J==="local"?"#eef2ff":"transparent"},children:[e.jsx("input",{type:"radio",name:"videoSource",value:"local",checked:J==="local",onChange:()=>ke("local"),disabled:ue}),e.jsxs("span",{children:[e.jsx("strong",{children:"Local"})," â€“ Folder on the display computer"]})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #0ea5e9"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"12px"},children:"Default video volume"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:"Set the default playback volume for monitor videos (0 to 100%). This is applied when the monitor page starts."}),e.jsxs("form",{onSubmit:async x=>{var D,L;x.preventDefault();const w=Number(U);if(!Number.isFinite(w)||w<0||w>100){V("Volume must be a number between 0 and 100.");return}A(!0);try{await C.post("/admin/settings/video-volume",{videoVolumePercent:w}),G(String(Math.round(w))),ee("Default video volume saved.")}catch(H){V(((L=(D=H.response)==null?void 0:D.data)==null?void 0:L.error)||"Failed to save video volume")}finally{A(!1)}},style:{maxWidth:"260px",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Volume (0â€“100%)"}),e.jsx("input",{type:"number",min:0,max:100,value:U,onChange:x=>G(x.target.value.replace(/[^\d]/g,"").slice(0,3)),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}}),e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Example: 0 = muted, 50 = half volume, 100 = full volume."}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(O,{type:"submit",disabled:d,children:d?"Saving...":"Save volume"})})]})]}),J==="youtube"&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #6366f1"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"YouTube Playlist"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"List YouTube URLs (one per line). Videos play in order on the monitor. Supports youtube.com/watch?v= and youtu.be/ links."}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"YouTube URLs"}),e.jsx("textarea",{value:k,onChange:x=>Y(x.target.value),placeholder:`https://www.youtube.com/watch?v=VIDEO_ID
https://youtu.be/VIDEO_ID`,rows:8,style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",backgroundColor:"#f8fafc",color:"#1e293b",resize:"vertical",boxSizing:"border-box"},onFocus:x=>{x.target.style.borderColor="#2563eb",x.target.style.backgroundColor="#ffffff"},onBlur:x=>{x.target.style.borderColor="#e2e8f0",x.target.style.backgroundColor="#f8fafc"}})]}),e.jsx(O,{type:"submit",disabled:F,children:F?"Saving...":"Save Playlist"})]})]}),J==="local"&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderLeft:"4px solid #22c55e"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"12px"},children:"Local videos"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"When the monitoring page loads, the user will select a folder containing video files. Videos play directly from that computer. Works in Chrome and Edge."})]})]}),M==="data"&&e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #dc2626"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Reset queue stats"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Permanently delete all queue entries, serving logs, and daily queue counters. Staff, windows, and categories are not affected. This cannot be undone."}),e.jsx(O,{variant:"danger",disabled:ve,onClick:()=>{ge({open:!0,title:"Reset all queue stats?",message:"This will delete all queue entries, serving logs, and daily counters. Staff, windows, and categories will be kept. This action cannot be undone.",onConfirm:async()=>{var x,w;ge({open:!1}),le(!0);try{await C.post("/admin/settings/reset-queue-stats"),ee("Queue stats reset successfully.")}catch(D){V(((w=(x=D.response)==null?void 0:x.data)==null?void 0:w.error)||"Failed to reset queue stats")}finally{le(!1)}},onCancel:()=>ge({open:!1})})},children:ve?"Resetting...":"Reset queue stats"})]})})]})}function mn(){const t=ye(),[s,a]=o.useState(!0),[n,i]=o.useState(null),[c,S]=o.useState(""),[m,p]=o.useState(!1),[u,f]=o.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[r,v]=o.useState(!1),[j,R]=o.useState(!1);o.useEffect(()=>{const h=localStorage.getItem("token"),W=Ie();if(!h||(W==null?void 0:W.role)!=="ADMIN"){t("/admin/login");return}g()},[t]),o.useEffect(()=>{S((n==null?void 0:n.name)??"")},[n==null?void 0:n.name]);const g=async()=>{var h;try{const W=await C.get("/admin/profile");i(W.data.admin)}catch(W){console.error("Failed to load profile:",W),((h=W.response)==null?void 0:h.status)===401&&t("/admin/login")}finally{a(!1)}},E=async h=>{var I,N,$,K,te,re;h.preventDefault();const W=(c??"").trim();R(!0);try{const J=await C.put("/admin/profile",{name:W||null});i(J.data.admin);const ae=Ie();ae&&(ae.name=J.data.admin.name??null,localStorage.setItem("user",JSON.stringify(ae))),ee("Name updated successfully")}catch(J){V(((N=(I=J.response)==null?void 0:I.data)==null?void 0:N.error)||((re=(te=(K=($=J.response)==null?void 0:$.data)==null?void 0:K.errors)==null?void 0:te[0])==null?void 0:re.msg)||"Failed to update name")}finally{R(!1)}},l=async h=>{var W,I;if(h.preventDefault(),u.newPassword!==u.confirmPassword){V("New passwords do not match");return}if(u.newPassword.length<6){V("Password must be at least 6 characters");return}v(!0);try{await C.post("/admin/profile/change-password",{currentPassword:u.currentPassword,newPassword:u.newPassword}),ee("Password changed successfully!"),p(!1),f({currentPassword:"",newPassword:"",confirmPassword:""})}catch(N){V(((I=(W=N.response)==null?void 0:W.data)==null?void 0:I.error)||"Failed to change password")}finally{v(!1)}};return s?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(be,{})}):e.jsxs("div",{className:"admin-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .admin-profile-root { padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right); }
        @media (max-width: 768px) {
          .admin-profile-header { flex-wrap: wrap; gap: 12px; padding: 12px 16px !important; }
          .admin-profile-content { margin: 24px auto !important; padding: 0 16px !important; }
          .admin-profile-card { padding: 24px !important; }
        }
      `}),e.jsxs("div",{className:"admin-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(we,{size:"small"}),e.jsx(O,{variant:"outline",icon:ct,onClick:()=>t("/admin/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"admin-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"admin-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"24px",color:"#1e293b"},children:"Admin Profile"}),e.jsxs("form",{onSubmit:E,children:[e.jsx(ie,{label:"Name",value:c,onChange:h=>S(h.target.value),placeholder:"Your display name"}),e.jsx(O,{type:"submit",icon:pt,disabled:j,style:{marginTop:"16px"},children:j?"Saving...":"Save name"})]}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsx(ie,{label:"Username",value:(n==null?void 0:n.username)||"",disabled:!0,readOnly:!0,style:{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed",border:"2px solid #e2e8f0",borderRadius:"8px",padding:"12px"}})}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(O,{variant:"outline",icon:et,onClick:()=>{p(!m),m&&f({currentPassword:"",newPassword:"",confirmPassword:""})},children:m?"Cancel":"Change Password"})]}),m&&e.jsxs("form",{onSubmit:l,children:[e.jsx(ie,{label:"Current Password",type:"password",value:u.currentPassword,onChange:h=>f({...u,currentPassword:h.target.value}),required:!0}),e.jsx(ie,{label:"New Password",type:"password",value:u.newPassword,onChange:h=>f({...u,newPassword:h.target.value}),required:!0}),e.jsx(ie,{label:"Confirm New Password",type:"password",value:u.confirmPassword,onChange:h=>f({...u,confirmPassword:h.target.value}),required:!0}),e.jsx(O,{type:"submit",icon:ut,disabled:r,style:{marginTop:"16px"},children:r?"Changing...":"Change Password"})]})]})]})})]})}function yn(){return o.useEffect(()=>{let t=document.querySelector('link[rel="icon"]');t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t));const s=c=>{const S=c&&!c.startsWith("http")&&!c.startsWith("data:")?c.startsWith("/")?window.location.origin+c:window.location.origin+"/"+c:c;t.href=S},a="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23667eea' rx='12'/%3E%3Ctext x='50' y='68' font-size='60' font-weight='bold' dominant-baseline='middle' text-anchor='middle' fill='white' font-family='system-ui,sans-serif'%3EQ%3C/text%3E%3C/svg%3E",n=async()=>{var c;try{const S=await C.get("/admin/settings/logo");(c=S.data)!=null&&c.logoUrl?s(S.data.logoUrl):s(a)}catch{s(a)}};n();const i=setInterval(n,3e4);return()=>clearInterval(i)},[]),null}function bn(){return e.jsxs(e.Fragment,{children:[e.jsx(yn,{}),e.jsx(on,{}),e.jsxs(Ut,{children:[e.jsx(he,{path:"/",element:e.jsx(Qt,{})}),e.jsx(he,{path:"/success",element:e.jsx(Jt,{})}),e.jsx(he,{path:"/thank-you",element:e.jsx(Xt,{})}),e.jsx(he,{path:"/monitor",element:e.jsx(Zt,{})}),e.jsx(he,{path:"/staff/login",element:e.jsx(en,{})}),e.jsx(he,{path:"/staff/dashboard",element:e.jsx(an,{})}),e.jsx(he,{path:"/staff/profile",element:e.jsx(sn,{})}),e.jsx(he,{path:"/admin/login",element:e.jsx(rn,{})}),e.jsx(he,{path:"/admin/dashboard",element:e.jsx(cn,{})}),e.jsx(he,{path:"/admin/profile",element:e.jsx(mn,{})})]})]})}Vt.createRoot(document.getElementById("root")).render(e.jsx(Ht.StrictMode,{children:e.jsx(qt,{children:e.jsx(bn,{})})}));
