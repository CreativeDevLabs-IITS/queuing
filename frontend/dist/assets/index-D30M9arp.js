import{ad as Wt,ae as e,r as n,af as Ce,ag as Pt,ah as ht,ai as mt,aj as At,ak as Et,al as Bt,am as rt,an as fe,ao as Nt,ap as Lt,aq as yt,ar as bt,as as ot,at as lt,au as vt,av as Ot,aw as Mt,ax as wt,ay as jt,az as Ft,aA as Ut,aB as Vt,aC as Ht,aD as qt,aE as $t,aF as Yt,aG as _t,aH as He,aI as qe,aJ as dt,aK as Gt,aL as Xe,aM as at,aN as Qt,aO as Kt,aP as je,aQ as Jt,R as Xt,aR as Zt}from"./vendor-C_KfLnct.js";import{R as Oe,B as it,C as Qe,X as Ke,Y as Je,T as Me,a as st,P as St,b as Ct,c as kt,L as en,d as tn}from"./recharts-SttVB7A8.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const C of d.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&o(C)}).observe(document,{childList:!0,subtree:!0});function i(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(a){if(a.ep)return;a.ep=!0;const d=i(a);fetch(a.href,d)}})();const nn="/api",w=Wt.create({baseURL:nn,headers:{"Content-Type":"application/json"}});w.interceptors.request.use(t=>{const r=localStorage.getItem("token");return r&&(t.headers.Authorization=`Bearer ${r}`),t});w.interceptors.response.use(t=>t,t=>{var i,o,a;const r=(i=t.response)==null?void 0:i.status;if(r===401||r===403){localStorage.removeItem("token"),localStorage.removeItem("user");const d=window.location.pathname;if(d.startsWith("/admin"))d!=="/admin/login"&&(window.location.href="/admin/login");else if(d.startsWith("/staff")&&d!=="/staff/login"){const f=((a=(o=t.response)==null?void 0:o.data)==null?void 0:a.code)==="STAFF_LOGOUT_9PM"?"?reason=logout_9pm":"";window.location.href="/staff/login"+f}}return Promise.reject(t)});function Ae(){const t=localStorage.getItem("user");if(t==null||t===""||t==="undefined")return null;try{return JSON.parse(t)}catch{return null}}const ct="queueEntry",pt="queueDate",It=t=>{const r=new Date().toISOString().split("T")[0];localStorage.setItem(ct,JSON.stringify(t)),localStorage.setItem(pt,r)},Ze=()=>{const t=localStorage.getItem(ct),r=localStorage.getItem(pt),i=new Date().toISOString().split("T")[0];if(!t||r!==i)return r!==i&&$e(),null;try{return JSON.parse(t)}catch{return $e(),null}},$e=()=>{localStorage.removeItem(ct),localStorage.removeItem(pt)};function ce({label:t,error:r,style:i,disabled:o,...a}){const d={width:"100%",padding:"12px",borderRadius:"8px",border:r?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",transition:"border-color 0.2s",...o&&{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed"},...i};return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("input",{style:d,disabled:o,...a}),r&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:r})]})}function M({children:t,onClick:r,variant:i="primary",disabled:o=!1,fullWidth:a=!1,icon:d,iconPosition:C="left",type:f,style:c,...x}){const p={padding:"10px 20px",borderRadius:"8px",border:"none",fontSize:"14px",fontWeight:"600",cursor:o?"not-allowed":"pointer",transition:"all 0.2s",opacity:o?.6:1,width:a?"100%":"auto",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:i==="primary"||i==="success"||i==="danger"||i==="gradient"?"0 2px 4px rgba(0,0,0,0.1)":"none",...c},s={primary:{background:o?"#cbd5e1":"#2563eb",color:"white"},gradient:{background:o?"#cbd5e1":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",boxShadow:o?"none":"0 4px 12px rgba(102, 126, 234, 0.4)"},secondary:{background:o?"#cbd5e1":"#64748b",color:"white"},success:{background:o?"#cbd5e1":"#10b981",color:"white"},danger:{background:o?"#cbd5e1":"#ef4444",color:"white"},outline:{background:"transparent",color:o?"#cbd5e1":"#2563eb",border:`2px solid ${o?"#cbd5e1":"#2563eb"}`}},j=s[i]||s.primary,I=d&&e.jsx(d,{size:18,strokeWidth:2.5}),R=C==="left"?e.jsxs(e.Fragment,{children:[" ",I," ",t," "]}):e.jsxs(e.Fragment,{children:[" ",t," ",I," "]});return e.jsx("button",{type:f||"button",style:{...p,...j},onClick:o?void 0:r,disabled:o,onMouseOver:g=>{o||(i==="primary"?(g.target.style.background="#1e40af",g.target.style.boxShadow="0 4px 8px rgba(37, 99, 235, 0.3)"):i==="outline"?g.target.style.background="#eff6ff":i==="danger"?(g.target.style.background="#dc2626",g.target.style.boxShadow="0 4px 8px rgba(239, 68, 68, 0.3)"):i==="success"?(g.target.style.background="#059669",g.target.style.boxShadow="0 4px 8px rgba(16, 185, 129, 0.3)"):i==="gradient"&&(g.target.style.background="linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)",g.target.style.boxShadow="0 6px 16px rgba(102, 126, 234, 0.5)"))},onMouseOut:g=>{o||(g.target.style.background=j.background,g.target.style.boxShadow=i==="gradient"?"0 4px 12px rgba(102, 126, 234, 0.4)":i==="primary"||i==="success"||i==="danger"?"0 2px 4px rgba(0,0,0,0.1)":"none")},...x,children:R})}function ke(){return e.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"4px solid #e2e8f0",borderTop:"4px solid #2563eb",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})}const on="Queuing System";function Ie({size:t="medium",showText:r=!0,showTitle:i=!0,titlePosition:o="next",align:a="left",gap:d="12px",variant:C="default"}){const[f,c]=n.useState(null),[x,p]=n.useState(null),[s,j]=n.useState(!0),[I,R]=n.useState(!1);n.useEffect(()=>{g();const q=setInterval(g,3e4);return()=>clearInterval(q)},[]),n.useEffect(()=>{if(!i)return;B();const q=setInterval(B,3e4);return()=>clearInterval(q)},[i]);const g=async()=>{try{const q=await w.get("/admin/settings/logo");if(q.data.logoUrl){let ae=q.data.logoUrl;ae&&!ae.startsWith("http")&&!ae.startsWith("/")&&(ae="/"+ae);const m=ae.includes("?")?"&":"?";ae=ae+m+"_t="+Date.now(),c(ae),R(!1)}else c(null),R(!1)}catch(q){console.error("Failed to load logo:",q),R(!0)}finally{j(!1)}},B=async()=>{try{const q=await w.get("/admin/settings/site-title");p(q.data.siteTitle||null)}catch(q){console.error("Failed to load site title:",q),p(null)}},y={small:{width:"80px",height:"40px"},medium:{width:"120px",height:"60px"},large:{width:"180px",height:"90px"},monitor:{width:"88px",height:"80px"}},l=y[t]||y.medium,T=t==="small"?"18px":t==="large"?"28px":t==="monitor"?"18px":"24px",P=t==="small"?"14px":t==="large"?"20px":t==="monitor"?"14px":"16px",v=C==="monitor",U={fontSize:T,fontWeight:"700",color:v?"#e5e7eb":"#1e293b",...v&&{textShadow:"0 2px 4px rgba(0,0,0,0.6)"}},$={fontSize:P,fontWeight:"600",color:v?"#e5e7eb":"#64748b",textTransform:"uppercase",...v&&{textShadow:"0 2px 4px rgba(0,0,0,0.6)"}},Q=a==="center";if(s)return null;const se=e.jsx(e.Fragment,{children:f&&!I?e.jsx("img",{src:f,alt:"Logo",style:{...l,objectFit:"contain",maxWidth:"100%"},onError:()=>{R(!0),c(null)}}):e.jsx("div",{style:{...l,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"8px",color:"white",fontWeight:"700",fontSize:t==="small"?"14px":t==="large"?"24px":"18px"},children:"Q"})}),oe=i?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:0,alignItems:Q?"center":"flex-start",textAlign:Q?"center":"left"},children:[x&&e.jsx("span",{style:U,children:x}),e.jsx("span",{style:$,children:on})]}):null;return o==="below"&&(se||oe)?e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:Q?"center":"flex-start",gap:"8px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:Q?"center":void 0,gap:d},children:se}),oe]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:d,flexDirection:"row"},children:[se,oe]})}const an=[{value:"REGULAR",label:"Regular"},{value:"SENIOR_CITIZEN",label:"Senior Citizen"},{value:"PWD",label:"PWD"},{value:"PREGNANT",label:"Pregnant"}];function sn(){var B;const t=Ce(),[r,i]=n.useState(!0),[o,a]=n.useState(!1),[d,C]=n.useState([]),[f,c]=n.useState({clientName:"",clientType:"REGULAR",categoryIds:[],subCategoryIds:[]}),[x,p]=n.useState({});n.useEffect(()=>{s()},[]);const s=async()=>{var y;try{const l=await w.get("/categories");C(Array.isArray((y=l.data)==null?void 0:y.categories)?l.data.categories:[])}catch(l){console.error("Failed to load categories:",l)}finally{i(!1)}},j=n.useMemo(()=>{var T;if(!((T=f.categoryIds)!=null&&T.length))return[];const y=(d||[]).filter(P=>f.categoryIds.includes(P.id)),l=new Map;return y.forEach(P=>{(P.subCategories||[]).forEach(v=>{l.has(v.id)||l.set(v.id,{...v,categoryName:P.name})})}),Array.from(l.values())},[f.categoryIds,d]),I=y=>{const l=f.categoryIds||[],T=l.includes(y)?l.filter(U=>U!==y):[...l,y],P=(d||[]).filter(U=>T.includes(U.id)),v=new Set;P.forEach(U=>{(U.subCategories||[]).forEach($=>v.add($.id))}),c({...f,categoryIds:T,subCategoryIds:(f.subCategoryIds||[]).filter(U=>v.has(U))})},R=y=>{const l=f.subCategoryIds||[],T=l.includes(y)?l.filter(P=>P!==y):[...l,y];c({...f,subCategoryIds:T})},g=async y=>{var T,P,v,U;y.preventDefault(),p({});const l={};if(f.clientName.trim()||(l.clientName="Name is required"),(T=f.categoryIds)!=null&&T.length||(l.categoryId="Select at least one category"),Object.keys(l).length>0){p(l);return}a(!0);try{const Q=(await w.post("/queue/join",{clientName:f.clientName.trim(),clientType:f.clientType,categoryIds:f.categoryIds,subCategoryIds:(P=f.subCategoryIds)!=null&&P.length?f.subCategoryIds:void 0})).data.queueEntry,se=(Q.concernCategories||[Q.category]).map(q=>q.name).join(", "),oe=(Q.concernSubCategories||[]).map(q=>q.name).join(", ")||null;It({queueNumber:Q.queueNumber,clientName:Q.clientName,date:Q.date,category:se,subCategory:oe,clientType:Q.clientType,status:Q.status}),t("/success")}catch($){console.error("Failed to join queue:",$),p({submit:((U=(v=$.response)==null?void 0:v.data)==null?void 0:U.error)||"Failed to join queue"})}finally{a(!1)}};return r?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsx("h1",{style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Join Queue"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Fill in your details to get a queue number"}),e.jsxs("form",{onSubmit:g,children:[e.jsx(ce,{label:"Your Name",value:f.clientName,onChange:y=>c({...f,clientName:y.target.value}),error:x.clientName,placeholder:"Enter your full name",required:!0}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Client Type"}),e.jsx("div",{className:"client-type-pills",children:an.map(({value:y,label:l})=>e.jsxs("label",{className:`pill-radio ${f.clientType===y?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"clientType",value:y,checked:f.clientType===y,onChange:()=>c({...f,clientType:y})}),e.jsx("span",{children:l})]},y))})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsxs("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:["Concern Category ",e.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),x.categoryId&&e.jsx("div",{style:{fontSize:"12px",color:"#ef4444",marginBottom:"8px"},children:x.categoryId}),e.jsx("div",{className:"checkbox-group",children:(d||[]).map(y=>e.jsxs("label",{className:`checkbox-row ${(f.categoryIds||[]).includes(y.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(f.categoryIds||[]).includes(y.id),onChange:()=>I(y.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:y.name})]},y.id))})]}),j.length>0&&e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",marginBottom:"10px",color:"#1e293b"},children:"Sub-Concern (Optional)"}),e.jsx("div",{className:"checkbox-group",children:j.map(y=>e.jsxs("label",{className:`checkbox-row ${(f.subCategoryIds||[]).includes(y.id)?"selected":""}`,children:[e.jsx("input",{type:"checkbox",checked:(f.subCategoryIds||[]).includes(y.id),onChange:()=>R(y.id)}),e.jsx("span",{className:"checkmark"}),e.jsx("span",{children:y.name})]},y.id))})]}),x.submit&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:x.submit}),e.jsx(M,{type:"submit",variant:"gradient",fullWidth:!0,disabled:o||!f.clientType||!((B=f.categoryIds)!=null&&B.length),style:{marginTop:"8px",padding:"14px 24px",fontSize:"16px"},children:o?"Joining...":"Join Queue"})]}),e.jsx("div",{style:{marginTop:"24px",textAlign:"center"},children:e.jsx("a",{href:"/monitor",style:{color:"#2563eb",textDecoration:"none",fontSize:"14px"},children:"View Queue Status â†’"})})]})})}function et(t){if(!t)return"";const r=t.split("-");return r.length>1?r[1]:t}function rn(t){return t?t.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "):""}function Tt({window:t,compact:r=!1}){const{label:i,staff:o,currentServing:a}=t,d=x=>{const p=x.trim().split(" ");return p.length>=2?(p[0][0]+p[p.length-1][0]).toUpperCase():x.substring(0,2).toUpperCase()},C=(o==null?void 0:o.name)||"â€”",f=a?et(a.queueNumber):null,c=a&&[a.clientName||"",a.clientType?`(${rn(a.clientType)})`:""].filter(Boolean).join(" ").trim()||null;return e.jsxs("div",{style:{background:"#0b1120",borderRadius:"12px",padding:0,boxShadow:"0 4px 12px rgba(15,23,42,0.6)",border:"1px solid #1e293b",transition:"all 0.2s",display:"flex",alignItems:"stretch",minHeight:r?0:"96px",flex:1,overflow:"hidden"},children:[e.jsx("div",{style:{flex:"0 0 34%",maxWidth:"110px",minHeight:0,overflow:"hidden",borderRadius:"12px",background:o!=null&&o.profilePicture?void 0:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:o!=null&&o.profilePicture?e.jsx("img",{src:o.profilePicture,alt:C,style:{width:"100%",height:"100%",objectFit:"cover",display:"block",minHeight:0}}):e.jsx("span",{style:{color:"white",fontWeight:"700",fontSize:"24px"},children:d(C)})}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minWidth:0,padding:"6px 8px 6px 8px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"700",color:"#e5e7eb",marginBottom:"2px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:C}),a?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:"700",color:"#cbd5f5",marginBottom:"4px"},children:"is now serving:"}),e.jsx("div",{style:{fontSize:"clamp(22px, 2.8vw, 34px)",fontWeight:"700",color:"#fbbf24",lineHeight:1.05,marginBottom:"4px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:f}),c&&e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#cbd5f5",marginBottom:"4px",maxHeight:"2.6em",overflow:"hidden"},children:c})]}):e.jsx("div",{style:{fontSize:"11px",fontWeight:"600",color:"#64748b",fontStyle:"italic"},children:"No active service"}),e.jsx("div",{style:{marginTop:"auto",paddingTop:"2px",fontSize:"20px",fontWeight:"700",color:"#38bdf8",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i})]})]})}function Dt({clientType:t}){const r={REGULAR:{bg:"#e2e8f0",color:"#475569"},SENIOR_CITIZEN:{bg:"#fef3c7",color:"#92400e"},PWD:{bg:"#dbeafe",color:"#1e40af"},PREGNANT:{bg:"#fce7f3",color:"#9f1239"}},i={REGULAR:"Regular",SENIOR_CITIZEN:"Senior",PWD:"PWD",PREGNANT:"Pregnant"},o=r[t]||r.REGULAR;return e.jsx("span",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:o.bg,color:o.color},children:i[t]})}function ln(){const t=Ce(),[r,i]=n.useState(null),[o,a]=n.useState([]),[d,C]=n.useState(!0),[f,c]=n.useState(0);n.useEffect(()=>{const j=Ze();if(!j){t("/");return}i(j),x();const I=setInterval(x,2e3);return()=>clearInterval(I)},[t]),n.useEffect(()=>{(r==null?void 0:r.status)==="SERVED"&&t("/thank-you")},[r==null?void 0:r.status,t]);const x=async()=>{var j;try{const I=Ze()||r;if(I!=null&&I.queueNumber){const B=(await w.get(`/queue/${I.queueNumber}`)).data.queueEntry,y={...I,status:B.status};if(i(y),It(y),B.status==="SERVED"){t("/thank-you");return}if(B.status==="WAITING")try{const l=await w.get(`/queue/${I.queueNumber}/ahead`);c(l.data.peopleAhead||0)}catch{const T=await w.get("/queue/public/stats");c(T.data.waiting||0)}else c(0)}const R=await w.get("/queue/public/windows");a(R.data.windows)}catch(I){console.error("Failed to load data:",I),((j=I.response)==null?void 0:j.status)===404&&($e(),t("/"))}finally{C(!1)}};if(d||!r)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})});const p={WAITING:{bg:"#fef3c7",color:"#92400e",text:"Waiting"},NOW_SERVING:{bg:"#dbeafe",color:"#1e40af",text:"Being served"},SERVED:{bg:"#d1fae5",color:"#065f46",text:"Served"},SKIPPED:{bg:"#fee2e2",color:"#991b1b",text:"Skipped"}},s=p[r.status]||p.WAITING;return e.jsx("div",{style:{minHeight:"100vh",background:"#f8fafc",padding:"20px"},children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:["Hello, ",r.clientName]}),e.jsx("div",{style:{fontSize:"48px",fontWeight:"700",color:"#2563eb",marginBottom:"16px",letterSpacing:"2px"},children:et(r.queueNumber)}),e.jsx("div",{style:{display:"inline-block",padding:"8px 16px",borderRadius:"20px",backgroundColor:s.bg,color:s.color,fontSize:"14px",fontWeight:"600",marginBottom:"16px"},children:s.text}),e.jsxs("div",{style:{marginTop:"16px",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(Dt,{clientType:r.clientType}),e.jsxs("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"600",backgroundColor:"#e2e8f0",color:"#475569"},children:[r.category,r.subCategory&&` - ${r.subCategory}`]})]}),r.status==="WAITING"&&f>0&&e.jsxs("div",{style:{marginTop:"16px",fontSize:"14px",color:"#64748b"},children:["Approximately ",f," ",f===1?"person":"people"," ahead"]}),e.jsx("div",{style:{marginTop:"24px",padding:"16px",background:"#f1f5f9",borderRadius:"8px",fontSize:"14px",color:"#475569"},children:"ðŸ’¡ You can leave and monitor your queue status from this page. We'll update automatically."})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px",color:"#1e293b"},children:"Active Windows"}),e.jsx("div",{className:"grid-responsive",style:{display:"grid",gap:"16px"},children:o.length>0?o.map(j=>e.jsx(Tt,{window:j},j.id)):e.jsx("div",{style:{gridColumn:"1 / -1",textAlign:"center",padding:"40px",background:"white",borderRadius:"12px",color:"#64748b"},children:"No active windows at the moment"})})]})]})})}function dn(){const t=Ce();n.useEffect(()=>{const i=Ze();if(!i||i.status!=="SERVED"){t("/");return}const o=setTimeout(()=>{$e()},5e3);return()=>clearTimeout(o)},[t]);const r=Ze();return e.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"48px",maxWidth:"600px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium"})}),e.jsx("div",{style:{fontSize:"64px",marginBottom:"24px"},children:"âœ…"}),e.jsx("h1",{style:{fontSize:"32px",fontWeight:"700",marginBottom:"16px",color:"#1e293b"},children:"Thank You!"}),r&&e.jsxs("p",{style:{fontSize:"18px",color:"#64748b",marginBottom:"24px"},children:["Thank you, ",e.jsx("strong",{children:r.clientName}),", for your visit."]}),e.jsx("p",{style:{fontSize:"16px",color:"#475569",marginBottom:"32px",lineHeight:"1.6"},children:"We appreciate your business and look forward to serving you again."}),e.jsx("div",{style:{padding:"20px",background:"#f1f5f9",borderRadius:"12px",marginBottom:"32px"},children:e.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"Your service has been completed. Have a wonderful day!"})}),e.jsx("button",{onClick:()=>{$e(),t("/")},style:{padding:"12px 32px",borderRadius:"8px",border:"none",background:"#2563eb",color:"white",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:i=>{i.target.style.background="#1e40af"},onMouseOut:i=>{i.target.style.background="#2563eb"},children:"Return to Home"})]})})}function cn(){const[t,r]=n.useState([]),[i,o]=n.useState([]),[a,d]=n.useState(null),[C,f]=n.useState(!0),[c,x]=n.useState(!1),[p,s]=n.useState("youtube"),[j,I]=n.useState(null),R=n.useRef(null),g=n.useRef(null),B=n.useRef(null),y=n.useRef([]);y.current=i;const l=n.useRef([]),T=n.useRef(!1),P=n.useRef([]),v=n.useRef(!1),U=n.useRef(null),$=n.useRef(0),Q=8e3,se=.05,[oe,q]=n.useState(null),ae=n.useRef(null),m=n.useRef(!1),D=n.useRef(null),[G,O]=n.useState(!1),[A,H]=n.useState(5);n.useEffect(()=>{h(),N();const b=setInterval(h,2e3);return()=>clearInterval(b)},[]),n.useEffect(()=>{Ye()},[]),n.useEffect(()=>{i.length>0&&!m.current&&O(!0)},[i]);const J=n.useRef(null);n.useEffect(()=>{const b=()=>{var E;return(E=J.current)==null?void 0:E.call(J)};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[]),n.useEffect(()=>{i.length>0&&!a&&d(i[0])},[i,a]),n.useEffect(()=>()=>{i.forEach(b=>{b._blobUrl&&b.url&&URL.revokeObjectURL(b.url)})},[i]),n.useEffect(()=>{if(p!=="local"||!R.current||!a)return;const b=R.current,E=()=>{const _=(i.findIndex(X=>X.url===a.url)+1)%i.length;d(i[_])};b.addEventListener("ended",E),b.volume=se,b.load();const k=b.play();return k!==void 0&&k.then(()=>{b.muted=!1}).catch(()=>{b.muted=!0,b.play().catch(console.error)}),()=>b.removeEventListener("ended",E)},[a,i,p]),n.useEffect(()=>{var _;if(p!=="youtube"||!(a!=null&&a.id))return;const b=X=>{if(g.current){g.current.loadVideoById(X);const z=Math.max(0,Math.min(100,A))/100;g.current.setVolume(Math.round(z*100));return}const K=B.current;if(!K)return;const te=document.createElement("div");te.id="youtube-player-"+Date.now(),K.innerHTML="",K.appendChild(te),g.current=new window.YT.Player(te.id,{videoId:X,width:"100%",height:"100%",playerVars:{autoplay:1,mute:1,rel:0,modestbranding:1},events:{onReady:z=>{const le=Math.max(0,Math.min(100,A))/100;z.target.setVolume(Math.round(le*100)),m.current&&z.target.unMute()},onStateChange:z=>{if(z.data===0){const le=y.current,pe=(le.findIndex(ne=>ne.id===X)+1)%le.length;le[pe]&&d(le[pe])}}}})};if((_=window.YT)!=null&&_.Player)return b(a.id),()=>{};if(window.YTLoadReady)return window.YT.ready(()=>b(a.id)),()=>{};const E=document.createElement("script");E.src="https://www.youtube.com/iframe_api";const k=document.getElementsByTagName("script")[0];k.parentNode.insertBefore(E,k);const Y=window.onYouTubeIframeAPIReady;return window.onYouTubeIframeAPIReady=()=>{window.YTLoadReady=!0,Y&&Y(),b(a.id)},()=>{}},[a,i,p,A]),n.useEffect(()=>()=>{if(g.current){try{g.current.destroy()}catch{}g.current=null}B.current&&(B.current.innerHTML="")},[]);const h=async()=>{try{const E=(await w.get("/queue/public/windows")).data.windows||[],k=l.current;r(E),l.current=E,setTimeout(()=>{try{be(k,E)}catch(Y){console.error("Failed to run TTS announcements:",Y)}},0)}catch(b){console.error("Failed to load windows:",b)}finally{f(!1)}},N=async()=>{try{const E=(await w.get("/admin/settings/ding-sound")).data.dingSoundUrl||null;q(E),ae.current=E}catch(b){console.error("Failed to load ding sound URL:",b),q(null),ae.current=null}},ie=b=>{if(typeof window>"u"){console.log("playDing: window undefined"),b&&setTimeout(b,7e3);return}console.log("playDing: starting");let k=!1,Y=null;Y=setTimeout(()=>{if(!k&&(console.warn("playDing: Ultimate timeout reached, forcing safeDone"),k=!0,b))try{b()}catch(X){console.error("playDing: Error in onDone callback:",X)}},7e3);const _=()=>{if(k){console.log("playDing: safeDone called but already done");return}if(k=!0,Y&&(clearTimeout(Y),Y=null),console.log("playDing: done - calling onDone callback"),b)try{b()}catch(X){console.error("playDing: Error in onDone callback:",X)}else console.warn("playDing: No onDone callback provided")};try{const X=ae.current||oe;if(X&&typeof X=="string"){const te=X.startsWith("http")?X:`${window.location.origin}${X.startsWith("/")?"":"/"}${X}`;console.log("playDing: Using custom ding sound:",te);const z=new Audio(te);z.volume=1;let le=!1;const ue=()=>{if(k)return;console.log("playDing: Trying synthesized chime fallback");const ve=window.AudioContext||window.webkitAudioContext;if(!ve){console.warn("playDing: No AudioContext available"),_();return}let ge=D.current;if(!ge)try{ge=new ve,ge.state,D.current=ge}catch(ye){console.warn("playDing: Cannot create AudioContext (needs user gesture):",ye),k||_();return}if(!ge){console.warn("playDing: No AudioContext available"),k||_();return}const Be=()=>{if(!k)try{console.log("playDing: Playing synthesized chime");const ye=ge.createOscillator(),ze=ge.createOscillator(),Re=ge.createGain();ye.type="sine",ze.type="sine";const u=ge.currentTime;ye.frequency.setValueAtTime(880,u),ze.frequency.setValueAtTime(1175,u+.08),ye.connect(Re),ze.connect(Re),Re.connect(ge.destination),Re.gain.setValueAtTime(1e-4,u),Re.gain.exponentialRampToValueAtTime(.25,u+.03),Re.gain.exponentialRampToValueAtTime(1e-4,u+.4),ye.start(u),ze.start(u+.08),ye.stop(u+.4),ze.stop(u+.4),setTimeout(()=>{k||(console.log("playDing: Synthesized chime finished"),_())},500)}catch(ye){console.error("playDing: Failed to play chime:",ye),k||_()}};ge.state==="suspended"&&ge.resume?ge.resume().then(()=>{k||Be()}).catch(ye=>{console.warn("playDing: AudioContext resume failed:",ye),k||_()}):Be()},pe=()=>{if(k)return;console.log("playDing: Audio ended event fired, currentTime:",z.currentTime,"duration:",z.duration),z.removeEventListener("ended",pe),z.removeEventListener("error",ne),z.removeEventListener("canplaythrough",me),z.removeEventListener("loadeddata",me),z.currentTime>=Math.min(.1,z.duration*.1)||z.duration===0?(console.log("playDing: Custom ding played successfully"),le=!0,_()):(console.warn("playDing: Custom ding ended immediately, trying fallback chime"),ue())},ne=ve=>{console.error("Failed to play custom ding sound:",ve),z.removeEventListener("ended",pe),z.removeEventListener("error",ne),z.removeEventListener("canplaythrough",me),z.removeEventListener("loadeddata",me),ue()},we=()=>{console.log("playDing: Audio ready, attempting to play, readyState:",z.readyState,"duration:",z.duration,"currentTime:",z.currentTime),z.currentTime=0,setTimeout(()=>{const ve=z.play();ve!==void 0?ve.then(()=>{console.log("playDing: Audio playing successfully, paused:",z.paused,"currentTime:",z.currentTime,"duration:",z.duration),setTimeout(()=>{z.paused&&!k&&!le?(console.warn("playDing: Audio paused after play() promise resolved, may be blocked by autoplay policy. Will try fallback chime."),ne(new Error("Autoplay blocked"))):z.paused||console.log("playDing: Audio confirmed playing, currentTime:",z.currentTime)},100)}).catch(ge=>{console.error("Failed to start custom ding sound:",ge),ne(ge)}):(console.warn("playDing: play() returned undefined"),setTimeout(()=>{z.paused&&!k&&!le&&(console.warn("playDing: Audio is paused after play(), treating as error. Will try fallback chime."),ne(new Error("Audio did not start playing")))},100))},10)},me=()=>{z.removeEventListener("canplaythrough",me),z.removeEventListener("loadeddata",me),we()};z.addEventListener("ended",pe),z.addEventListener("error",ne),z.readyState>=2?(console.log("playDing: Audio already loaded, playing immediately"),we()):(z.addEventListener("canplaythrough",me),z.addEventListener("loadeddata",me),z.load()),setTimeout(()=>{!k&&!le&&(console.warn("playDing: Custom ding timeout (2s), trying fallback chime"),z.removeEventListener("ended",pe),z.removeEventListener("error",ne),z.removeEventListener("canplaythrough",me),z.removeEventListener("loadeddata",me),ue())},2e3);return}const K=window.AudioContext||window.webkitAudioContext;if(K){const te=D.current||new K,z=()=>{console.log("playDing: Playing synthesized chime");const le=te.createOscillator(),ue=te.createOscillator(),pe=te.createGain();le.type="sine",ue.type="sine";const ne=te.currentTime;le.frequency.setValueAtTime(880,ne),ue.frequency.setValueAtTime(1175,ne+.08),le.connect(pe),ue.connect(pe),pe.connect(te.destination),pe.gain.setValueAtTime(1e-4,ne),pe.gain.exponentialRampToValueAtTime(.25,ne+.03),pe.gain.exponentialRampToValueAtTime(1e-4,ne+.4),le.start(ne),ue.start(ne+.08),le.stop(ne+.4),ue.stop(ne+.4),setTimeout(()=>{console.log("playDing: Synthesized chime finished"),_()},500)};te.state==="suspended"&&te.resume?te.resume().then(()=>{z()}).catch(()=>{z()}):z();return}console.warn("playDing: No AudioContext available, cannot play chime"),_()}catch(X){console.error("Failed to play ding sound:",X)}setTimeout(_,7e3)},W=b=>{const E=R.current;E&&(E.volume=Math.max(0,Math.min(1,b)));const k=g.current;k&&typeof k.setVolume=="function"&&k.setVolume(Math.round(Math.max(0,Math.min(1,b))*100))},ee=(b,E)=>{if(typeof window<"u"&&window.speechSynthesis){window.speechSynthesis.cancel();const k=new SpeechSynthesisUtterance(b);k.lang="en-US",k.rate=1,k.pitch=1,k.onend=E,k.onerror=E,window.speechSynthesis.speak(k)}else E()},re=b=>new Promise(E=>{if(!b||typeof b!="string"||!b.trim()){console.warn("TTS: Empty or invalid text provided"),E();return}w.post("/tts",{text:b},{responseType:"arraybuffer"}).then(k=>{const Y=k.headers&&k.headers["content-type"]||"",_=Y.includes("audio/")||Y.includes("mpeg");if(k.status!==200||!_||!k.data){console.warn("TTS: Invalid response, falling back to speechSynthesis"),ee(b,E);return}const X=k.data,K=new Blob([X],{type:"audio/mpeg"}),te=URL.createObjectURL(K),z=new Audio(te);z.volume=1;const le=()=>{z.src="",z.removeEventListener("ended",ue),z.removeEventListener("error",pe),setTimeout(()=>URL.revokeObjectURL(te),100)},ue=()=>{le(),E()},pe=we=>{console.error("TTS audio playback error:",we),le(),ee(b,E)};z.addEventListener("ended",ue),z.addEventListener("error",pe);const ne=z.play();ne!==void 0&&ne.catch(we=>{console.error("TTS audio play() failed:",we),le(),ee(b,E)})}).catch(k=>{console.error("TTS API call failed:",k),ee(b,E)})}),he=()=>new Promise(b=>ie(b)),xe=async()=>{if(v.current){console.log("Already processing announcement, skipping");return}if(P.current.length===0){console.log("No announcements in queue");return}console.log(`Processing announcement, queue length: ${P.current.length}`),v.current=!0;const b=P.current.shift();if(!b){console.log("No item to process"),v.current=!1,P.current.length>0&&xe();return}const{text:E}=b;console.log("Starting announcement:",E);try{W(.05),console.log("Playing ding..."),await he(),console.log("Ding finished, playing TTS..."),await re(E),console.log("TTS finished"),Ee(b.key)}catch(k){console.error("Announcement playback error:",k)}finally{W(se),v.current=!1,P.current.length>0&&xe()}},be=(b,E)=>{if(typeof window>"u")return;if(!T.current){T.current=!0;return}const k=new Map;(b||[]).forEach(K=>{K&&K.id&&K.currentServing&&k.set(K.id,K.currentServing.queueNumber)});const Y=Date.now(),_=new Set(P.current.map(K=>K.key).filter(Boolean)),X=[];(E||[]).forEach(K=>{if(!K||!K.id||!K.currentServing)return;const te=K.currentServing.queueNumber,z=K.currentServing.clientName,le=k.get(K.id);if(!te||te===le)return;const ue=`${K.id}:${te}`;if(_.has(ue)||U.current===ue&&Y-$.current<Q)return;_.add(ue);const pe=et?et(te):te;let ne=pe;const we=parseInt(pe,10);Number.isNaN(we)||(ne=String(we));const me=K.label||"Window",ve=z?`, ${z}`:"",Be="Ang atong {{window}},... mu assist na sa kyu number, {{queueNumber}}. {{clientNamePart}}, please proceed to {{window}}.".replace(/{{\s*window\s*}}/gi,me).replace(/{{\s*queueNumber\s*}}/gi,ne).replace(/{{\s*clientNamePart\s*}}/gi,ve);console.log("Announcement queued:",{windowLabel:me,spokenCounter:ne,text:Be}),X.push({text:Be,key:ue})}),X.length>0&&(console.log(`Adding ${X.length} announcement(s) to queue`),X.forEach(K=>P.current.push(K)),xe())},Ee=b=>{b&&(U.current=b,$.current=Date.now())},Te=[".mp4",".webm",".ogg",".mov",".avi"];function Ue(b){if(!b||typeof b!="string")return null;const E=b.trim(),k=E.match(/[?&]v=([^&]+)/);if(k)return k[1];const Y=E.match(/youtu\.be\/([^?&]+)/);if(Y)return Y[1];const _=E.match(/youtube\.com\/embed\/([^?&]+)/);return _?_[1]:null}const Ye=async()=>{var b;try{const[E,k]=await Promise.all([w.get("/admin/settings/video-source"),w.get("/admin/settings/video-volume").catch(()=>null)]),Y=E.data.videoSource||"youtube";if(s(Y),k&&typeof((b=k.data)==null?void 0:b.videoVolumePercent)=="number"){const _=k.data.videoVolumePercent;H(Math.max(0,Math.min(100,Math.round(_))))}if(Y==="youtube"){const K=((await w.get("/admin/settings/youtube-playlist")).data.urls||[]).map(te=>{const z=Ue(te);return z?{id:z,url:te,name:z}:null}).filter(Boolean);o(K),x(!1),I(null)}else o([]),I(null)}catch(E){console.error("Failed to load videos:",E),x(!0),o([])}},_e=async()=>{if(!("showDirectoryPicker"in window)){I("Not supported in this browser. Use Chrome or Edge.");return}try{I(null);const b=await window.showDirectoryPicker(),E=[];for await(const k of b.values())if(k.kind==="file"){const Y="."+(k.name.split(".").pop()||"").toLowerCase();if(Te.includes(Y)){const _=await k.getFile(),X=URL.createObjectURL(_);E.push({filename:k.name,name:k.name.replace(/\.[^/.]+$/,""),url:X,_blobUrl:!0})}}E.length>0?(o(E),x(!1)):I("No video files found in that folder.")}catch(b){b.name!=="AbortError"&&(console.error("Failed to pick folder:",b),I(b.message||"Failed to access folder."))}},De=()=>{if(!m.current){m.current=!0,O(!1);try{const b=Math.max(0,Math.min(100,A))/100,E=window.AudioContext||window.webkitAudioContext;if(E&&!D.current){const _=new E;D.current=_,_.resume&&_.resume()}const k=g.current;k&&typeof k.unMute=="function"&&(k.unMute(),k.setVolume(Math.round(b*100)));const Y=R.current;Y&&(Y.muted=!1,Y.volume=b)}catch{}}};return J.current=De,e.jsxs("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:"#0f172a",overflow:"hidden"},onClick:De,onTouchStart:De,role:"presentation",children:[G&&i.length>0&&e.jsxs("div",{role:"button",tabIndex:0,onClick:De,onKeyDown:b=>{b.key!=="Tab"&&De()},style:{position:"fixed",inset:0,zIndex:9999,background:"rgba(0,0,0,0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"16px",cursor:"pointer"},children:[e.jsx("div",{style:{color:"#e5e7eb",fontSize:"24px",fontWeight:600,textAlign:"center",padding:"0 24px"},children:"Press any key or tap to start"}),e.jsx("div",{style:{color:"#9ca3af",fontSize:"16px",textAlign:"center",padding:"0 24px"},children:"Use your remote's OK/Enter button, or tap the screen"})]}),e.jsxs("div",{style:{flex:1,display:"flex",minHeight:0},children:[e.jsxs("div",{style:{flex:3,minWidth:0,background:"#000",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{position:"absolute",top:16,left:16,zIndex:10,display:"flex",alignItems:"center",gap:"8px",pointerEvents:"none"},children:e.jsx(Ie,{size:"monitor",showText:!1,showTitle:!0,variant:"monitor",gap:"8px"})}),i.length>0&&!c?p==="youtube"?e.jsx("div",{ref:B,style:{position:"relative",width:"100%",height:"100%"}}):e.jsx("video",{ref:R,src:a==null?void 0:a.url,controls:!0,autoPlay:!0,muted:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsxs("div",{style:{textAlign:"center",padding:"40px",display:"flex",flexDirection:"column",alignItems:"center",gap:"16px"},children:[e.jsx("div",{style:{color:"#9ca3af",fontSize:"22px",fontWeight:600,marginBottom:"8px"},children:p==="local"?"Select a video folder":"No YouTube playlist configured"}),e.jsx("div",{style:{color:"#6b7280",fontSize:"16px"},children:p==="local"?"Choose a folder on this computer containing video files (mp4, webm, ogg, mov, avi).":"Add YouTube URLs in Admin â†’ Settings â†’ Videos."}),p==="local"&&j&&e.jsx("div",{style:{color:"#ef4444",fontSize:"14px"},children:j}),p==="local"&&e.jsx("button",{type:"button",onClick:_e,style:{padding:"12px 24px",fontSize:"16px",fontWeight:600,color:"white",background:"#6366f1",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Select folder"})]})]}),e.jsx("div",{style:{flex:1,minWidth:0,borderLeft:"1px solid #1f2937",background:"#020617",padding:"12px",display:"flex",flexDirection:"column",gap:"12px",overflowY:"auto"},children:C?e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):(()=>{const b=t.filter(Y=>Y.staff);if(b.length===0)return e.jsx("div",{style:{textAlign:"center",padding:"24px 16px",background:"#0b1120",borderRadius:"12px",color:"#64748b",border:"1px solid #1f2937"},children:"No active windows at the moment"});const E=b.length,k=E<=3?"0 0 20vh":"1 1 0";return b.map(Y=>e.jsx("div",{style:{flex:k,minHeight:E>3?0:void 0,display:"flex"},children:e.jsx(Tt,{window:Y,compact:E>3})},Y.id))})()})]})]})}function pn(){const t=Ce(),[r]=Pt(),i=r.get("reason")==="logout_9pm",[o,a]=n.useState({username:"",password:""}),[d,C]=n.useState(""),[f,c]=n.useState(!1);n.useEffect(()=>{const p=localStorage.getItem("token"),s=Ae();p&&(s==null?void 0:s.role)==="STAFF"&&t("/staff/dashboard")},[t]);const x=async p=>{var s,j;p.preventDefault(),C(""),c(!0);try{const I=await w.post("/auth/staff/login",o);localStorage.setItem("token",I.data.token),localStorage.setItem("user",JSON.stringify(I.data.user)),t("/staff/dashboard")}catch(I){C(((j=(s=I.response)==null?void 0:s.data)==null?void 0:j.error)||"Login failed")}finally{c(!1)}};return e.jsxs("div",{className:"staff-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .staff-login-root { padding: 16px !important; }
          .staff-login-card { padding: 24px !important; }
          .staff-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"staff-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsx("h1",{className:"staff-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Staff Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage your queue"}),i&&e.jsx("div",{style:{padding:"12px",background:"#fef3c7",color:"#92400e",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:"You were automatically logged out. Staff sessions end at 9pm."}),e.jsxs("form",{onSubmit:x,children:[e.jsx(ce,{label:"Username",value:o.username,onChange:p=>a({...o,username:p.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(ce,{label:"Password",type:"password",value:o.password,onChange:p=>a({...o,password:p.target.value}),placeholder:"Enter your password",required:!0}),d&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:d}),e.jsx(M,{type:"submit",fullWidth:!0,disabled:f,children:f?"Logging in...":"Login"})]})]})]})}function tt({label:t,error:r,children:i,...o}){return e.jsxs("div",{style:{marginBottom:"16px"},children:[t&&e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:t}),e.jsx("select",{style:{width:"100%",padding:"12px",borderRadius:"8px",border:r?"2px solid #ef4444":"2px solid #e2e8f0",fontSize:"16px",backgroundColor:"white",cursor:"pointer"},...o,children:i}),r&&e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#ef4444"},children:r})]})}function un({onProfileClick:t,onLogout:r}){const[i,o]=n.useState(!1),[a,d]=n.useState(null),[C,f]=n.useState(!0),c=n.useRef(null);n.useEffect(()=>{x()},[]),n.useEffect(()=>{const s=j=>{c.current&&!c.current.contains(j.target)&&o(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const x=async()=>{try{const s=await w.get("/staff/profile");d(s.data.staff)}catch(s){console.error("Failed to load profile:",s)}finally{f(!1)}},p=s=>{if(!s)return"?";const j=s.trim().split(" ");return j.length>=2?(j[0][0]+j[j.length-1][0]).toUpperCase():s.substring(0,2).toUpperCase()};return C?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:c,children:[e.jsx("button",{onClick:()=>o(!i),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:a!=null&&a.profilePicture?`url(${a.profilePicture}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:s=>{s.target.style.borderColor="#2563eb",s.target.style.transform="scale(1.05)"},onMouseOut:s=>{s.target.style.borderColor="#e2e8f0",s.target.style.transform="scale(1)"},children:!(a!=null&&a.profilePicture)&&p(a==null?void 0:a.name)}),i&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(a==null?void 0:a.name)||"Staff"}),e.jsxs("button",{onClick:()=>{o(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#f1f5f9"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(ht,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{o(!1),r()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#fee2e2"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(mt,{size:18}),"Logout"]})]})]})}const ut={success:{icon:rt,color:"#10b981",bg:"#d1fae5"},error:{icon:Bt,color:"#ef4444",bg:"#fee2e2"},warning:{icon:Et,color:"#f59e0b",bg:"#fef3c7"},info:{icon:At,color:"#2563eb",bg:"#dbeafe"}};let xn=0;const Fe=[],Ve=[];function zt(t,r="info",i=3e3){const o=xn++,a={id:o,message:t,type:r,duration:i};return Fe.push(a),Ve.forEach(d=>d([...Fe])),i>0&&setTimeout(()=>{Rt(o)},i),o}function Rt(t){const r=Fe.findIndex(i=>i.id===t);r>-1&&(Fe.splice(r,1),Ve.forEach(i=>i([...Fe])))}function Z(t,r){return zt(t,"success",r)}function F(t,r){return zt(t,"error",r)}function gn(){const[t,r]=n.useState([]);return n.useEffect(()=>{const i=o=>{r(o)};return Ve.push(i),r([...Fe]),()=>{const o=Ve.indexOf(i);o>-1&&Ve.splice(o,1)}},[]),e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:1e4,display:"flex",flexDirection:"column",gap:"12px",pointerEvents:"none"},children:[(t||[]).map(i=>{const o=ut[i.type]||ut.info,a=o.icon;return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px 20px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",alignItems:"center",gap:"12px",minWidth:"300px",maxWidth:"400px",pointerEvents:"auto",animation:"slideIn 0.3s ease-out",borderLeft:`4px solid ${o.color}`},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:o.bg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(a,{size:16,color:o.color})}),e.jsx("div",{style:{flex:1,fontSize:"14px",color:"#1e293b",lineHeight:"1.5"},children:i.message}),e.jsx("button",{onClick:()=>Rt(i.id),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",transition:"color 0.2s"},onMouseOver:d=>{d.target.style.color="#1e293b"},onMouseOut:d=>{d.target.style.color="#64748b"},children:e.jsx(fe,{size:18})})]},i.id)}),e.jsx("style",{children:`
        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      `})]})}function Le({open:t,title:r,message:i,onConfirm:o,onCancel:a,confirmText:d="Confirm",cancelText:C="Cancel",variant:f="danger"}){if(!t)return null;const c={danger:{confirmBg:"#ef4444",confirmHover:"#dc2626"},warning:{confirmBg:"#f59e0b",confirmHover:"#d97706"},info:{confirmBg:"#2563eb",confirmHover:"#1e40af"}},x=c[f]||c.danger;return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:r}),e.jsx("button",{onClick:a,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(fe,{size:20})})]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px",lineHeight:"1.6"},children:i}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:a,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:p=>{p.target.style.background="#f1f5f9",p.target.style.borderColor="#cbd5e1"},onMouseOut:p=>{p.target.style.background="transparent",p.target.style.borderColor="#e2e8f0"},children:C}),e.jsx("button",{onClick:o,style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:x.confirmBg,color:"white",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:p=>{p.target.style.background=x.confirmHover,p.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)"},onMouseOut:p=>{p.target.style.background=x.confirmBg,p.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)"},children:d})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const xt=["#2563eb","#10b981","#f59e0b","#ef4444"];function fn(){const t=Ce(),[r,i]=n.useState(!0),[o,a]=n.useState(null),[d,C]=n.useState([]),[f,c]=n.useState({}),[x,p]=n.useState([]),[s,j]=n.useState(null),[I,R]=n.useState("today"),[g,B]=n.useState(new Date),[y,l]=n.useState({open:!1,queueEntryId:null}),[T,P]=n.useState(null);n.useEffect(()=>{const h=localStorage.getItem("token"),N=Ae();if(!h||(N==null?void 0:N.role)!=="STAFF"){t("/staff/login");return}v(),U();const ie=setInterval(v,3e3);return()=>clearInterval(ie)},[t]),n.useEffect(()=>{I&&$()},[I]),n.useEffect(()=>{const h=setInterval(()=>B(new Date),1e3);return()=>clearInterval(h)},[]);const v=async()=>{var h;try{const N=await w.get("/staff/dashboard");a(N.data.window),C(N.data.queue||[]),c(N.data.stats||{})}catch(N){console.error("Failed to load dashboard:",N),((h=N.response)==null?void 0:h.status)===401&&t("/staff/login")}finally{i(!1)}},U=async()=>{try{const h=await w.get("/windows/active");p(h.data.windows||[])}catch(h){console.error("Failed to load windows:",h)}},$=async()=>{try{let h,N;const ie=new Date;if(I==="today")h=ie.toISOString().split("T")[0],N=h;else if(I==="yesterday"){const ee=new Date(ie);ee.setDate(ee.getDate()-1),h=ee.toISOString().split("T")[0],N=h}else h=ie.toISOString().split("T")[0],N=h;const W=await w.get(`/staff/analytics?startDate=${h}&endDate=${N}`);j(W.data)}catch(h){console.error("Failed to load analytics:",h)}},Q=async h=>{var N,ie;try{await w.post("/staff/assign-window",{windowId:h}),v(),U()}catch(W){console.error("Failed to assign window:",W),alert(((ie=(N=W.response)==null?void 0:N.data)==null?void 0:ie.error)||"Failed to assign window")}},se=async h=>{var N,ie,W,ee,re,he;if(!T){P(h);try{const be=(N=(await w.post(`/staff/serve/${h}`)).data)==null?void 0:N.queueEntry;be?C(Ee=>Ee.map(Te=>Te.id===h?be:Te)):v()}catch(xe){console.error("Failed to start serving:",xe),((ie=xe.response)==null?void 0:ie.status)===409?(F(((ee=(W=xe.response)==null?void 0:W.data)==null?void 0:ee.error)||"Client was already claimed. Refreshing..."),v()):F(((he=(re=xe.response)==null?void 0:re.data)==null?void 0:he.error)||"Failed to start serving")}finally{P(null)}}},oe=async h=>{var N,ie;try{await w.post(`/staff/complete/${h}`),v(),$()}catch(W){console.error("Failed to complete:",W),alert(((ie=(N=W.response)==null?void 0:N.data)==null?void 0:ie.error)||"Failed to complete")}},q=h=>{l({open:!0,queueEntryId:h})},ae=async()=>{var N,ie;const{queueEntryId:h}=y;if(l({open:!1,queueEntryId:null}),!!h)try{await w.post(`/staff/skip/${h}`),v(),$(),Z("Client marked as skipped")}catch(W){console.error("Failed to skip:",W),F(((ie=(N=W.response)==null?void 0:N.data)==null?void 0:ie.error)||"Failed to skip")}},m=async()=>{try{await w.get("/staff/dashboard").then(N=>N.data.window)&&await w.post("/staff/assign-window",{windowId:null})}catch(h){console.error("Error deactivating window on logout:",h)}localStorage.removeItem("token"),localStorage.removeItem("user"),t("/staff/login")},D=()=>{t("/staff/profile")};if(r)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})});const G=d.filter(h=>["SENIOR_CITIZEN","PWD","PREGNANT"].includes(h.clientType)),O=d.filter(h=>h.clientType==="REGULAR"),A=s!=null&&s.byCategory?Object.entries(s.byCategory).map(([h,N])=>({name:h,value:N})):[],H=s!=null&&s.byClientType?Object.entries(s.byClientType).map(([h,N])=>({name:h,value:N})):[],J=h=>{const N=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ie=["January","February","March","April","May","June","July","August","September","October","November","December"],W=N[h.getDay()],ee=ie[h.getMonth()],re=h.getDate(),he=h.getFullYear();let xe=h.getHours();const be=String(h.getMinutes()).padStart(2,"0"),Ee=String(h.getSeconds()).padStart(2,"0"),Te=xe>=12?"PM":"AM";return xe=xe%12,xe=xe||12,`${W}, ${ee} ${re}, ${he} at ${xe}:${be}:${Ee} ${Te}`};return e.jsxs(e.Fragment,{children:[e.jsx(Le,{open:y.open,title:"Skip Client",message:"Mark this client as skipped? They will be removed from the queue and not counted as served.",confirmText:"Skip",cancelText:"Cancel",variant:"warning",onConfirm:ae,onCancel:()=>l({open:!1,queueEntryId:null})}),e.jsx("style",{children:`
        .staff-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .staff-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        .queue-item-buttons button {
          min-height: 44px;
        }
        @media (max-width: 768px) {
          .staff-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-dashboard-header > div:first-child {
            width: 100%;
            flex-direction: column;
            align-items: flex-start !important;
            gap: 8px !important;
          }
          .staff-dashboard-header-center {
            width: 100%;
            text-align: left;
          }
          .staff-dashboard-main-grid {
            grid-template-columns: 1fr !important;
          }
          .staff-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .queue-item-grid {
            grid-template-columns: 1fr !important;
            gap: 12px !important;
          }
          .queue-item-buttons {
            flex-direction: row !important;
            width: 100% !important;
            flex-wrap: wrap;
          }
          .queue-item-buttons button {
            flex: 1;
            min-width: 120px;
          }
          .staff-window-assign-grid {
            grid-template-columns: 1fr !important;
          }
        }
        @media (max-width: 480px) {
          .queue-item-buttons {
            flex-direction: column !important;
          }
          .queue-item-buttons button {
            min-width: 100%;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .staff-dashboard-main-grid {
            grid-template-columns: 60% 40% !important;
          }
        }
      `}),e.jsxs("div",{className:"staff-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsxs("div",{className:"staff-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx("div",{style:{flex:1}}),o&&e.jsxs("div",{className:"staff-dashboard-header-center",style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",marginRight:"30px"},children:["Operating: ",o.label]}),e.jsx(un,{onProfileClick:D,onLogout:m})]}),e.jsxs("div",{className:"staff-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:J(g)})}),!o&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Assign Window"}),e.jsx("div",{className:"staff-window-assign-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"12px"},children:x.map(h=>e.jsx(M,{onClick:()=>Q(h.id),variant:"outline",children:h.label},h.id))})]}),e.jsxs("div",{className:"staff-dashboard-main-grid",style:{display:"grid",gridTemplateColumns:"75% 25%",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"20px"},children:["Queue (",d.length,")"]}),G.length>0&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#f59e0b",marginBottom:"12px"},children:"Priority Clients"}),G.map(h=>e.jsx(gt,{entry:h,onServe:se,onComplete:oe,onSkip:q,servingId:T},h.id))]}),O.length>0&&e.jsxs("div",{children:[G.length>0&&e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#64748b",marginBottom:"12px"},children:"Regular Clients"}),O.map(h=>e.jsx(gt,{entry:h,onServe:se,onComplete:oe,onSkip:q,servingId:T},h.id))]}),d.length===0&&e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#94a3b8"},children:"No clients in queue"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"In Queue"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#f59e0b"},children:d.length})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Total Served Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#2563eb"},children:f.totalServed||0})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{fontSize:"14px",color:"#64748b",marginBottom:"8px"},children:"Skipped Today"}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:"#ef4444"},children:f.totalSkipped||0})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Analytics"}),e.jsxs(tt,{value:I,onChange:h=>R(h.target.value),style:{width:"100%"},children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"yesterday",children:"Yesterday"})]})]}),s&&e.jsxs(e.Fragment,{children:[A.length>0&&e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Category"}),e.jsx(Oe,{width:"100%",height:200,children:e.jsxs(it,{data:A,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"name"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(st,{dataKey:"value",fill:"#2563eb"})]})})]}),H.length>0&&e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px"},children:"By Client Type"}),e.jsx(Oe,{width:"100%",height:200,children:e.jsxs(St,{children:[e.jsx(Ct,{data:H,cx:"50%",cy:"50%",labelLine:!1,label:({name:h,percent:N})=>`${h}: ${(N*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:H.map((h,N)=>e.jsx(kt,{fill:xt[N%xt.length]},`cell-${N}`))}),e.jsx(Me,{})]})})]})]})]})]})]})]})]})]})}function gt({entry:t,onServe:r,onComplete:i,onSkip:o,servingId:a}){var f,c,x;const d=t.status==="NOW_SERVING",C=a===t.id;return e.jsxs("div",{className:"queue-item-grid",style:{padding:"16px",border:d?"2px solid #2563eb":"1px solid #e2e8f0",borderRadius:"8px",marginBottom:"12px",background:d?"#eff6ff":"white",display:"grid",gridTemplateColumns:"1fr auto",gap:"20px",alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"700",color:"#2563eb",marginBottom:"4px"},children:t.queueNumber}),e.jsx("div",{style:{fontSize:"14px",color:"#1e293b",marginBottom:"4px"},children:t.clientName}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginBottom:"8px",flexWrap:"wrap"},children:[e.jsx(Dt,{clientType:t.clientType}),e.jsxs("span",{style:{fontSize:"12px",color:"#64748b"},children:[((f=t.concernCategories)!=null&&f.length?t.concernCategories:t.category?[t.category]:[]).map(p=>p==null?void 0:p.name).filter(Boolean).join(", "),((c=t.concernSubCategories)!=null&&c.length?t.concernSubCategories:t.subCategory?[t.subCategory]:[]).map(p=>p==null?void 0:p.name).filter(Boolean).length>0&&` - ${((x=t.concernSubCategories)!=null&&x.length?t.concernSubCategories:[t.subCategory]).map(p=>p==null?void 0:p.name).filter(Boolean).join(", ")}`]})]}),e.jsxs("div",{style:{fontSize:"12px",color:"#94a3b8"},children:["Joined: ",new Date(t.joinedAt).toLocaleTimeString()]})]}),e.jsxs("div",{className:"queue-item-buttons",style:{display:"flex",gap:"8px",flexDirection:"column"},children:[d?e.jsx(M,{variant:"success",icon:rt,onClick:()=>i(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Mark as Served"}):e.jsx(M,{variant:"primary",icon:Nt,onClick:()=>r(t.id),disabled:C,style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:C?"Serving...":"Start Serving"}),e.jsx(M,{variant:"danger",icon:Lt,onClick:()=>o(t.id),style:{fontSize:"12px",padding:"8px 16px",whiteSpace:"nowrap"},children:"Skip"})]})]})}function hn(){const t=Ce(),[r,i]=n.useState(!0),[o,a]=n.useState(!1),[d,C]=n.useState(null),[f,c]=n.useState(null),[x,p]=n.useState(null),[s,j]=n.useState(!1),[I,R]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[g,B]=n.useState(!1),[y,l]=n.useState(null),[T,P]=n.useState([]),[v,U]=n.useState(""),[$,Q]=n.useState(!1);n.useEffect(()=>{const A=localStorage.getItem("token"),H=Ae();if(!A||(H==null?void 0:H.role)!=="STAFF"){t("/staff/login");return}se()},[t]);const se=async()=>{var A;try{const H=await w.get("/staff/profile");C(H.data.staff),c(H.data.staff.profilePicture);const J=H.data.currentWindow||null;l(J),U((J==null?void 0:J.id)||"")}catch(H){console.error("Failed to load profile:",H),((A=H.response)==null?void 0:A.status)===401&&t("/staff/login")}finally{i(!1)}},oe=async()=>{try{const A=await w.get("/windows/active");P(A.data.windows||[])}catch(A){console.error("Failed to load windows:",A)}};n.useEffect(()=>{oe()},[]);const q=async A=>{var H,J;if(A.preventDefault(),!v||v===(y==null?void 0:y.id)){v===(y==null?void 0:y.id)&&F("You are already assigned to this window");return}Q(!0);try{await w.post("/staff/assign-window",{windowId:v});const h=T.find(N=>N.id===v);l(h?{id:h.id,label:h.label}:null),Z("Window changed successfully. You are now operating at "+((h==null?void 0:h.label)||"the selected window")+".")}catch(h){console.error("Failed to switch window:",h),F(((J=(H=h.response)==null?void 0:H.data)==null?void 0:J.error)||"Failed to switch window")}finally{Q(!1)}},ae=A=>{const H=A.target.files[0];if(H){const J=new FileReader;J.onloadend=()=>{p(J.result)},J.readAsDataURL(H),c(H)}},m=async A=>{var H,J;A.preventDefault(),a(!0);try{if(await w.put("/staff/profile",{name:d.name}),f instanceof File){const h=new FormData;h.append("picture",f);const N=await w.post("/staff/profile/picture",h,{headers:{"Content-Type":"multipart/form-data"}});c(N.data.profilePicture),p(null)}Z("Profile updated successfully!"),t("/staff/dashboard")}catch(h){console.error("Failed to update profile:",h),F(((J=(H=h.response)==null?void 0:H.data)==null?void 0:J.error)||"Failed to update profile")}finally{a(!1)}},D=async A=>{var H,J;if(A.preventDefault(),I.newPassword!==I.confirmPassword){F("New passwords do not match");return}if(I.newPassword.length<6){F("Password must be at least 6 characters");return}B(!0);try{await w.post("/staff/profile/change-password",{currentPassword:I.currentPassword,newPassword:I.newPassword}),Z("Password changed successfully!"),j(!1),R({currentPassword:"",newPassword:"",confirmPassword:""})}catch(h){console.error("Failed to change password:",h),F(((J=(H=h.response)==null?void 0:H.data)==null?void 0:J.error)||"Failed to change password")}finally{B(!1)}};if(r)return e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})});const G=A=>{if(!A)return"?";const H=A.trim().split(" ");return H.length>=2?(H[0][0]+H[H.length-1][0]).toUpperCase():A.substring(0,2).toUpperCase()},O=x||(d!=null&&d.profilePicture?d.profilePicture:null);return e.jsxs("div",{className:"staff-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .staff-profile-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        @media (max-width: 768px) {
          .staff-profile-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-content {
            margin: 24px auto !important;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .staff-profile-card {
            padding: 24px !important;
          }
          .staff-profile-buttons {
            flex-direction: column !important;
          }
          .staff-profile-buttons button {
            width: 100%;
          }
        }
      `}),e.jsxs("div",{className:"staff-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx(M,{variant:"outline",icon:yt,onClick:()=>t("/staff/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"staff-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"staff-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"32px",color:"#1e293b"},children:"My Profile"}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{style:{marginBottom:"32px",textAlign:"center"},children:[e.jsx("div",{style:{width:"120px",height:"120px",borderRadius:"50%",margin:"0 auto 16px",border:"3px solid #e2e8f0",background:O?`url(${O}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"36px",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:!O&&G(d==null?void 0:d.name)}),e.jsxs("label",{style:{display:"inline-block",padding:"8px 16px",background:"#2563eb",color:"white",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"background 0.2s"},onMouseOver:A=>{A.target.style.background="#1e40af"},onMouseOut:A=>{A.target.style.background="#2563eb"},children:["Change Picture",e.jsx("input",{type:"file",accept:"image/*",onChange:ae,style:{display:"none"}})]}),e.jsx("p",{style:{fontSize:"12px",color:"#64748b",marginTop:"8px"},children:"JPG, PNG, GIF, WebP (max 2MB)"})]}),e.jsx(ce,{label:"Name",value:(d==null?void 0:d.name)||"",onChange:A=>C({...d,name:A.target.value}),required:!0}),e.jsx(ce,{label:"Username",value:(d==null?void 0:d.username)||"",disabled:!0,readOnly:!0}),e.jsxs("div",{className:"staff-profile-buttons",style:{display:"flex",gap:"12px",marginTop:"24px"},children:[e.jsx(M,{type:"submit",icon:bt,disabled:o,fullWidth:!0,children:o?"Saving...":"Save Changes"}),e.jsx(M,{variant:"outline",icon:fe,onClick:()=>t("/staff/dashboard"),fullWidth:!0,children:"Cancel"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",marginBottom:"16px",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(ot,{size:20}),"Operating window"]}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"12px"},children:y?`You are currently at ${y.label}.`:"You are not assigned to a window yet."}),e.jsxs("form",{onSubmit:q,style:{display:"flex",flexDirection:"row",gap:"12px",alignItems:"center",flexWrap:"wrap",maxWidth:"420px"},children:[e.jsx("div",{style:{flex:"1 1 200px"},children:e.jsxs(tt,{label:"Switch to window",value:v,onChange:A=>U(A.target.value),children:[e.jsx("option",{value:"",children:"â€” Select window â€”"}),T.map(A=>e.jsx("option",{value:A.id,children:A.label},A.id))]})}),e.jsx(M,{type:"submit",icon:ot,disabled:$||!v||v===(y==null?void 0:y.id),fullWidth:!0,style:{flex:"1 1 200px",padding:"12px 20px"},children:$?"Switching...":"Switch window"})]})]}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(M,{variant:"outline",icon:lt,onClick:()=>{j(!s),s&&R({currentPassword:"",newPassword:"",confirmPassword:""})},children:s?"Cancel":"Change Password"})]}),s&&e.jsxs("form",{onSubmit:D,children:[e.jsx(ce,{label:"Current Password",type:"password",value:I.currentPassword,onChange:A=>R({...I,currentPassword:A.target.value}),required:!0}),e.jsx(ce,{label:"New Password",type:"password",value:I.newPassword,onChange:A=>R({...I,newPassword:A.target.value}),required:!0}),e.jsx(ce,{label:"Confirm New Password",type:"password",value:I.confirmPassword,onChange:A=>R({...I,confirmPassword:A.target.value}),required:!0}),e.jsx(M,{type:"submit",icon:vt,disabled:g,fullWidth:!0,style:{marginTop:"16px"},children:g?"Changing...":"Change Password"})]})]})]})})]})}function mn(){const t=Ce(),[r,i]=n.useState({username:"",password:""}),[o,a]=n.useState(""),[d,C]=n.useState(!1);n.useEffect(()=>{const c=localStorage.getItem("token"),x=Ae();c&&(x==null?void 0:x.role)==="ADMIN"&&t("/admin/dashboard")},[t]);const f=async c=>{var x,p;c.preventDefault(),a(""),C(!0);try{const s=await w.post("/auth/admin/login",r);localStorage.setItem("token",s.data.token),localStorage.setItem("user",JSON.stringify(s.data.user)),t("/admin/dashboard")}catch(s){a(((p=(x=s.response)==null?void 0:x.data)==null?void 0:p.error)||"Login failed")}finally{C(!1)}};return e.jsxs("div",{className:"admin-login-root",style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",paddingLeft:"max(20px, env(safe-area-inset-left))",paddingRight:"max(20px, env(safe-area-inset-right))"},children:[e.jsx("style",{children:`
        @media (max-width: 480px) {
          .admin-login-root { padding: 16px !important; }
          .admin-login-card { padding: 24px !important; }
          .admin-login-title { font-size: 22px !important; }
        }
      `}),e.jsxs("div",{className:"admin-login-card",style:{background:"white",borderRadius:"16px",padding:"40px",maxWidth:"400px",width:"100%",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[e.jsx("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"center"},children:e.jsx(Ie,{size:"medium",titlePosition:"below",align:"center"})}),e.jsx("h1",{className:"admin-login-title",style:{fontSize:"28px",fontWeight:"700",marginBottom:"8px",color:"#1e293b",textAlign:"center"},children:"Admin Login"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",textAlign:"center",marginBottom:"32px"},children:"Sign in to manage the system"}),e.jsxs("form",{onSubmit:f,children:[e.jsx(ce,{label:"Username",value:r.username,onChange:c=>i({...r,username:c.target.value}),placeholder:"Enter your username",required:!0,autoFocus:!0}),e.jsx(ce,{label:"Password",type:"password",value:r.password,onChange:c=>i({...r,password:c.target.value}),placeholder:"Enter your password",required:!0}),o&&e.jsx("div",{style:{padding:"12px",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:o}),e.jsx(M,{type:"submit",fullWidth:!0,disabled:d,children:d?"Logging in...":"Login"})]})]})]})}function yn({onProfileClick:t,onLogout:r}){const[i,o]=n.useState(!1),[a,d]=n.useState(null),[C,f]=n.useState(!0),c=n.useRef(null);Ce(),n.useEffect(()=>{x()},[]),n.useEffect(()=>{const s=j=>{c.current&&!c.current.contains(j.target)&&o(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const x=async()=>{try{const s=Ae();s&&d({name:s.name||"Admin",username:s.username})}catch(s){console.error("Failed to load profile:",s)}finally{f(!1)}},p=s=>{if(!s)return"A";const j=s.trim().split(" ");return j.length>=2?(j[0][0]+j[j.length-1][0]).toUpperCase():s.substring(0,2).toUpperCase()};return C?e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"#e2e8f0"}}):e.jsxs("div",{style:{position:"relative"},ref:c,children:[e.jsx("button",{onClick:()=>o(!i),style:{width:"44px",height:"44px",minWidth:"44px",minHeight:"44px",borderRadius:"50%",border:"2px solid #e2e8f0",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",fontWeight:"700",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,transition:"all 0.2s"},onMouseOver:s=>{s.target.style.borderColor="#2563eb",s.target.style.transform="scale(1.05)"},onMouseOut:s=>{s.target.style.borderColor="#e2e8f0",s.target.style.transform="scale(1)"},children:p(a==null?void 0:a.name)}),i&&e.jsxs("div",{style:{position:"absolute",top:"48px",right:0,background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",minWidth:"160px",zIndex:1e3,border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #e2e8f0",fontSize:"14px",fontWeight:"600",color:"#1e293b"},children:(a==null?void 0:a.name)||(a==null?void 0:a.username)||"Admin"}),t&&e.jsxs("button",{onClick:()=>{o(!1),t()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#1e293b",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#f1f5f9"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(ht,{size:18}),"Profile"]}),e.jsxs("button",{onClick:()=>{o(!1),r()},style:{width:"100%",padding:"14px 16px",minHeight:"44px",border:"none",background:"transparent",textAlign:"left",fontSize:"14px",color:"#ef4444",cursor:"pointer",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"10px"},onMouseOver:s=>{s.currentTarget.style.background="#fee2e2"},onMouseOut:s=>{s.currentTarget.style.background="transparent"},children:[e.jsx(mt,{size:18}),"Logout"]})]})]})}function bn({open:t,title:r,message:i,placeholder:o="",onConfirm:a,onCancel:d,confirmText:C="Confirm",cancelText:f="Cancel",type:c="text",required:x=!0}){const[p,s]=n.useState("");if(n.useEffect(()=>{t&&s("")},[t]),!t)return null;const j=()=>{x&&!p.trim()||(a(p),s(""))},I=()=>{s(""),d()};return e.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-out"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"400px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",animation:"slideUp 0.3s ease-out"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b",margin:0},children:r}),e.jsx("button",{onClick:I,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(fe,{size:20})})]}),i&&e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px",lineHeight:"1.6"},children:i}),e.jsx("input",{type:c,value:p,onChange:R=>s(R.target.value),placeholder:o,required:x,style:{width:"100%",padding:"10px 12px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px",marginBottom:"24px",transition:"border-color 0.2s"},onFocus:R=>{R.target.style.borderColor="#2563eb"},onBlur:R=>{R.target.style.borderColor="#e2e8f0"},onKeyDown:R=>{R.key==="Enter"?j():R.key==="Escape"&&I()},autoFocus:!0}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:I,style:{padding:"10px 20px",border:"2px solid #e2e8f0",borderRadius:"8px",background:"transparent",color:"#64748b",fontSize:"14px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s"},onMouseOver:R=>{R.target.style.background="#f1f5f9",R.target.style.borderColor="#cbd5e1"},onMouseOut:R=>{R.target.style.background="transparent",R.target.style.borderColor="#e2e8f0"},children:f}),e.jsx("button",{onClick:j,disabled:x&&!p.trim(),style:{padding:"10px 20px",border:"none",borderRadius:"8px",background:x&&!p.trim()?"#cbd5e1":"#2563eb",color:"white",fontSize:"14px",fontWeight:"600",cursor:x&&!p.trim()?"not-allowed":"pointer",transition:"all 0.2s",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},onMouseOver:R=>{x&&!p.trim()||(R.target.style.background="#1e40af",R.target.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)")},onMouseOut:R=>{x&&!p.trim()||(R.target.style.background="#2563eb",R.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)")},children:C})]})]}),e.jsx("style",{children:`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
      `})]})}const ft=["#2563eb","#10b981","#f59e0b","#ef4444","#8b5cf6"];function Ne(t,r){var o;const i=(o=t==null?void 0:t.response)==null?void 0:o.data;if(i!=null&&i.error&&typeof i.error=="string")return i.error;if(Array.isArray(i==null?void 0:i.errors)&&i.errors.length>0){const a=i.errors[0];return(a==null?void 0:a.msg)||(a==null?void 0:a.message)||r}return r}function vn(){const t=Ce(),[r,i]=n.useState("dashboard"),[o,a]=n.useState(!0),[d,C]=n.useState(null),[f,c]=n.useState([]),[x,p]=n.useState([]),[s,j]=n.useState([]),[I,R]=n.useState(null),[g,B]=n.useState({startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""}),[y,l]=n.useState(!1),[T,P]=n.useState(5),[v,U]=n.useState({open:!1,data:{}}),[$,Q]=n.useState({open:!1,data:{}}),[se,oe]=n.useState({open:!1,data:{}}),[q,ae]=n.useState({open:!1,data:{}}),[m,D]=n.useState({open:!1,title:"",message:"",placeholder:"",type:"text",onConfirm:()=>{},onCancel:()=>{}});n.useEffect(()=>{const W=localStorage.getItem("token"),ee=Ae();if(!W||(ee==null?void 0:ee.role)!=="ADMIN"){t("/admin/login");return}O();const re=setInterval(()=>{r==="dashboard"&&A()},3e3),he=setInterval(()=>{r==="staff"&&H()},3e4);return()=>{clearInterval(re),clearInterval(he)}},[t,r]),n.useEffect(()=>{r==="reports"&&N()},[r,g]);const G=async()=>{try{const ee=(await w.get("/admin/settings/staff-idle-minutes")).data.staffIdleMinutes;typeof ee=="number"&&ee>=1&&ee<=120&&P(ee)}catch(W){console.error("Failed to load staff idle minutes:",W)}},O=async()=>{try{await Promise.all([A(),H(),J(),h(),G()])}catch(W){console.error("Error loading data:",W)}finally{a(!1)}},A=async()=>{try{const W=await w.get("/admin/dashboard");C(W.data.stats)}catch(W){console.error("Failed to load dashboard:",W)}},H=async()=>{try{const W=await w.get("/admin/staff");c(W.data.staff)}catch(W){console.error("Failed to load staff:",W)}},J=async()=>{try{const W=await w.get("/admin/windows");p(W.data.windows)}catch(W){console.error("Failed to load windows:",W)}},h=async()=>{try{const W=await w.get("/categories");j(W.data.categories)}catch(W){console.error("Failed to load categories:",W)}},N=async()=>{try{const W=new URLSearchParams;W.append("startDate",g.startDate),W.append("endDate",g.endDate),g.staffIds&&g.staffIds.length>0&&g.staffIds.forEach(re=>W.append("staffId",re)),g.categoryIds&&g.categoryIds.length>0&&g.categoryIds.forEach(re=>W.append("categoryId",re)),g.clientTypes&&g.clientTypes.length>0&&g.clientTypes.forEach(re=>W.append("clientType",re)),g.startHour&&W.append("startHour",g.startHour),g.endHour&&W.append("endHour",g.endHour);const ee=await w.get(`/admin/reports?${W.toString()}`);R(ee.data)}catch(W){console.error("Failed to load reports:",W)}},ie=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t("/admin/login")};return o?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .admin-dashboard-root {
          padding-left: env(safe-area-inset-left);
          padding-right: env(safe-area-inset-right);
        }
        .admin-dashboard-content {
          padding-left: max(24px, env(safe-area-inset-left));
          padding-right: max(24px, env(safe-area-inset-right));
        }
        @media (max-width: 768px) {
          .admin-dashboard-header {
            flex-wrap: wrap;
            gap: 12px;
            padding: 12px 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-dashboard-header > div:first-child {
            flex-direction: row;
            align-items: center;
            gap: 12px;
          }
          .admin-dashboard-header h1 {
            font-size: 20px !important;
          }
          .admin-dashboard-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
          }
          .admin-dashboard-tabs button {
            white-space: nowrap;
            font-size: 13px;
            padding: 10px 16px !important;
            min-height: 44px;
            flex-shrink: 0;
          }
          .admin-dashboard-tabs button span {
            display: none;
          }
          .admin-dashboard-content {
            padding: 16px !important;
            padding-left: max(16px, env(safe-area-inset-left)) !important;
            padding-right: max(16px, env(safe-area-inset-right)) !important;
          }
          .admin-stats-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-reports-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-filter-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-page-header {
            flex-direction: column;
            align-items: flex-start !important;
            gap: 12px;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) !important;
          }
          .admin-modal-overlay {
            padding: 16px;
            align-items: flex-start;
            overflow-y: auto;
          }
          .admin-modal-box {
            max-height: calc(100vh - 32px);
            overflow-y: auto;
            width: 100%;
            margin: auto;
          }
          .admin-settings-buttons {
            flex-wrap: wrap;
          }
          .admin-settings-buttons button {
            min-width: 140px;
          }
          .admin-reports-table-wrap {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 0 -16px;
            padding: 0 16px;
          }
        }
        @media (max-width: 480px) {
          .admin-stats-grid,
          .admin-stats-grid-4,
          .admin-cards-grid {
            grid-template-columns: 1fr !important;
          }
          .admin-dashboard-tabs button {
            padding: 12px 14px !important;
          }
        }
        @media (max-width: 1024px) and (min-width: 769px) {
          .admin-stats-grid-4 {
            grid-template-columns: repeat(2, 1fr) !important;
          }
          .admin-cards-grid {
            grid-template-columns: repeat(3, 1fr) !important;
          }
          .settings-grid {
            grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
            gap: 16px;
          }
        }
      `}),e.jsxs("div",{className:"admin-dashboard-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx(bn,{...m}),e.jsxs("div",{className:"admin-dashboard-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx("div",{style:{flex:1}}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",color:"#1e293b",margin:0,marginRight:"30px"},children:"Admin Dashboard"}),e.jsx(yn,{onProfileClick:()=>t("/admin/profile"),onLogout:ie})]}),e.jsx("div",{className:"admin-dashboard-tabs",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"0 24px",display:"flex",gap:"4px"},children:[{id:"dashboard",label:"Dashboard",icon:Ot},{id:"staff",label:"Staff",icon:Mt},{id:"windows",label:"Windows",icon:wt},{id:"categories",label:"Categories",icon:jt},{id:"reports",label:"Reports",icon:Ft},{id:"settings",label:"Settings",icon:Ut}].map(W=>{const ee=W.icon,re=r===W.id;return e.jsxs("button",{onClick:()=>i(W.id),style:{padding:"12px 20px",border:"none",background:re?"#eff6ff":"transparent",borderBottom:re?"3px solid #2563eb":"3px solid transparent",color:re?"#2563eb":"#64748b",fontWeight:re?"600":"400",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",transition:"all 0.2s",borderRadius:"8px 8px 0 0"},onMouseOver:he=>{re||(he.target.style.background="#f1f5f9",he.target.style.color="#475569")},onMouseOut:he=>{re||(he.target.style.background="transparent",he.target.style.color="#64748b")},children:[e.jsx(ee,{size:18}),e.jsx("span",{children:W.label})]},W.id)})}),e.jsxs("div",{className:"admin-dashboard-content",style:{maxWidth:"1400px",margin:"0 auto",padding:"24px"},children:[r==="dashboard"&&e.jsx(wn,{stats:d}),r==="staff"&&e.jsx(jn,{staff:f,categories:s,onRefresh:H,form:v,setForm:U,setInputDialog:D,staffIdleMinutes:T}),r==="windows"&&e.jsx(Sn,{windows:x,onRefresh:J,form:$,setForm:Q}),r==="categories"&&e.jsx(Cn,{categories:s,onRefresh:h,categoryForm:se,setCategoryForm:oe,subCategoryForm:q,setSubCategoryForm:ae}),r==="reports"&&e.jsx(kn,{reports:I,filters:g,setFilters:B,staff:f,categories:s,showFilters:y,setShowFilters:l,onRefresh:N}),r==="settings"&&e.jsx(In,{staffIdleMinutes:T,onStaffIdleMinutesSaved:P})]})]})]})}function wn({stats:t}){const[r,i]=n.useState(new Date);if(n.useEffect(()=>{const a=setInterval(()=>{i(new Date)},1e3);return()=>clearInterval(a)},[]),!t)return e.jsx(ke,{});const o=a=>{const d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],C=["January","February","March","April","May","June","July","August","September","October","November","December"],f=d[a.getDay()],c=C[a.getMonth()],x=a.getDate(),p=a.getFullYear();let s=a.getHours();const j=String(a.getMinutes()).padStart(2,"0"),I=String(a.getSeconds()).padStart(2,"0"),R=s>=12?"PM":"AM";return s=s%12,s=s||12,`${f}, ${c} ${x}, ${p} at ${s}:${j}:${I} ${R}`};return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"24px"},children:e.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:o(r)})}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"16px"},children:[e.jsx(Se,{label:"Queue Entries Today",value:t.todayQueueEntries,icon:Vt,color:"#2563eb"}),e.jsx(Se,{label:"Serving",value:t.servingCount,icon:Ht,color:"#2563eb"}),e.jsx(Se,{label:"Waiting",value:t.waitingCount,icon:qt,color:"#f59e0b"}),e.jsx(Se,{label:"Served Today",value:t.todayServed,icon:rt,color:"#10b981"})]}),e.jsxs("div",{className:"admin-stats-grid-4",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px",marginBottom:"24px"},children:[e.jsx(Se,{label:"Active Windows",value:t.activeWindows,icon:ot,color:"#10b981"}),e.jsx(Se,{label:"Active Staff",value:t.activeStaff,icon:$t,color:"#10b981"}),e.jsx(Se,{label:"Total Windows",value:t.totalWindows,icon:Yt,color:"#2563eb"}),e.jsx(Se,{label:"Total Staff",value:t.totalStaff,icon:_t,color:"#2563eb"})]})]})}function Se({label:t,value:r,color:i="#2563eb",icon:o}){return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"12px"},children:[o&&e.jsx(o,{size:20,color:i,style:{flexShrink:0}}),e.jsx("div",{style:{fontSize:"14px",color:"#64748b",fontWeight:"500"},children:t})]}),e.jsx("div",{style:{fontSize:"32px",fontWeight:"700",color:i,lineHeight:"1.2"},children:r||0})]})}function jn({staff:t,categories:r,onRefresh:i,form:o,setForm:a,setInputDialog:d,staffIdleMinutes:C=5}){const[f,c]=n.useState(null),[x,p]=n.useState(!1),s=n.useRef(null),[j,I]=n.useState({open:!1});n.useEffect(()=>{const l=T=>{s.current&&!s.current.contains(T.target)&&p(!1)};return x&&document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[x]);const R=async l=>{l.preventDefault();try{await w.post("/admin/staff",o.data),a({open:!1,data:{}}),Z("Staff created successfully!"),i()}catch(T){F(Ne(T,"Failed to create staff"))}},g=async l=>{l.preventDefault();try{await w.put(`/admin/staff/${f.id}`,o.data),a({open:!1,data:{}}),c(null),Z("Staff updated successfully!"),i()}catch(T){F(Ne(T,"Failed to update staff"))}},B=async(l,T)=>{try{await w.put(`/admin/staff/${l}`,{isActive:!T}),Z(`Staff ${T?"deactivated":"activated"} successfully!`),i()}catch(P){F(Ne(P,"Failed to update staff"))}},y=async(l,T)=>{d({open:!0,title:"Reset Password",message:`Enter new password for ${T}:`,placeholder:"New password (min 6 characters)",type:"password",onConfirm:async P=>{var v,U;if(d({open:!1}),!!P){if(P.length<6){F("Password must be at least 6 characters");return}try{await w.post(`/admin/staff/${l}/reset-password`,{password:P}),Z("Password reset successfully!")}catch($){F(((U=(v=$.response)==null?void 0:v.data)==null?void 0:U.error)||"Failed to reset password")}}},onCancel:()=>d({open:!1})})};return e.jsxs("div",{children:[e.jsx(Le,{...j}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Staff Management"}),e.jsx(M,{onClick:()=>{a({open:!0,data:{}}),c(null)},children:"Add Staff"})]}),o.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{a({open:!1,data:{}}),c(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:f?"Edit Staff":"Create Staff"}),e.jsx("button",{onClick:()=>{a({open:!1,data:{}}),c(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(fe,{size:20})})]}),e.jsxs("form",{onSubmit:f?g:R,children:[e.jsx(ce,{label:"Username",value:o.data.username||"",onChange:l=>a({...o,data:{...o.data,username:l.target.value}}),required:!f,disabled:!!f}),e.jsx(ce,{label:"Name",value:o.data.name||"",onChange:l=>a({...o,data:{...o.data,name:l.target.value}}),required:!0}),(!f||o.data.password)&&e.jsx(ce,{label:"Password",type:"password",value:o.data.password||"",onChange:l=>a({...o,data:{...o.data,password:l.target.value}}),required:!f}),e.jsxs("div",{style:{marginBottom:"16px",position:"relative"},ref:s,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Specializations (Categories)"}),e.jsx("div",{onClick:()=>p(!x),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:o.data.categoryIds&&o.data.categoryIds.length>0?o.data.categoryIds.map(l=>{const T=r.find(P=>P.id===l);return T?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:P=>{P.stopPropagation(),a({...o,data:{...o.data,categoryIds:o.data.categoryIds.filter(v=>v!==l)}})},children:[T.name,e.jsx(fe,{size:12})]},l):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),x&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:r.map(l=>{var P;const T=((P=o.data.categoryIds)==null?void 0:P.includes(l.id))||!1;return e.jsxs("div",{onClick:()=>{const v=o.data.categoryIds||[];a(T?{...o,data:{...o.data,categoryIds:v.filter(U=>U!==l.id)}}:{...o,data:{...o.data,categoryIds:[...v,l.id]}})},style:{padding:"10px 12px",cursor:"pointer",background:T?"#eff6ff":"white",color:T?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:v=>{T||(v.currentTarget.style.background="#f8fafc")},onMouseOut:v=>{T||(v.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:T,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:l.name})]},l.id)})})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:fe,onClick:()=>{a({open:!1,data:{}}),c(null)},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:f?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(l=>{const T=l.name?l.name.split(" ").map(v=>v[0]).join("").toUpperCase().slice(0,2):l.username.charAt(0).toUpperCase(),P=l.specializations?l.specializations.map(v=>v.category.name):[];return e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:l.profilePictureUrl?"transparent":"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",marginBottom:"8px",border:l.profilePictureUrl?"2px solid #e2e8f0":"none"},children:l.profilePictureUrl?e.jsx("img",{src:l.profilePictureUrl,alt:l.name,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("span",{style:{color:"white",fontSize:"28px",fontWeight:"600"},children:T})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:l.name}),e.jsx("div",{style:{fontSize:"12px",color:"#64748b"},children:l.username})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",marginBottom:"8px",fontSize:"12px",color:"#64748b"},children:[e.jsx("span",{style:{width:"8px",height:"8px",borderRadius:"50%",background:(()=>{const v=l.lastSeenAt?new Date(l.lastSeenAt).getTime():0,U=(C||5)*60*1e3,$=Date.now()-U;return v>=$?"#22c55e":"#94a3b8"})(),flexShrink:0}}),e.jsx("span",{children:(()=>{const v=l.lastSeenAt?new Date(l.lastSeenAt).getTime():0,U=(C||5)*60*1e3,$=Date.now()-U;return v>=$?"Online":"Offline"})()})]}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:P.length>0?P.map((v,U)=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:v},U)):e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#f1f5f9",color:"#64748b",fontWeight:"500"},children:"All categories"})}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:l.isActive?"#ecfdf5":"#fef2f2",color:l.isActive?"#059669":"#dc2626",fontWeight:"600"},children:l.isActive?"Active":"Inactive"})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{c(l),a({open:!0,data:{username:l.username,name:l.name,categoryIds:l.specializations?l.specializations.map(v=>v.categoryId):[]}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"25%"},onMouseOver:v=>{v.target.style.background="#eff6ff"},onMouseOut:v=>{v.target.style.background="transparent"},children:[e.jsx(dt,{size:14}),"Edit"]}),e.jsxs("button",{onClick:()=>y(l.id,l.name),style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"75%"},onMouseOver:v=>{v.target.style.background="#eff6ff"},onMouseOut:v=>{v.target.style.background="transparent"},children:[e.jsx(lt,{size:14}),"Reset Password"]})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",width:"100%"},children:[e.jsx(M,{variant:l.isActive?"danger":"success",icon:Gt,onClick:()=>B(l.id,l.isActive),style:{fontSize:"12px",padding:"6px 12px",flex:1},children:l.isActive?"Deactivate":"Activate"}),e.jsx(M,{variant:"danger",icon:Xe,onClick:()=>{I({open:!0,title:"Remove Staff",message:`Are you sure you want to remove ${l.name||l.username}? This cannot be undone and is only allowed if the staff has no serving history.`,onConfirm:async()=>{I({open:!1});try{await w.delete(`/admin/staff/${l.id}`),Z("Staff removed successfully!"),i()}catch(v){F(Ne(v,"Failed to remove staff"))}},onCancel:()=>I({open:!1})})},style:{fontSize:"12px",padding:"6px 12px",flex:1},children:"Remove"})]})]})]},l.id)})})]})}function Sn({windows:t,onRefresh:r,form:i,setForm:o}){const[a,d]=n.useState(null),[C,f]=n.useState({open:!1}),c=async s=>{s.preventDefault();try{await w.post("/admin/windows",i.data),o({open:!1,data:{}}),Z("Window created successfully!"),r()}catch(j){F(Ne(j,"Failed to create window"))}},x=async s=>{s.preventDefault();try{await w.put(`/admin/windows/${a.id}`,i.data),o({open:!1,data:{}}),d(null),Z("Window updated successfully!"),r()}catch(j){F(Ne(j,"Failed to update window"))}},p=async s=>{f({open:!0,title:"Delete Window",message:"Are you sure you want to delete this window? This action cannot be undone.",onConfirm:async()=>{f({open:!1});try{await w.delete(`/admin/windows/${s}`),Z("Window deleted successfully!"),r()}catch(j){F(Ne(j,"Failed to delete window"))}},onCancel:()=>f({open:!1})})};return e.jsxs("div",{children:[e.jsx(Le,{...C}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Window Management"}),e.jsx(M,{icon:at,onClick:()=>{o({open:!0,data:{isActive:!0}}),d(null)},children:"Add Window"})]}),i.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{o({open:!1,data:{}}),d(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:a?"Edit Window":"Create Window"}),e.jsx("button",{onClick:()=>{o({open:!1,data:{}}),d(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(fe,{size:20})})]}),e.jsxs("form",{onSubmit:a?x:c,children:[e.jsx(ce,{label:"Window Label",value:i.data.label||"",onChange:s=>o({...i,data:{...i.data,label:s.target.value}}),required:!0}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px"},children:[e.jsx("input",{type:"checkbox",checked:i.data.isActive!==!1,onChange:s=>o({...i,data:{...i.data,isActive:s.target.checked}})}),"Active"]}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:fe,onClick:()=>{o({open:!1,data:{}}),d(null)},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:a?"Update":"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(s=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#2563eb",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(wt,{size:40,color:"white"})}),e.jsx("div",{style:{textAlign:"center",marginBottom:"8px"},children:e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:s.label})}),s.assignments&&s.assignments.length>0&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"center",marginBottom:"8px"},children:s.assignments.map(j=>e.jsx("span",{style:{fontSize:"11px",padding:"4px 8px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"500"},children:j.staff.name},j.id))}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsx("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:s.isActive?"#ecfdf5":"#fef2f2",color:s.isActive?"#059669":"#dc2626",fontWeight:"600"},children:s.isActive?"Active":"Inactive"})}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{d(s),o({open:!0,data:{label:s.label,isActive:s.isActive}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:j=>{j.target.style.background="#eff6ff"},onMouseOut:j=>{j.target.style.background="transparent"},children:[e.jsx(dt,{size:14}),"Edit"]}),e.jsx(M,{variant:"danger",icon:Xe,onClick:()=>p(s.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})})]},s.id))})]})}function Cn({categories:t,onRefresh:r,categoryForm:i,setCategoryForm:o,subCategoryForm:a,setSubCategoryForm:d}){const[C,f]=n.useState(null),[c,x]=n.useState({open:!1}),p=async g=>{var B,y;g.preventDefault();try{await w.post("/admin/categories",i.data),o({open:!1,data:{}}),Z("Category created successfully!"),r()}catch(l){F(((y=(B=l.response)==null?void 0:B.data)==null?void 0:y.error)||"Failed to create category")}},s=async g=>{var B,y;g.preventDefault();try{await w.put(`/admin/categories/${C.id}`,i.data),o({open:!1,data:{}}),f(null),Z("Category updated successfully!"),r()}catch(l){F(((y=(B=l.response)==null?void 0:B.data)==null?void 0:y.error)||"Failed to update category")}},j=async g=>{x({open:!0,title:"Delete Category",message:"Are you sure you want to delete this category? All subcategories will be deleted. This action cannot be undone.",onConfirm:async()=>{var B,y;x({open:!1});try{await w.delete(`/admin/categories/${g}`),Z("Category deleted successfully!"),r()}catch(l){F(((y=(B=l.response)==null?void 0:B.data)==null?void 0:y.error)||"Failed to delete category")}},onCancel:()=>x({open:!1})})},I=async g=>{var B,y;g.preventDefault();try{await w.post(`/admin/categories/${a.data.categoryId}/subcategories`,{name:a.data.name,description:a.data.description}),d({open:!1,data:{}}),Z("Subcategory created successfully!"),r()}catch(l){F(((y=(B=l.response)==null?void 0:B.data)==null?void 0:y.error)||"Failed to create subcategory")}},R=async g=>{x({open:!0,title:"Delete Subcategory",message:"Are you sure you want to delete this subcategory? This action cannot be undone.",onConfirm:async()=>{var B,y;x({open:!1});try{await w.delete(`/admin/subcategories/${g}`),Z("Subcategory deleted successfully!"),r()}catch(l){F(((y=(B=l.response)==null?void 0:B.data)==null?void 0:y.error)||"Failed to delete subcategory")}},onCancel:()=>x({open:!1})})};return e.jsxs("div",{children:[e.jsx(Le,{...c}),e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Category Management"}),e.jsx(M,{icon:at,onClick:()=>{o({open:!0,data:{}}),f(null)},children:"Add Category"})]}),i.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{o({open:!1,data:{}}),f(null)},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:C?"Edit Category":"Create Category"}),e.jsx("button",{onClick:()=>{o({open:!1,data:{}}),f(null)},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(fe,{size:20})})]}),e.jsxs("form",{onSubmit:C?s:p,children:[e.jsx(ce,{label:"Category Name",value:i.data.name||"",onChange:g=>o({...i,data:{...i.data,name:g.target.value}}),required:!0}),e.jsx(ce,{label:"Description (Optional)",value:i.data.description||"",onChange:g=>o({...i,data:{...i.data,description:g.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:fe,onClick:()=>{o({open:!1,data:{}}),f(null)},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:C?"Update":"Create"})]})]})]})}),document.body),a.open&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:()=>{d({open:!1,data:{}})},className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Add Subcategory"}),e.jsx("button",{onClick:()=>{d({open:!1,data:{}})},style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(fe,{size:20})})]}),e.jsxs("form",{onSubmit:I,children:[e.jsx(ce,{label:"Subcategory Name",value:a.data.name||"",onChange:g=>d({...a,data:{...a.data,name:g.target.value}}),required:!0}),e.jsx(ce,{label:"Description (Optional)",value:a.data.description||"",onChange:g=>d({...a,data:{...a.data,description:g.target.value}})}),e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:[e.jsx(M,{variant:"outline",icon:fe,onClick:()=>{d({open:!1,data:{}})},children:"Cancel"}),e.jsx(M,{type:"submit",icon:qe,children:"Create"})]})]})]})}),document.body),e.jsx("div",{className:"admin-cards-grid",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"16px"},children:t.map(g=>e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"16px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column",gap:"12px",alignItems:"center"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#10b981",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"8px"},children:e.jsx(jt,{size:40,color:"white"})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"8px"},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"2px"},children:g.name}),g.description&&e.jsx("div",{style:{fontSize:"12px",color:"#64748b",lineHeight:"1.4"},children:g.description})]}),g.subCategories&&g.subCategories.length>0&&e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs("span",{style:{fontSize:"11px",padding:"4px 12px",borderRadius:"12px",background:"#eff6ff",color:"#2563eb",fontWeight:"600"},children:[g.subCategories.length," Subcategor",g.subCategories.length===1?"y":"ies"]})}),g.subCategories&&g.subCategories.length>0&&e.jsx("div",{style:{width:"100%",marginBottom:"8px",maxHeight:"120px",overflowY:"auto",padding:"8px",background:"#f8fafc",borderRadius:"8px"},children:g.subCategories.map(B=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"6px 8px",marginBottom:"4px",background:"white",borderRadius:"6px",fontSize:"12px"},children:[e.jsx("span",{style:{fontWeight:"500",color:"#1e293b"},children:B.name}),e.jsx("button",{onClick:()=>R(B.id),style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"2px 6px",fontSize:"12px",borderRadius:"4px"},onMouseOver:y=>{y.target.style.background="#fee2e2"},onMouseOut:y=>{y.target.style.background="transparent"},children:e.jsx(Xe,{size:12})})]},B.id))}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",marginTop:"auto",width:"100%"},children:[e.jsx(M,{variant:"outline",icon:at,onClick:()=>{d({open:!0,data:{categoryId:g.id,name:"",description:""}})},style:{fontSize:"12px",padding:"6px 12px",width:"100%"},children:"Add Subcategory"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{f(g),o({open:!0,data:{name:g.name,description:g.description||""}})},style:{fontSize:"12px",padding:"6px 12px",border:"none",background:"transparent",color:"#2563eb",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",fontWeight:"500",borderRadius:"6px",transition:"all 0.2s",width:"50%"},onMouseOver:B=>{B.target.style.background="#eff6ff"},onMouseOut:B=>{B.target.style.background="transparent"},children:[e.jsx(dt,{size:14}),"Edit"]}),e.jsx(M,{variant:"danger",icon:Xe,onClick:()=>j(g.id),style:{fontSize:"12px",padding:"6px 12px",width:"50%"},children:"Delete"})]})]})]},g.id))})]})}function kn({reports:t,filters:r,setFilters:i,staff:o,categories:a,showFilters:d,setShowFilters:C,onRefresh:f}){const[c,x]=n.useState(r),[p,s]=n.useState(!1),[j,I]=n.useState(!1),[R,g]=n.useState(!1),B=n.useRef(null),y=n.useRef(null),l=n.useRef(null);n.useEffect(()=>{d&&x(r)},[d]),n.useEffect(()=>{const m=D=>{B.current&&!B.current.contains(D.target)&&s(!1),y.current&&!y.current.contains(D.target)&&I(!1),l.current&&!l.current.contains(D.target)&&g(!1)};return(p||j||R)&&document.addEventListener("mousedown",m),()=>{document.removeEventListener("mousedown",m)}},[p,j,R]);const T=["REGULAR","SENIOR_CITIZEN","PWD","PREGNANT"],P=Array.from({length:24},(m,D)=>D),v=()=>{const m=new Date().toISOString().split("T")[0],D={startDate:m,endDate:m,staffIds:[],categoryIds:[],clientTypes:[],startHour:"",endHour:""};i(D),x(D)},U=()=>{i(c),C(!1)},$=()=>{x(r),C(!1)},Q=r.staffIds.length>0||r.categoryIds.length>0||r.clientTypes.length>0||r.startHour||r.endHour;if(!t)return e.jsx(ke,{});const se=t.byCategory?Object.entries(t.byCategory).map(([m,D])=>({name:m,value:D})):[],oe=t.byClientType?Object.entries(t.byClientType).map(([m,D])=>({name:m,value:D})):[],q=t.byStaff?Object.entries(t.byStaff).map(([m,D])=>({name:m,value:D})):[],ae=t.byHour?Object.entries(t.byHour).sort((m,D)=>parseInt(m[0])-parseInt(D[0])).map(([m,D])=>({hour:`${m}:00`,value:D})):[];return e.jsxs("div",{children:[e.jsxs("div",{className:"admin-page-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600"},children:"Reports & Analytics"}),e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[Q&&e.jsxs("button",{onClick:v,style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:"#64748b",fontWeight:"500"},onMouseOver:m=>{m.target.style.color="#1e293b"},onMouseOut:m=>{m.target.style.color="#64748b"},children:[e.jsx(fe,{size:16}),"Clear Filters"]}),e.jsxs("button",{onClick:()=>C(!0),style:{fontSize:"14px",padding:"8px 16px",border:"none",background:"transparent",boxShadow:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",color:Q?"#2563eb":"#64748b",fontWeight:"500"},onMouseOver:m=>{m.target.style.color="#2563eb"},onMouseOut:m=>{m.target.style.color=Q?"#2563eb":"#64748b"},children:[e.jsx(Qt,{size:16}),"Filters"]})]})]}),d&&He.createPortal(e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:$,className:"admin-modal-overlay",children:e.jsxs("div",{className:"admin-modal-box",style:{background:"white",borderRadius:"12px",padding:"24px",maxWidth:"800px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"20px",fontWeight:"600",margin:0},children:"Filter Reports"}),e.jsx("button",{onClick:$,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#64748b",display:"flex",alignItems:"center"},children:e.jsx(fe,{size:20})})]}),e.jsxs("div",{className:"admin-filter-grid",style:{display:"flex",flexDirection:"column",gap:"20px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 2fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Date"}),e.jsx("input",{type:"date",value:c.startDate,onChange:m=>x({...c,startDate:m.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Date"}),e.jsx("input",{type:"date",value:c.endDate,onChange:m=>x({...c,endDate:m.target.value}),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{style:{position:"relative"},ref:B,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Staff"}),e.jsx("div",{onClick:()=>s(!p),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:c.staffIds&&c.staffIds.length>0?c.staffIds.map(m=>{const D=o.find(G=>G.id===m);return D?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:G=>{G.stopPropagation(),x({...c,staffIds:c.staffIds.filter(O=>O!==m)})},children:[D.name,e.jsx(fe,{size:12})]},m):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select staff..."})}),p&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:o.map(m=>{var G;const D=((G=c.staffIds)==null?void 0:G.includes(m.id))||!1;return e.jsxs("div",{onClick:()=>{const O=c.staffIds||[];x(D?{...c,staffIds:O.filter(A=>A!==m.id)}:{...c,staffIds:[...O,m.id]})},style:{padding:"10px 12px",cursor:"pointer",background:D?"#eff6ff":"white",color:D?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:O=>{D||(O.currentTarget.style.background="#f8fafc")},onMouseOut:O=>{D||(O.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:D,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:m.name})]},m.id)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{style:{position:"relative"},ref:y,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Categories"}),e.jsx("div",{onClick:()=>I(!j),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:c.categoryIds&&c.categoryIds.length>0?c.categoryIds.map(m=>{const D=a.find(G=>G.id===m);return D?e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:G=>{G.stopPropagation(),x({...c,categoryIds:c.categoryIds.filter(O=>O!==m)})},children:[D.name,e.jsx(fe,{size:12})]},m):null}):e.jsx("span",{style:{color:"#94a3b8"},children:"Select categories..."})}),j&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:a.map(m=>{var G;const D=((G=c.categoryIds)==null?void 0:G.includes(m.id))||!1;return e.jsxs("div",{onClick:()=>{const O=c.categoryIds||[];x(D?{...c,categoryIds:O.filter(A=>A!==m.id)}:{...c,categoryIds:[...O,m.id]})},style:{padding:"10px 12px",cursor:"pointer",background:D?"#eff6ff":"white",color:D?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:O=>{D||(O.currentTarget.style.background="#f8fafc")},onMouseOut:O=>{D||(O.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:D,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:m.name})]},m.id)})})]}),e.jsxs("div",{style:{position:"relative"},ref:l,children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Client Types"}),e.jsx("div",{onClick:()=>g(!R),style:{width:"100%",padding:"10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",backgroundColor:"white",cursor:"pointer",minHeight:"44px",display:"flex",alignItems:"center",flexWrap:"wrap",gap:"6px"},children:c.clientTypes&&c.clientTypes.length>0?c.clientTypes.map(m=>e.jsxs("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"6px",background:"#eff6ff",color:"#2563eb",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},onClick:D=>{D.stopPropagation(),x({...c,clientTypes:c.clientTypes.filter(G=>G!==m)})},children:[m.replace("_"," "),e.jsx(fe,{size:12})]},m)):e.jsx("span",{style:{color:"#94a3b8"},children:"Select client types..."})}),R&&e.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"white",border:"2px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:T.map(m=>{var G;const D=((G=c.clientTypes)==null?void 0:G.includes(m))||!1;return e.jsxs("div",{onClick:()=>{const O=c.clientTypes||[];x(D?{...c,clientTypes:O.filter(A=>A!==m)}:{...c,clientTypes:[...O,m]})},style:{padding:"10px 12px",cursor:"pointer",background:D?"#eff6ff":"white",color:D?"#2563eb":"#1e293b",display:"flex",alignItems:"center",gap:"8px",borderBottom:"1px solid #f1f5f9"},onMouseOver:O=>{D||(O.currentTarget.style.background="#f8fafc")},onMouseOut:O=>{D||(O.currentTarget.style.background="white")},children:[e.jsx("input",{type:"checkbox",checked:D,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("span",{children:m.replace("_"," ")})]},m)})})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",alignItems:"end"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"Start Hour (Peak Hours)"}),e.jsxs(tt,{value:c.startHour,onChange:m=>x({...c,startHour:m.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),P.map(m=>e.jsxs("option",{value:m,children:[String(m).padStart(2,"0"),":00"]},m))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"14px",fontWeight:"500"},children:"End Hour (Peak Hours)"}),e.jsxs(tt,{value:c.endHour,onChange:m=>x({...c,endHour:m.target.value}),children:[e.jsx("option",{value:"",children:"All Hours"}),P.map(m=>e.jsxs("option",{value:m,children:[String(m).padStart(2,"0"),":00"]},m))]})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end",marginTop:"24px",paddingTop:"24px",borderTop:"1px solid #e2e8f0"},children:[e.jsx(M,{variant:"outline",icon:fe,onClick:$,children:"Cancel"}),e.jsx(M,{variant:"primary",icon:qe,onClick:U,children:"Apply Filters"})]})]})}),document.body),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",marginBottom:"24px"},children:[e.jsx(Se,{label:"Total Served",value:t.totalServed}),e.jsx(Se,{label:"Average Duration",value:`${Math.floor((t.averageDuration||0)/60)}m ${(t.averageDuration||0)%60}s`})]}),e.jsxs("div",{className:"admin-reports-grid",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"24px",marginBottom:"24px"},children:[se.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Category"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(it,{data:se,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"name"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(st,{dataKey:"value",fill:"#2563eb"})]})})]}),oe.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Client Type"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(St,{children:[e.jsx(Ct,{data:oe,cx:"50%",cy:"50%",labelLine:!1,label:({name:m,percent:D})=>`${m}: ${(D*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:oe.map((m,D)=>e.jsx(kt,{fill:ft[D%ft.length]},`cell-${D}`))}),e.jsx(Me,{})]})})]})]}),ae.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",marginBottom:"24px"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"Peak Hours"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(en,{data:ae,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"hour"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(tn,{type:"monotone",dataKey:"value",stroke:"#2563eb",strokeWidth:2})]})})]}),q.length>0&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h3",{style:{marginBottom:"16px"},children:"By Staff"}),e.jsx(Oe,{width:"100%",height:300,children:e.jsxs(it,{data:q,children:[e.jsx(Qe,{strokeDasharray:"3 3"}),e.jsx(Ke,{dataKey:"name"}),e.jsx(Je,{}),e.jsx(Me,{}),e.jsx(st,{dataKey:"value",fill:"#10b981"})]})})]})]})}function In({staffIdleMinutes:t=5,onStaffIdleMinutesSaved:r}){const[i,o]=n.useState(null),[a,d]=n.useState(null),[C,f]=n.useState(null),[c,x]=n.useState(""),[p,s]=n.useState(!1),[j,I]=n.useState(!0),[R,g]=n.useState(!1),[B,y]=n.useState({open:!1}),[l,T]=n.useState(null),[P,v]=n.useState(null),[U,$]=n.useState(!1),[Q,se]=n.useState({open:!1}),[oe,q]=n.useState([{id:"",name:""},{id:"",name:""},{id:"",name:""}]),[ae,m]=n.useState(""),[D,G]=n.useState(!1),[O,A]=n.useState("youtube"),[H,J]=n.useState(!1),[h,N]=n.useState(""),[ie,W]=n.useState(!1),[ee,re]=n.useState("5"),[he,xe]=n.useState(!1),[be,Ee]=n.useState("branding"),[Te,Ue]=n.useState({open:!1}),[Ye,_e]=n.useState(!1),[De,b]=n.useState(String(t)),[E,k]=n.useState(!1);n.useEffect(()=>{b(String(t))},[t]),n.useEffect(()=>{_(),Y(),X(),K(),te(),le(),z()},[]);const Y=async()=>{try{const u=await w.get("/admin/settings/site-title");x(u.data.siteTitle??"")}catch(u){console.error("Failed to load site title:",u)}},_=async()=>{try{const u=await w.get("/admin/settings/logo");u.data.logoUrl&&f(u.data.logoUrl)}catch(u){console.error("Failed to load logo:",u)}finally{I(!1)}},X=async()=>{try{const u=await w.get("/admin/settings/ding-sound");u.data.dingSoundUrl&&v(u.data.dingSoundUrl)}catch(u){console.error("Failed to load ding sound:",u)}},K=async()=>{var u;try{const S=await w.get("/admin/settings/tts-voices"),L=Array.isArray(S.data.voices)?S.data.voices:[],V=[...L];for(;V.length<3;)V.push({id:"",name:""});q(V.slice(0,3)),S.data.activeVoiceId?m(S.data.activeVoiceId):(u=L[0])!=null&&u.id&&m(L[0].id)}catch(S){console.error("Failed to load TTS voices:",S)}},te=async()=>{try{const u=await w.get("/admin/settings/video-source");A(u.data.videoSource||"youtube")}catch(u){console.error("Failed to load video source:",u)}},z=async()=>{try{const S=(await w.get("/admin/settings/video-volume")).data.videoVolumePercent;typeof S=="number"&&!Number.isNaN(S)&&re(String(Math.max(0,Math.min(100,S))))}catch(u){console.error("Failed to load video volume:",u)}},le=async()=>{try{const S=(await w.get("/admin/settings/youtube-playlist")).data.urls||[];N(S.join(`
`))}catch(u){console.error("Failed to load YouTube playlist:",u)}},ue=async u=>{var S,L;J(!0);try{await w.post("/admin/settings/video-source",{videoSource:u}),A(u),Z("Video source updated successfully!")}catch(V){F(((L=(S=V.response)==null?void 0:S.data)==null?void 0:L.error)||"Failed to save video source")}finally{J(!1)}},pe=async u=>{var L,V;u.preventDefault();const S=h.split(`
`).map(de=>de.trim()).filter(de=>de);W(!0);try{await w.post("/admin/settings/youtube-playlist",{urls:S}),Z("YouTube playlist saved!")}catch(de){F(((V=(L=de.response)==null?void 0:L.data)==null?void 0:V.error)||"Failed to save playlist")}finally{W(!1)}},ne=u=>{const S=u.target.files[0];if(S){o(S);const L=new FileReader;L.onloadend=()=>{d(L.result)},L.readAsDataURL(S)}},we=async u=>{var S,L;if(u.preventDefault(),!!i){g(!0);try{const V=new FormData;V.append("logo",i);const de=await w.post("/admin/settings/logo",V,{headers:{"Content-Type":"multipart/form-data"}});f(de.data.logoUrl),o(null),d(null),Z("Logo uploaded successfully!")}catch(V){console.error("Failed to upload logo:",V),F(((L=(S=V.response)==null?void 0:S.data)==null?void 0:L.error)||"Failed to upload logo")}finally{g(!1)}}},me=async()=>{y({open:!0,title:"Delete Logo",message:"Are you sure you want to delete the current logo?",onConfirm:async()=>{var u,S;y({open:!1});try{await w.delete("/admin/settings/logo"),f(null),o(null),d(null),Z("Logo deleted successfully!")}catch(L){console.error("Failed to delete logo:",L),F(((S=(u=L.response)==null?void 0:u.data)==null?void 0:S.error)||"Failed to delete logo")}},onCancel:()=>y({open:!1})})},ve=u=>{const S=u.target.files[0];S&&T(S)},ge=async u=>{var S,L;if(u.preventDefault(),!!l){$(!0);try{const V=new FormData;V.append("sound",l);const de=await w.post("/admin/settings/ding-sound",V,{headers:{"Content-Type":"multipart/form-data"}});v(de.data.dingSoundUrl),T(null),Z("Ding sound uploaded successfully!")}catch(V){console.error("Failed to upload ding sound:",V),F(((L=(S=V.response)==null?void 0:S.data)==null?void 0:L.error)||"Failed to upload ding sound")}finally{$(!1)}}},Be=async()=>{se({open:!0,title:"Delete Ding Sound",message:"Are you sure you want to delete the current ding sound?",onConfirm:async()=>{var u,S;se({open:!1});try{await w.delete("/admin/settings/ding-sound"),v(null),T(null),Z("Ding sound deleted successfully!")}catch(L){console.error("Failed to delete ding sound:",L),F(((S=(u=L.response)==null?void 0:u.data)==null?void 0:S.error)||"Failed to delete ding sound")}},onCancel:()=>se({open:!1})})},ye=async u=>{const S=typeof u=="string"?u.trim():"";if(!S){F("Please enter a voice ID first");return}const L="Window 1 will now serve number 123, or John Doe.";try{const de=(await w.post("/tts",{text:L,voiceId:S},{responseType:"arraybuffer"})).data;if(!de)return;const We=new Blob([de],{type:"audio/mpeg"}),nt=URL.createObjectURL(We);new Audio(nt).play().catch(Pe=>{console.error("Failed to play preview TTS audio:",Pe)}).finally(()=>{URL.revokeObjectURL(nt)})}catch(V){console.error("Failed to preview TTS voice:",V),F("Failed to preview this voice. Please check your ElevenLabs settings.")}},ze=(u,S,L)=>{q(V=>{const de=[...V];return de[u]={...de[u],[S]:L},de})},Re=async u=>{var S,L;u.preventDefault(),G(!0);try{const V=oe.map(Pe=>({id:(Pe.id||"").trim(),name:(Pe.name||"").trim()})).filter(Pe=>Pe.id);if(V.length===0){F("Please enter at least one ElevenLabs voice ID"),G(!1);return}const de=ae&&V.some(Pe=>Pe.id===ae)?ae:V[0].id,We=await w.post("/admin/settings/tts-voices",{voices:V,activeVoiceId:de}),Ge=[...Array.isArray(We.data.voices)?We.data.voices:V];for(;Ge.length<3;)Ge.push({id:"",name:""});q(Ge.slice(0,3)),m(We.data.activeVoiceId||de),Z("TTS voices updated successfully!")}catch(V){console.error("Failed to save TTS voices:",V),F(((L=(S=V.response)==null?void 0:S.data)==null?void 0:L.error)||"Failed to save TTS voices")}finally{G(!1)}};return j?e.jsx(ke,{}):e.jsxs("div",{children:[e.jsx(Le,{...B}),e.jsx(Le,{...Q}),e.jsx(Le,{...Te}),e.jsx("h2",{style:{fontSize:"20px",fontWeight:"600",marginBottom:"16px"},children:"Settings"}),e.jsx("div",{style:{display:"flex",gap:"8px",marginBottom:"24px",borderBottom:"1px solid #e2e8f0",paddingBottom:"4px",overflowX:"auto"},children:[{id:"branding",label:"Branding"},{id:"audio",label:"Audio & TTS"},{id:"videos",label:"Videos"},{id:"data",label:"Data"}].map(u=>{const S=be===u.id;return e.jsx("button",{type:"button",onClick:()=>Ee(u.id),style:{padding:"8px 16px",borderRadius:"9999px",border:"none",backgroundColor:S?"#1d4ed8":"transparent",color:S?"#ffffff":"#475569",fontSize:"14px",fontWeight:S?600:500,cursor:"pointer",boxShadow:S?"0 1px 3px rgba(15, 23, 42, 0.25)":"none",whiteSpace:"nowrap"},children:u.label},u.id)})}),be==="branding"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #2563eb"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Logo"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a logo to display across all pages. Supported formats: JPG, PNG, GIF, SVG, WebP (max 5MB)"}),C&&e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Logo:"}),e.jsx("img",{src:C,alt:"Current logo",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("form",{onSubmit:we,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Logo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:ne,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),a&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Preview:"}),e.jsx("img",{src:a,alt:"Preview",style:{maxWidth:"200px",maxHeight:"100px",objectFit:"contain",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"8px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(M,{type:"submit",disabled:!i||R,children:R?"Uploading...":"Upload Logo"}),C&&e.jsx(M,{variant:"danger",onClick:me,children:"Delete Logo"})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #2563eb"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Site title"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"This title appears next to (or below) the logo on every page."}),e.jsxs("form",{onSubmit:async u=>{var S,L;u.preventDefault(),s(!0);try{await w.post("/admin/settings/site-title",{siteTitle:c.trim()}),Z("Site title saved.")}catch(V){F(((L=(S=V.response)==null?void 0:S.data)==null?void 0:L.error)||"Failed to save site title")}finally{s(!1)}},style:{maxWidth:"400px",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Title"}),e.jsx("input",{type:"text",value:c,onChange:u=>x(u.target.value),placeholder:"e.g. My Office Name",maxLength:120,style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(M,{type:"submit",disabled:p,children:p?"Saving...":"Save title"})})]})]})]}),be==="audio"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #f97316"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Ding Sound (Announcement Chime)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Upload a short audio file to play before each queue announcement on the public monitoring page. Supported formats: MP3, WAV, OGG, M4A, AAC (max 2MB). Keep it brief (under 2 seconds) for best results."}),P&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",marginBottom:"8px"},children:"Current Ding Sound:"}),e.jsx("audio",{controls:!0,src:P,style:{width:"100%",maxWidth:"400px"},children:"Your browser does not support the audio element."})]}),e.jsxs("form",{onSubmit:ge,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"Upload New Ding Sound"}),e.jsx("input",{type:"file",accept:"audio/*",onChange:ve,style:{width:"100%",padding:"8px",border:"2px solid #e2e8f0",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{className:"admin-settings-buttons",style:{display:"flex",gap:"8px"},children:[e.jsx(M,{type:"submit",disabled:!l||U,children:U?"Uploading...":"Upload Ding Sound"}),P&&e.jsx(M,{variant:"danger",onClick:Be,children:"Delete Ding Sound"})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #10b981"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Text-to-Speech Voices (ElevenLabs)"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:"Configure up to three ElevenLabs voice IDs and choose which one is active for queue announcements. Voice IDs can be copied from your ElevenLabs dashboard."}),e.jsxs("form",{onSubmit:Re,children:[oe.map((u,S)=>e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"minmax(0, 1.2fr) minmax(0, 1.4fr) auto",gap:"12px",marginBottom:"12px",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",S+1," Name (optional)"]}),e.jsx("input",{type:"text",value:u.name||"",onChange:L=>ze(S,"name",L.target.value),placeholder:"e.g. Front Desk Female",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"13px",fontWeight:"500"},children:["Voice ",S+1," ID"]}),e.jsx("input",{type:"text",value:u.id||"",onChange:L=>ze(S,"id",L.target.value),placeholder:"ElevenLabs voice ID",style:{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace"}})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"6px"},children:[e.jsx("button",{type:"button",onClick:()=>ye(u.id),disabled:!u.id,style:{padding:"6px 10px",borderRadius:"6px",border:"1px solid #e2e8f0",backgroundColor:u.id?"#eff6ff":"#f8fafc",color:u.id?"#2563eb":"#94a3b8",fontSize:"12px",fontWeight:500,cursor:u.id?"pointer":"not-allowed"},children:"Preview Voice"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"13px"},children:[e.jsx("input",{type:"radio",name:"activeVoice",checked:!!u.id&&ae===u.id,disabled:!u.id,onChange:()=>{u.id&&m(u.id)}}),"Active"]})]})]},S)),e.jsx("div",{style:{marginTop:"16px",display:"flex",gap:"8px"},children:e.jsx(M,{type:"submit",disabled:D,children:D?"Saving Voices...":"Save Voices"})})]})]})]}),be==="videos"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #6366f1"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Video Source"}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"20px"},children:[e.jsx("strong",{children:"YouTube"})," plays videos from a playlist you define. ",e.jsx("strong",{children:"Local"})," lets the display pick a folder on that computer."]}),e.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",border:`2px solid ${O==="youtube"?"#6366f1":"#e2e8f0"}`,borderRadius:"8px",cursor:"pointer",backgroundColor:O==="youtube"?"#eef2ff":"transparent"},children:[e.jsx("input",{type:"radio",name:"videoSource",value:"youtube",checked:O==="youtube",onChange:()=>ue("youtube"),disabled:H}),e.jsxs("span",{children:[e.jsx("strong",{children:"YouTube"})," â€“ Playlist from admin-defined URLs"]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",border:`2px solid ${O==="local"?"#6366f1":"#e2e8f0"}`,borderRadius:"8px",cursor:"pointer",backgroundColor:O==="local"?"#eef2ff":"transparent"},children:[e.jsx("input",{type:"radio",name:"videoSource",value:"local",checked:O==="local",onChange:()=>ue("local"),disabled:H}),e.jsxs("span",{children:[e.jsx("strong",{children:"Local"})," â€“ Folder on the display computer"]})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #0ea5e9"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"12px"},children:"Default video volume"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:"Set the default playback volume for monitor videos (0 to 100%). This is applied when the monitor page starts."}),e.jsxs("form",{onSubmit:async u=>{var L,V;u.preventDefault();const S=Number(ee);if(!Number.isFinite(S)||S<0||S>100){F("Volume must be a number between 0 and 100.");return}xe(!0);try{await w.post("/admin/settings/video-volume",{videoVolumePercent:S}),re(String(Math.round(S))),Z("Default video volume saved.")}catch(de){F(((V=(L=de.response)==null?void 0:L.data)==null?void 0:V.error)||"Failed to save video volume")}finally{xe(!1)}},style:{maxWidth:"260px",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Volume (0â€“100%)"}),e.jsx("input",{type:"number",min:0,max:100,value:ee,onChange:u=>re(u.target.value.replace(/[^\d]/g,"").slice(0,3)),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}}),e.jsx("div",{style:{fontSize:"12px",color:"#94a3b8"},children:"Example: 0 = muted, 50 = half volume, 100 = full volume."}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(M,{type:"submit",disabled:he,children:he?"Saving...":"Save volume"})})]})]}),O==="youtube"&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #6366f1"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"YouTube Playlist"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"List YouTube URLs (one per line). Videos play in order on the monitor. Supports youtube.com/watch?v= and youtu.be/ links."}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"YouTube URLs"}),e.jsx("textarea",{value:h,onChange:u=>N(u.target.value),placeholder:`https://www.youtube.com/watch?v=VIDEO_ID
https://youtu.be/VIDEO_ID`,rows:8,style:{width:"100%",padding:"12px 16px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px",fontFamily:"monospace",backgroundColor:"#f8fafc",color:"#1e293b",resize:"vertical",boxSizing:"border-box"},onFocus:u=>{u.target.style.borderColor="#2563eb",u.target.style.backgroundColor="#ffffff"},onBlur:u=>{u.target.style.borderColor="#e2e8f0",u.target.style.backgroundColor="#f8fafc"}})]}),e.jsx(M,{type:"submit",disabled:ie,children:ie?"Saving...":"Save Playlist"})]})]}),O==="local"&&e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderLeft:"4px solid #22c55e"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"12px"},children:"Local videos"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",margin:0},children:"When the monitoring page loads, the user will select a folder containing video files. Videos play directly from that computer. Works in Chrome and Edge."})]})]}),be==="data"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #22c55e"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Staff idle threshold"}),e.jsxs("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"16px"},children:["After this many minutes without activity (e.g. opening the staff dashboard or profile), a staff member is shown as ",e.jsx("strong",{children:"Offline"})," on the Staff page. (1â€“120 minutes.)"]}),e.jsxs("form",{onSubmit:async u=>{var L,V;u.preventDefault();const S=Number(De);if(!Number.isFinite(S)||S<1||S>120){F("Enter a number between 1 and 120.");return}k(!0);try{const We=(await w.post("/admin/settings/staff-idle-minutes",{staffIdleMinutes:Math.round(S)})).data.staffIdleMinutes;b(String(We)),typeof r=="function"&&r(We),Z("Staff idle threshold saved.")}catch(de){F(((V=(L=de.response)==null?void 0:L.data)==null?void 0:V.error)||"Failed to save.")}finally{k(!1)}},style:{maxWidth:"260px",display:"flex",flexDirection:"column",gap:"8px"},children:[e.jsx("label",{style:{fontSize:"14px",fontWeight:"500",color:"#1e293b"},children:"Minutes (1â€“120)"}),e.jsx("input",{type:"number",min:1,max:120,value:De,onChange:u=>b(u.target.value.replace(/[^\d]/g,"").slice(0,3)),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:"2px solid #e2e8f0",fontSize:"14px"}}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(M,{type:"submit",disabled:E,children:E?"Saving...":"Save"})})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",borderTop:"3px solid #dc2626"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"Reset queue stats"}),e.jsx("p",{style:{fontSize:"14px",color:"#64748b",marginBottom:"24px"},children:"Permanently delete all queue entries, serving logs, and daily queue counters. Staff, windows, and categories are not affected. This cannot be undone."}),e.jsx(M,{variant:"danger",disabled:Ye,onClick:()=>{Ue({open:!0,title:"Reset all queue stats?",message:"This will delete all queue entries, serving logs, and daily counters. Staff, windows, and categories will be kept. This action cannot be undone.",onConfirm:async()=>{var u,S;Ue({open:!1}),_e(!0);try{await w.post("/admin/settings/reset-queue-stats"),Z("Queue stats reset successfully.")}catch(L){F(((S=(u=L.response)==null?void 0:u.data)==null?void 0:S.error)||"Failed to reset queue stats")}finally{_e(!1)}},onCancel:()=>Ue({open:!1})})},children:Ye?"Resetting...":"Reset queue stats"})]})]})]})}function Tn(){const t=Ce(),[r,i]=n.useState(!0),[o,a]=n.useState(null),[d,C]=n.useState(""),[f,c]=n.useState(!1),[x,p]=n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[s,j]=n.useState(!1),[I,R]=n.useState(!1);n.useEffect(()=>{const l=localStorage.getItem("token"),T=Ae();if(!l||(T==null?void 0:T.role)!=="ADMIN"){t("/admin/login");return}g()},[t]),n.useEffect(()=>{C((o==null?void 0:o.name)??"")},[o==null?void 0:o.name]);const g=async()=>{var l;try{const T=await w.get("/admin/profile");a(T.data.admin)}catch(T){console.error("Failed to load profile:",T),((l=T.response)==null?void 0:l.status)===401&&t("/admin/login")}finally{i(!1)}},B=async l=>{var P,v,U,$,Q,se;l.preventDefault();const T=(d??"").trim();R(!0);try{const oe=await w.put("/admin/profile",{name:T||null});a(oe.data.admin);const q=Ae();q&&(q.name=oe.data.admin.name??null,localStorage.setItem("user",JSON.stringify(q))),Z("Name updated successfully")}catch(oe){F(((v=(P=oe.response)==null?void 0:P.data)==null?void 0:v.error)||((se=(Q=($=(U=oe.response)==null?void 0:U.data)==null?void 0:$.errors)==null?void 0:Q[0])==null?void 0:se.msg)||"Failed to update name")}finally{R(!1)}},y=async l=>{var T,P;if(l.preventDefault(),x.newPassword!==x.confirmPassword){F("New passwords do not match");return}if(x.newPassword.length<6){F("Password must be at least 6 characters");return}j(!0);try{await w.post("/admin/profile/change-password",{currentPassword:x.currentPassword,newPassword:x.newPassword}),Z("Password changed successfully!"),c(!1),p({currentPassword:"",newPassword:"",confirmPassword:""})}catch(v){F(((P=(T=v.response)==null?void 0:T.data)==null?void 0:P.error)||"Failed to change password")}finally{j(!1)}};return r?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ke,{})}):e.jsxs("div",{className:"admin-profile-root",style:{minHeight:"100vh",background:"#f8fafc"},children:[e.jsx("style",{children:`
        .admin-profile-root { padding-left: env(safe-area-inset-left); padding-right: env(safe-area-inset-right); }
        @media (max-width: 768px) {
          .admin-profile-header { flex-wrap: wrap; gap: 12px; padding: 12px 16px !important; }
          .admin-profile-content { margin: 24px auto !important; padding: 0 16px !important; }
          .admin-profile-card { padding: 24px !important; }
        }
      `}),e.jsxs("div",{className:"admin-profile-header",style:{background:"white",borderBottom:"1px solid #e2e8f0",padding:"16px 24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(Ie,{size:"small"}),e.jsx(M,{variant:"outline",icon:yt,onClick:()=>t("/admin/dashboard"),children:"Back to Dashboard"})]}),e.jsx("div",{className:"admin-profile-content",style:{maxWidth:"600px",margin:"40px auto",padding:"0 24px"},children:e.jsxs("div",{className:"admin-profile-card",style:{background:"white",borderRadius:"12px",padding:"32px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"24px",color:"#1e293b"},children:"Admin Profile"}),e.jsxs("form",{onSubmit:B,children:[e.jsx(ce,{label:"Name",value:d,onChange:l=>C(l.target.value),placeholder:"Your display name"}),e.jsx(M,{type:"submit",icon:bt,disabled:I,style:{marginTop:"16px"},children:I?"Saving...":"Save name"})]}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsx(ce,{label:"Username",value:(o==null?void 0:o.username)||"",disabled:!0,readOnly:!0,style:{background:"#f1f5f9",color:"#64748b",cursor:"not-allowed",border:"2px solid #e2e8f0",borderRadius:"8px",padding:"12px"}})}),e.jsxs("div",{style:{marginTop:"32px",paddingTop:"32px",borderTop:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",color:"#1e293b"},children:"Change Password"}),e.jsx(M,{variant:"outline",icon:lt,onClick:()=>{c(!f),f&&p({currentPassword:"",newPassword:"",confirmPassword:""})},children:f?"Cancel":"Change Password"})]}),f&&e.jsxs("form",{onSubmit:y,children:[e.jsx(ce,{label:"Current Password",type:"password",value:x.currentPassword,onChange:l=>p({...x,currentPassword:l.target.value}),required:!0}),e.jsx(ce,{label:"New Password",type:"password",value:x.newPassword,onChange:l=>p({...x,newPassword:l.target.value}),required:!0}),e.jsx(ce,{label:"Confirm New Password",type:"password",value:x.confirmPassword,onChange:l=>p({...x,confirmPassword:l.target.value}),required:!0}),e.jsx(M,{type:"submit",icon:vt,disabled:s,style:{marginTop:"16px"},children:s?"Changing...":"Change Password"})]})]})]})})]})}function Dn(){return n.useEffect(()=>{let t=document.querySelector('link[rel="icon"]');t||(t=document.createElement("link"),t.rel="icon",document.head.appendChild(t));const r=d=>{const C=d&&!d.startsWith("http")&&!d.startsWith("data:")?d.startsWith("/")?window.location.origin+d:window.location.origin+"/"+d:d;t.href=C},i="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23667eea' rx='12'/%3E%3Ctext x='50' y='68' font-size='60' font-weight='bold' dominant-baseline='middle' text-anchor='middle' fill='white' font-family='system-ui,sans-serif'%3EQ%3C/text%3E%3C/svg%3E",o=async()=>{var d;try{const C=await w.get("/admin/settings/logo");(d=C.data)!=null&&d.logoUrl?r(C.data.logoUrl):r(i)}catch{r(i)}};o();const a=setInterval(o,3e4);return()=>clearInterval(a)},[]),null}function zn(){return e.jsxs(e.Fragment,{children:[e.jsx(Dn,{}),e.jsx(gn,{}),e.jsxs(Kt,{children:[e.jsx(je,{path:"/",element:e.jsx(sn,{})}),e.jsx(je,{path:"/success",element:e.jsx(ln,{})}),e.jsx(je,{path:"/thank-you",element:e.jsx(dn,{})}),e.jsx(je,{path:"/monitor",element:e.jsx(cn,{})}),e.jsx(je,{path:"/staff/login",element:e.jsx(pn,{})}),e.jsx(je,{path:"/staff/dashboard",element:e.jsx(fn,{})}),e.jsx(je,{path:"/staff/profile",element:e.jsx(hn,{})}),e.jsx(je,{path:"/admin/login",element:e.jsx(mn,{})}),e.jsx(je,{path:"/admin/dashboard",element:e.jsx(vn,{})}),e.jsx(je,{path:"/admin/profile",element:e.jsx(Tn,{})})]})]})}Jt.createRoot(document.getElementById("root")).render(e.jsx(Xt.StrictMode,{children:e.jsx(Zt,{children:e.jsx(zn,{})})}));
